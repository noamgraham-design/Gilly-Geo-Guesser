<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Gilly Israel Quiz</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&family=Playfair+Display:wght@700;900&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet"/>
<script type="module">
  import { initializeApp }                          from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut,
           GoogleAuthProvider, signInWithPopup,
           createUserWithEmailAndPassword,
           signInWithEmailAndPassword,
           updateProfile }                          from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, collection, addDoc,
           query, where, orderBy, limit,
           getDocs, serverTimestamp,
           setDoc, getDoc, doc }               from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey:            "AIzaSyC9bbLFNqAu5elsiWEmuFC_f4tZiPIRtLA",
    authDomain:        "gillygeoguesser.firebaseapp.com",
    projectId:         "gillygeoguesser",
    storageBucket:     "gillygeoguesser.firebasestorage.app",
    messagingSenderId: "1079594025377",
    appId:             "1:1079594025377:web:2071caaa6d1e562aa80be0",
    measurementId:     "G-QVGCFLQE9W"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  // ── Expose to window so the rest of the (non-module) script can call these ──
  window._fbAuth = auth;
  window._fbDb   = db;
  window._fbFns  = {
    signOut, GoogleAuthProvider, signInWithPopup,
    createUserWithEmailAndPassword, signInWithEmailAndPassword,
    updateProfile, collection, addDoc, query, where,
    orderBy, limit, getDocs, serverTimestamp,
    setDoc, getDoc, doc
  };

  onAuthStateChanged(auth, user => {
    window._fbUser = user || null;
    if (window._onAuthChange) window._onAuthChange(user);
  });
</script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg:      #f4f6f9;
    --surface: #ffffff;
    --border:  rgba(0,0,0,0.10);
    --green:   #1a7f37;
    --red:     #cf2316;
    --gold:    #9a6700;
    --text:    #1a1e27;
    --muted:   #57606a;
  }
  body {
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    font-family: 'Alef', sans-serif;
  }

  /* ── AUTH BUTTON ─────────────────────────────────────────────────────── */
  #auth-btn {
    display: flex; align-items: center; gap: 7px;
    background: #fff; border: 1px solid var(--border);
    border-radius: 50px; padding: 4px 12px 4px 4px;
    cursor: pointer; font-family: 'Source Serif 4', 'Alef', serif;
    font-size: 0.88rem; font-weight: 600; color: var(--text);
    transition: all 0.15s; flex-shrink: 0; white-space: nowrap;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
  }
  #auth-btn:hover { background: #f6f8fa; border-color: rgba(0,0,0,0.18); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  #auth-btn .auth-avatar {
    width: 28px; height: 28px; border-radius: 50%;
    background: #e8eaed;
    display: flex; align-items: center; justify-content: center;
    color: #555; font-size: 0.78rem; font-weight: 700; flex-shrink: 0;
    overflow: hidden; border: 1px solid rgba(0,0,0,0.08);
    position: relative;
  }
  #auth-btn .auth-avatar img {
    position: absolute; inset: 0;
    width: 100%; height: 100%;
    object-fit: cover; display: block;
  }

  /* ── AUTH DROPDOWN ────────────────────────────────────────────────────── */
  #auth-dropdown {
    display: none;
    position: absolute; top: calc(100% + 8px); right: 0;
    min-width: 210px; background: #fff;
    border: 1px solid var(--border); border-radius: 14px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.13);
    z-index: 2000;
    animation: ddPop 0.18s cubic-bezier(.34,1.4,.64,1);
  }
  #auth-dropdown.open { display: block; }
  @keyframes ddPop {
    from { opacity: 0; transform: translateY(-6px) scale(0.97); }
    to   { opacity: 1; transform: translateY(0)   scale(1); }
  }
  #auth-dropdown-user {
    padding: 14px 16px 10px;
  }
  #auth-dropdown-name {
    font-weight: 700; font-size: 0.92rem; color: var(--text);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  #auth-dropdown-email {
    font-size: 0.78rem; color: var(--muted); margin-top: 2px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .auth-dropdown-divider {
    height: 1px; background: var(--border); margin: 0;
  }
  .auth-dropdown-item {
    display: flex; align-items: center; gap: 10px;
    width: 100%; padding: 11px 16px; border: none;
    background: none; cursor: pointer; font-family: 'Source Serif 4', 'Alef', serif;
    font-size: 0.9rem; font-weight: 600; color: var(--text);
    text-align: left; transition: background 0.12s;
  }
  .auth-dropdown-item:hover { background: var(--bg); }
  .auth-dropdown-item:first-of-type { border-radius: 14px 14px 0 0; }
  .auth-dropdown-item:last-of-type  { border-radius: 0 0 14px 14px; }
  #auth-dropdown-user { border-radius: 14px 14px 0 0; }
  .auth-dropdown-item svg { flex-shrink: 0; color: var(--muted); }
  .auth-dropdown-signout { color: var(--red); }
  .auth-dropdown-signout svg { color: var(--red); }

  /* Mobile: compact icon-only auth button; dropdown opens below the button */
  @media (max-width: 768px) {
    #auth-btn { padding: 4px; border-radius: 50%; }
    #auth-label { display: none; }
    #auth-dropdown {
      top: calc(100% + 8px); bottom: auto; right: 0;
      min-width: 200px; border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
  }

  /* ── LOGIN MODAL ──────────────────────────────────────────────────────── */
  #login-modal {
    display: none; position: fixed; inset: 0; z-index: 9500;
    background: rgba(0,0,0,0.55); backdrop-filter: blur(4px);
    align-items: center; justify-content: center;
  }
  #login-modal.open { display: flex; }
  #login-card {
    background: var(--surface); border-radius: 20px;
    padding: 36px 32px 28px; width: min(420px, 92vw);
    box-shadow: 0 24px 60px rgba(0,0,0,0.25);
    display: flex; flex-direction: column; gap: 14px;
    animation: loginPop 0.28s cubic-bezier(.34,1.4,.64,1);
  }
  @keyframes loginPop {
    from { opacity:0; transform: scale(0.88) translateY(16px); }
    to   { opacity:1; transform: scale(1)    translateY(0); }
  }
  #login-card h2 {
    font-family: 'Playfair Display', 'Alef', serif; font-size: 1.7rem;
    font-weight: 900; text-align: center; margin-bottom: 2px;
    background: linear-gradient(90deg,#1a6fd4,#7c3aed);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  #login-card .login-sub {
    text-align: center; color: var(--muted); font-size: 0.9rem; margin-top: -8px;
  }
  .login-divider {
    display: flex; align-items: center; gap: 10px;
    color: var(--muted); font-size: 0.8rem;
  }
  .login-divider::before, .login-divider::after {
    content: ''; flex: 1; height: 1px; background: var(--border);
  }
  .login-input {
    width: 100%; padding: 10px 14px; border-radius: 10px;
    border: 1px solid var(--border); font-size: 0.95rem;
    font-family: 'Source Serif 4', 'Alef', serif; background: var(--bg);
    color: var(--text); outline: none; transition: border 0.15s;
  }
  .login-input:focus { border-color: #1a6fd4; }
  .btn-google {
    display: flex; align-items: center; justify-content: center; gap: 10px;
    width: 100%; padding: 10px; border-radius: 10px;
    border: 1px solid var(--border); background: var(--surface);
    cursor: pointer; font-size: 0.95rem; font-weight: 600;
    font-family: 'Source Serif 4', 'Alef', serif; color: var(--text);
    transition: all 0.15s;
  }
  .btn-google:hover { background: var(--bg); }
  .btn-google svg { width: 20px; height: 20px; flex-shrink: 0; }
  .btn-auth-submit {
    width: 100%; padding: 11px; border-radius: 10px; border: none;
    background: linear-gradient(135deg,#1a6fd4,#7c3aed); color: #fff;
    font-size: 1rem; font-weight: 700; font-family: 'Source Serif 4', 'Alef', serif;
    cursor: pointer; transition: all 0.15s;
  }
  .btn-auth-submit:hover { opacity: 0.9; transform: translateY(-1px); }
  #login-error {
    color: var(--red); font-size: 0.85rem; text-align: center;
    min-height: 1.2em; margin-top: -6px;
  }
  #login-toggle {
    text-align: center; font-size: 0.85rem; color: var(--muted);
  }
  #login-toggle a {
    color: #1a6fd4; cursor: pointer; text-decoration: underline;
  }
  #login-modal-close {
    position: absolute; top: 14px; right: 18px;
    background: none; border: none; font-size: 1.4rem;
    cursor: pointer; color: var(--muted); line-height: 1;
  }

  /* ── SETTINGS MODAL ───────────────────────────────────────────────────── */
  #settings-modal {
    display: none; position: fixed; inset: 0; z-index: 9500;
    background: rgba(0,0,0,0.55); backdrop-filter: blur(4px);
    align-items: center; justify-content: center;
  }
  #settings-modal.open { display: flex; }
  #settings-card {
    background: var(--surface); border-radius: 20px;
    padding: 36px 32px 28px; width: min(400px, 92vw);
    box-shadow: 0 24px 60px rgba(0,0,0,0.25);
    display: flex; flex-direction: column; gap: 18px;
    animation: loginPop 0.28s cubic-bezier(.34,1.4,.64,1);
    position: relative;
  }
  #settings-card h2 {
    font-family: 'Playfair Display', 'Alef', serif; font-size: 1.6rem;
    font-weight: 900; text-align: center;
    background: linear-gradient(90deg,#1a6fd4,#7c3aed);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .settings-field { display: flex; flex-direction: column; gap: 6px; }
  .settings-label {
    font-size: 0.78rem; font-weight: 700; text-transform: uppercase;
    letter-spacing: 1.2px; color: var(--muted);
  }
  .gender-options {
    display: flex; gap: 8px;
  }
  .gender-btn {
    flex: 1; padding: 9px 6px; border-radius: 10px;
    border: 1.5px solid var(--border); background: var(--bg);
    font-family: 'Source Serif 4', 'Alef', serif; font-size: 0.9rem;
    font-weight: 600; color: var(--text); cursor: pointer;
    transition: all 0.15s; text-align: center;
  }
  .gender-btn:hover { border-color: #1a6fd4; background: #f0f6ff; }
  .gender-btn.selected {
    border-color: #1a6fd4; background: linear-gradient(135deg, rgba(26,111,212,0.12), rgba(124,58,237,0.10));
    color: #1a6fd4; box-shadow: 0 0 0 3px rgba(26,111,212,0.15);
    transform: translateY(-1px);
  }
  #settings-save-msg {
    text-align: center; font-size: 0.85rem; font-weight: 600;
    color: var(--green); min-height: 1.2em; margin-top: -8px;
  }
  #settings-modal-close {
    position: absolute; top: 14px; right: 18px;
    background: none; border: none; font-size: 1.4rem;
    cursor: pointer; color: var(--muted); line-height: 1;
  }

  /* ── NICKNAME VALIDATION POPUP ────────────────────────────────────────── */
  #nickname-error-popup {
    display: none; position: fixed; top: 0; left: 0; right: 0;
    z-index: 10000; padding: 14px 20px;
    background: #cf2316; color: #fff;
    font-size: 0.92rem; font-weight: 600; text-align: center;
    font-family: 'Source Serif 4', 'Alef', serif;
    box-shadow: 0 4px 16px rgba(0,0,0,0.18);
    animation: nickErrSlide 0.3s cubic-bezier(.34,1.2,.64,1);
  }
  #nickname-error-popup.show { display: block; }
  @keyframes nickErrSlide {
    from { opacity: 0; transform: translateY(-100%); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ── NEW RECORD BANNER ────────────────────────────────────────────────── */
  #new-record-banner {
    display: none; text-align: center;
    padding: 10px 16px; margin: 8px 0 4px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(26,111,212,0.1), rgba(124,58,237,0.1));
    border: 1.5px solid rgba(124,58,237,0.3);
    animation: recordPop 0.5s cubic-bezier(.34,1.56,.64,1);
  }
  #new-record-banner.show { display: block; }
  @keyframes recordPop {
    from { opacity: 0; transform: scale(0.85); }
    to   { opacity: 1; transform: scale(1); }
  }
  #new-record-banner .record-title {
    font-family: 'Playfair Display', 'Alef', serif; font-size: 1.2rem; font-weight: 900;
    background: linear-gradient(90deg, #1a6fd4, #7c3aed);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  #new-record-banner .record-sub {
    font-size: 0.85rem; color: var(--muted); margin-top: 2px;
  }

  /* ── SCORE HISTORY ─────────────────────────────────────────────────────── */
  #history-section {
    margin-top: 12px; border-top: 1px solid var(--border);
    padding-top: 12px; display: none;
  }
  #history-section.show { display: block; }
  #history-section h3 {
    font-family: 'Playfair Display', 'Alef', serif; font-size: 1rem;
    font-weight: 700; margin-bottom: 8px; color: var(--muted);
    text-transform: uppercase; letter-spacing: 1.5px;
  }
  .history-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 6px 10px; border-radius: 8px; font-size: 0.85rem;
    background: var(--bg); margin-bottom: 4px;
  }
  .history-row .h-score { font-weight: 700; color: #1a6fd4; }
  .history-row .h-meta  { color: var(--muted); font-size: 0.78rem; }

  /* ── SCOREBOARD PANEL ────────────────────────────────────────────────── */
  @keyframes slideInScoreboard {
    from { transform: translateY(-18px) scale(0.97); opacity: 0; }
    to   { transform: translateY(0)     scale(1);    opacity: 1; }
  }
  #scoreboard-panel {
    display: none;
    position: fixed;
    top: 80px;
    left: 308px; /* 280px results panel + 28px gap */
    width: 310px;
    z-index: 8999;
    pointer-events: none;
  }
  #scoreboard-panel.show {
    display: flex;
    flex-direction: column;
    pointer-events: auto;
    animation: slideInScoreboard 0.38s cubic-bezier(.34,1.2,.64,1);
  }
  #scoreboard-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 18px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.16), 0 2px 8px rgba(0,0,0,0.07);
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 20px 18px 18px;
    height: auto;
    max-height: 75vh;
    overflow-y: auto;
  }
  #scoreboard-card::-webkit-scrollbar { width: 4px; }
  #scoreboard-card::-webkit-scrollbar-thumb { background: #c8ccd2; border-radius: 99px; }
  #sb-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 6px;
  }
  #scoreboard-card h3 {
    font-family: 'Playfair Display', 'Alef', serif;
    font-size: 1.35rem;
    font-weight: 900;
    margin-bottom: 0;
    background: linear-gradient(90deg, #1a6fd4, #7c3aed);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 0.5px;
  }
  #sb-close-btn {
    display: none; background: transparent; border: none;
    color: var(--muted); font-size: 1rem; cursor: pointer;
    padding: 2px 6px; border-radius: 6px; line-height: 1;
  }
  #sb-close-btn:hover { background: var(--bg); }
  .sb-row {
    display: flex; align-items: center; gap: 10px;
    padding: 7px 10px; border-radius: 10px; font-size: 0.88rem;
    background: var(--bg); margin-bottom: 4px;
    transition: background 0.15s;
  }
  .sb-row.sb-me {
    background: linear-gradient(135deg, rgba(26,111,212,0.1), rgba(124,58,237,0.08));
    border: 1.5px solid rgba(26,111,212,0.25);
  }
  .sb-rank {
    font-weight: 800; font-size: 0.82rem; color: var(--muted);
    min-width: 26px; text-align: center;
  }
  .sb-rank.gold   { color: #d4a017; font-size: 1rem; }
  .sb-rank.silver { color: #8a9197; font-size: 1rem; }
  .sb-rank.bronze { color: #b5561c; font-size: 1rem; }
  .sb-name {
    flex: 1; display: flex; flex-direction: column; gap: 1px; overflow: hidden;
  }
  .sb-name-text {
    font-weight: 600; color: var(--text);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .sb-level-badge {
    font-size: 0.68rem; color: var(--muted); font-weight: 500;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .sb-score { font-weight: 800; color: #1a6fd4; font-size: 0.95rem; }
  .sb-summary {
    display: flex; justify-content: space-between; align-items: center;
    background: linear-gradient(135deg, rgba(26,111,212,0.08), rgba(124,58,237,0.06));
    border: 1px solid rgba(26,111,212,0.18);
    border-radius: 10px; padding: 10px 14px; margin-bottom: 10px;
  }
  .sb-summary-left, .sb-summary-right { display: flex; flex-direction: column; gap: 1px; }
  .sb-summary-right { align-items: flex-end; }
  .sb-summary-label { font-size: 0.68rem; color: var(--muted); font-weight: 500; }
  .sb-summary-pts { font-size: 1.15rem; font-weight: 800; color: var(--text); }
  .sb-summary-pts-unit { font-size: 0.75rem; font-weight: 600; color: var(--muted); }
  .sb-top-pct {
    font-size: 1.05rem; font-weight: 800;
    background: linear-gradient(90deg, #1a6fd4, #7c3aed);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .sb-divider {
    text-align: center; color: var(--muted); font-size: 0.75rem;
    letter-spacing: 2px; padding: 2px 0; opacity: 0.5;
  }
  #scoreboard-guest {
    text-align: center; font-size: 0.85rem; color: var(--muted);
    padding: 10px 0;
  }

  /* TOP BAR */
  #topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 18px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    box-shadow: 0 1px 6px rgba(0,0,0,0.07);
    flex-shrink: 0;
    gap: 12px;
    flex-wrap: wrap;
    position: relative;
  }
  #topbar h1 {
    font-family: 'Playfair Display', 'Alef', serif;
    font-size: 1.7rem;
    font-weight: 900;
    background: linear-gradient(90deg, #1a6fd4, #7c3aed);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    white-space: nowrap;
  }
  #hud {
    display: flex;
    align-items: center;
    gap: 20px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }
  .hud-block {
    text-align: center;
    padding: 2px 12px 5px;
    background: rgba(0,0,0,0.05);
    border-radius: 10px;
    border: 1px solid rgba(0,0,0,0.08);
  }
  .hud-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); display: block; font-weight: 600; }
  .hud-value { font-family: 'Playfair Display', 'Alef', serif; font-size: 1.7rem; font-weight: 900; line-height: 1; }
  #progress-bar-wrap { min-width: 140px; }
  #progress-bar-bg { height: 5px; background: rgba(255,255,255,0.07); border-radius: 99px; overflow: hidden; }
  #progress-bar-fill { height: 100%; background: linear-gradient(90deg, #58a6ff, #bc8cff); border-radius: 99px; transition: width 0.4s ease; width: 0%; }
  #progress-label { font-size: 0.95rem; color: var(--muted); margin-top: 3px; text-align: right; }
  #streak-badge { font-size: 0.95rem; color: #f0883e; font-weight: 600; display: none; }

  /* TOWN CARD */
  #town-card {
    padding: 14px 18px;
    background: linear-gradient(135deg, rgba(26,111,212,0.06), rgba(124,58,237,0.06));
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    position: relative;
  }
  #town-center {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    pointer-events: none;
  }
  #town-name { font-family: 'Playfair Display', 'Alef', serif; font-size: 2.4rem; font-weight: 900; line-height: 1; background: linear-gradient(90deg, #1a6fd4, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  #town-desc { font-size: 0.95rem; color: var(--muted); font-style: italic; margin-top: 4px; }
  #town-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
  .btn {  border-radius: 50px; padding: 7px 16px; border: none; font-family: 'Source Serif 4', 'Alef', serif; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.15s; }
  .btn-hint { background: transparent; border: 1px dashed #444; color: var(--muted); }
  .btn-hint:hover { border-color: var(--gold); color: var(--gold); }
  .btn-hint:disabled { opacity: 0.4; cursor: default; }
  .btn-primary { background: linear-gradient(135deg, #1a6fd4, #7c3aed); color: #fff; box-shadow: 0 4px 14px rgba(26,111,212,0.35); }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(26,111,212,0.45); }
  .btn-learn {
    background: transparent;
    border: 2px solid #7c3aed;
    color: #7c3aed;
    font-size: 0.82rem;
    padding: 4px 20px;
    min-width: 180px;
    text-align: center;
    transition: background 0.15s, transform 0.15s, box-shadow 0.15s;
  }
  .btn-learn:hover {
    background: rgba(124,58,237,0.08);
    transform: translateY(-1px);
    box-shadow: 0 4px 14px rgba(124,58,237,0.2);
  }
  @keyframes gentlePulse {
    0%, 100% { box-shadow: 0 4px 14px rgba(26,111,212,0.35); }
    50%       { box-shadow: 0 4px 22px rgba(124,58,237,0.55); }
  }
  #btn-play-again {
    font-size: 1.05rem;
    padding: 10px 28px;
    animation: gentlePulse 2.5s ease-in-out infinite;
  }
  #btn-play-again:hover { animation: none; }
  #hint-badge { font-size: 0.95rem; color: var(--gold); font-weight: 600; display: none; }

  /* MAP */
  @keyframes rainbowBg {
    0%   { background-position: 0% 50%; }
    50%  { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  @keyframes flamePulse {
    0%,100% { transform: scale(1) rotate(-3deg); }
    25%      { transform: scale(1.3) rotate(3deg); }
    50%      { transform: scale(0.95) rotate(-2deg); }
    75%      { transform: scale(1.2) rotate(2deg); }
  }
  @keyframes bannerPop {
    0%   { transform: translate(-50%, -50%) scale(0.4); opacity: 0; }
    60%  { transform: translate(-50%, -50%) scale(1.08); opacity: 1; }
    80%  { transform: translate(-50%, -50%) scale(0.96); }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }
  @keyframes bannerFadeOut {
    0%   { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(0.85); opacity: 0; }
  }
  #streak-banner {
    position: absolute;
    top: 68%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.4);
    z-index: 2000;
    background: linear-gradient(270deg, #ff6b35, #f7c59f, #ffbe0b, #fb5607, #ff006e, #ffbe0b, #ff6b35);
    background-size: 400% 400%;
    color: #fff;
    padding: 28px 56px 32px;
    border-radius: 28px;
    box-shadow: 0 8px 48px rgba(0,0,0,0.35), 0 0 60px rgba(255,190,11,0.5);
    pointer-events: none;
    opacity: 0;
    white-space: nowrap;
    text-align: center;
  }
  #streak-banner.show {
    animation: bannerPop 0.5s cubic-bezier(.34,1.56,.64,1) forwards,
               rainbowBg 1.8s ease infinite;
  }
  #streak-banner.hide {
    animation: bannerFadeOut 0.35s ease forwards;
  }
  .streak-flames {
    font-size: 3.5rem;
    line-height: 1;
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 6px;
  }
  .streak-flames span {
    display: inline-block;
    animation: flamePulse 0.7s ease-in-out infinite;
  }
  .streak-flames span:nth-child(2) { animation-delay: 0.15s; }
  .streak-flames span:nth-child(3) { animation-delay: 0.3s; }
  .streak-main {
    font-family: 'Playfair Display', 'Alef', serif;
    font-size: 3.2rem;
    font-weight: 900;
    line-height: 1.1;
    text-shadow: 0 3px 12px rgba(0,0,0,0.3), 0 0 30px rgba(255,255,255,0.4);
    letter-spacing: 1px;
  }
  .streak-hebrew {
    font-size: 1.8rem;
    font-weight: 700;
    margin-top: 4px;
  }

  /* POINTS POPUP */
  #pts-popup {
    position: absolute;
    left: 50%;
    top: 38%;
    transform: translate(-50%, -50%);
    z-index: 1900;
    pointer-events: none;
    text-align: center;
    opacity: 0;
    white-space: nowrap;
  }
  .pts-number {
    font-family: 'Playfair Display', 'Alef', serif;
    font-weight: 900;
    line-height: 1;
    display: block;
    filter: drop-shadow(0 2px 12px rgba(0,0,0,0.35));
    text-shadow:
      -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff, 2px 2px 0 #fff,
      -3px  0px 0 #fff, 3px  0px 0 #fff,  0px -3px 0 #fff, 0px  3px 0 #fff;
  }
  .pts-label {
    font-family: 'Source Serif 4', 'Alef', serif;
    font-weight: 700;
    font-size: 1rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    display: block;
    margin-top: 4px;
    opacity: 0.95;
    text-shadow:
      -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff,
      -2px  0px 0 #fff, 2px  0px 0 #fff,  0px -2px 0 #fff, 0px  2px 0 #fff;
  }
  .pts-time-bonus {
    display: block; margin-top: 4px;
    font-family: 'Source Serif 4', 'Alef', serif; font-size: 1.4rem; font-weight: 700;
    letter-spacing: 1px;
    text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
  }
  /* Miss animation */
  @keyframes ptsMiss {
    0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    20%  { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
    75%  { opacity: 1; transform: translate(-50%, -50%) scale(1) translateY(0); }
    100% { opacity: 0; transform: translate(-50%, calc(-50% - 30px)) scale(0.9); }
  }
  /* Good animation */
  @keyframes ptsGood {
    0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.4); }
    25%  { opacity: 1; transform: translate(-50%, -50%) scale(1.12); }
    55%  { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    85%  { opacity: 1; transform: translate(-50%, -50%) scale(1) translateY(0); }
    100% { opacity: 0; transform: translate(-50%, calc(-50% - 50px)) scale(0.95); }
  }
  /* Perfect animation — big explosive pop */
  @keyframes ptsPerfect {
    0%   { opacity: 0;   transform: translate(-50%, -50%) scale(0.2) rotate(-8deg); }
    18%  { opacity: 1;   transform: translate(-50%, -50%) scale(1.35) rotate(3deg); }
    30%  { opacity: 1;   transform: translate(-50%, -50%) scale(0.95) rotate(-1deg); }
    45%  { opacity: 1;   transform: translate(-50%, -50%) scale(1.08) rotate(1deg); }
    60%  { opacity: 1;   transform: translate(-50%, -50%) scale(1) rotate(0deg); }
    85%  { opacity: 1;   transform: translate(-50%, calc(-50% - 20px)) scale(1); }
    100% { opacity: 0;   transform: translate(-50%, calc(-50% - 80px)) scale(1.1); }
  }
  @keyframes ptsPulseGlow {
    0%,100% { text-shadow:
      -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff, 2px 2px 0 #fff,
      -3px 0 0 #fff, 3px 0 0 #fff, 0 -3px 0 #fff, 0 3px 0 #fff,
      0 0 20px currentColor, 0 0 40px currentColor; }
    50%      { text-shadow:
      -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff, 2px 2px 0 #fff,
      -3px 0 0 #fff, 3px 0 0 #fff, 0 -3px 0 #fff, 0 3px 0 #fff,
      0 0 40px currentColor, 0 0 80px currentColor, 0 0 120px currentColor; }
  }
  #pts-popup.show-miss    { animation: ptsMiss    1.8s cubic-bezier(.4,0,.6,1) forwards; }
  #pts-popup.show-good    { animation: ptsGood    2.2s cubic-bezier(.34,1.2,.64,1) forwards; }
  #pts-popup.show-perfect { animation: ptsPerfect 2.6s cubic-bezier(.34,1.56,.64,1) forwards; }

  /* City polygon highlight — Leaflet layer gets this class via className */
  @keyframes cityPolyIn {
    0%   { opacity: 0; }
    20%  { opacity: 1; }
    60%  { opacity: 1; }
    100% { opacity: 0; }
  }
  #pts-popup.show-perfect .pts-number {
    animation: ptsPulseGlow 0.7s ease-in-out 0.3s 3;
  }

  /* EASY MODE BANNER */
  #easy-mode-banner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.4);
    z-index: 2000;
    background: linear-gradient(270deg, #06d6a0, #118ab2, #073b4c, #118ab2, #06d6a0);
    background-size: 400% 400%;
    color: #fff;
    padding: 24px 48px 28px;
    border-radius: 24px;
    box-shadow: 0 8px 48px rgba(0,0,0,0.35), 0 0 60px rgba(6,214,160,0.4);
    pointer-events: none;
    opacity: 0;
    white-space: nowrap;
    text-align: center;
    font-family: 'Playfair Display', 'Alef', serif;
    font-size: 2.5rem;
    font-weight: 900;
  }
  #easy-mode-banner.show {
    animation: bannerPop 0.4s cubic-bezier(.34,1.56,.64,1) forwards,
               rainbowBg 2s ease infinite;
  }
  #easy-mode-banner.hide {
    animation: bannerFadeOut 0.3s ease forwards;
  }

  .streak-hebrew {
    font-family: 'Source Serif 4', 'Alef', serif;
    font-size: 1.8rem;
    font-weight: 600;
    margin-top: 8px;
    direction: rtl;
    text-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  /* Score bump — intensity set via CSS custom property --bump-scale */
  @keyframes scorePop {
    0%   { transform: scale(1); }
    35%  { transform: scale(var(--bump-scale, 1.32)); }
    65%  { transform: scale(calc((var(--bump-scale, 1.32) - 1) * 0.3 + 1)); }
    100% { transform: scale(1); }
  }
  @keyframes scoreGlow {
    0%   { text-shadow: none; }
    40%  { text-shadow: 0 0 var(--glow-size, 8px) currentColor,
                        0 0 calc(var(--glow-size, 8px) * 2) currentColor; }
    100% { text-shadow: none; }
  }
  @keyframes scoreShake {
    0%,100% { transform: scale(var(--bump-scale, 1.32)) rotate(0deg); }
    25%      { transform: scale(var(--bump-scale, 1.32)) rotate(-4deg); }
    75%      { transform: scale(var(--bump-scale, 1.32)) rotate(4deg); }
  }
  #score-val {
    display: inline-block;
    transition: color 0.8s ease;
  }
  #score-val.score-bump {
    animation: scorePop 0.5s cubic-bezier(.34,1.56,.64,1),
               scoreGlow 0.7s ease;
  }
  #score-val.score-bump-epic {
    animation: scorePop 0.35s cubic-bezier(.34,1.56,.64,1) forwards,
               scoreShake 0.25s ease 0.35s,
               scoreGlow 0.9s ease;
  }

  #map { width:100%; height:100%; cursor: crosshair !important; }
  #map .leaflet-container { cursor: crosshair !important; }
  /* Tooltip */
  .city-label {
    background: rgba(255,255,255,0.75) !important;
    border: none !important;
    border-radius: 10px !important;
    padding: 0 !important;
    box-shadow: 0 3px 14px rgba(0,0,0,0.18) !important;
    white-space: nowrap !important;
    pointer-events: auto !important;
    overflow: hidden !important;
  }
  .city-label::before { display: none !important; }
  .tooltip-inner {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 10px 5px 10px;
  }
  .tooltip-name {
    font-family: 'Playfair Display', 'Alef', serif;
    font-size: 0.92rem;
    font-weight: 700;
    color: #1a1e27;
    letter-spacing: 0.01em;
  }

  @keyframes sparkPop {
    0%,100% { transform: scale(1) rotate(-5deg); }
    50%      { transform: scale(1.3) rotate(8deg); }
  }
  .fact-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    font-size: 0.82rem;
    background: rgba(26, 111, 212, 0.45);
    border: 1px solid rgba(26, 111, 212, 0.7);
    
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.15s, transform 0.15s;
    flex-shrink: 0;
    padding: 0;
  }
  .fact-btn .spark {
    display: inline-block;
    animation: sparkPop 1.8s ease-in-out infinite;
    font-size: 0.75rem;
  }
  .fact-btn:hover {
    background: rgba(26, 111, 212, 0.62);
    transform: scale(1.15);
  }

  /* FACT MODAL */
  #fact-modal {
    position: fixed;
    inset: 0;
    z-index: 20000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(3px);
    animation: factFadeIn 0.2s ease;
  }
  @keyframes factFadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
  }
  #fact-modal-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 28px 32px 24px;
    max-width: 420px;
    width: 100%;
    box-shadow: 0 12px 48px rgba(0,0,0,0.25);
    display: flex;
    flex-direction: column;
    gap: 10px;
    animation: factCardPop 0.25s cubic-bezier(.34,1.56,.64,1);
  }
  @keyframes factCardPop {
    from { transform: scale(0.88); opacity: 0; }
    to   { transform: scale(1);    opacity: 1; }
  }
  #fact-modal-title {
    font-family: 'Playfair Display', 'Alef', serif;
    font-size: 1.4rem;
    font-weight: 900;
    background: linear-gradient(90deg, #1a6fd4, #7c3aed);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  #fact-modal-body {
    font-size: 1rem;
    color: var(--text);
    line-height: 1.7;
  }
  #fact-modal-close {
    align-self: flex-end;
    margin-top: 6px;
    padding: 7px 20px;
    border-radius: 50px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    font-family: 'Source Serif 4', 'Alef', serif;
    font-size: 0.95rem;
    cursor: pointer;
    transition: background 0.15s;
  }
  #fact-modal-close:hover { background: var(--bg); }

  /* FEEDBACK TOAST */
  #feedback {
    position: fixed;
    bottom: 28px; left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 12px 22px;
    font-size: 1rem; font-weight: 600;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    z-index: 9999;
    transition: transform 0.3s cubic-bezier(.34,1.56,.64,1), opacity 0.3s;
    opacity: 0; pointer-events: none; white-space: nowrap;
  }
  #feedback.show { transform: translateX(-50%) translateY(0); opacity: 1; }

  /* RESULTS SIDE PANEL */
  @keyframes slideInLeft {
    from { transform: translateX(-100%); opacity: 0; }
    to   { transform: translateX(0);     opacity: 1; }
  }
  #results-panel {
    display: none;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    width: 280px;
    z-index: 9000;
    pointer-events: none;
  }
  #results-panel.show {
    display: flex;
    flex-direction: column;
    pointer-events: auto;
    animation: slideInLeft 0.35s cubic-bezier(.34,1.2,.64,1);
  }
  #results-card {
    background: var(--surface);
    border-right: 1px solid var(--border);
    box-shadow: 4px 0 24px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px 16px 20px;
    height: 100%;
    overflow-y: auto;
  }
  #results-card::-webkit-scrollbar { width: 4px; }
  #results-card::-webkit-scrollbar-thumb { background: #c8ccd2; border-radius: 99px; }
  #results-card h2 { font-family: 'Playfair Display', 'Alef', serif; font-size: 1.5rem; font-weight: 900; background: linear-gradient(90deg, #1a6fd4, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  #score-display { font-family: 'Playfair Display', 'Alef', serif; font-size: 2.4rem; font-weight: 900; line-height: 1; margin: 4px 0 2px; }

  /* OVERLAY */
  #overlay {
    position: fixed; inset: 0;
    background: rgba(244,246,249,0.95);
    backdrop-filter: blur(8px);
    z-index: 8000;
    display: flex; align-items: flex-start; justify-content: center;
    padding: 20px;
    padding-top: 80px;
    overflow-y: auto;
  }
  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 14px 28px 16px; max-width: 440px; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 4px; box-shadow: 0 8px 40px rgba(0,0,0,0.08); }
  .card h2 { font-family: 'Playfair Display', 'Alef', serif; font-size: 1.8rem; font-weight: 900; margin-bottom: 10px; background: linear-gradient(90deg, #1a6fd4, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .card p { color: var(--muted); font-size: 1.05rem; line-height: 1.75; margin-bottom: 22px; }
  .diff-row { display: flex; gap: 8px; justify-content: center; }
  .diff-btn { padding: 4px 14px; border-radius: 50px; border: 2px solid var(--border); background: transparent; color: var(--muted); font-family: 'Source Serif 4', 'Alef', serif; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.15s; min-width: 74px; text-align: center; }
  .diff-btn.active-easy   { border-color: var(--green); color: var(--green); background: rgba(26,127,55,0.08); }
  .diff-btn.active-medium { border-color: var(--gold);  color: var(--gold);  background: rgba(154,103,0,0.08); }
  .diff-btn.active-hard   { border-color: var(--red);   color: var(--red);   background: rgba(207,35,22,0.08); }
  .diff-btn.active-region { border-color: #1a6fd4; color: #1a6fd4; background: rgba(26,111,212,0.08); }
  .diff-note { font-size: 0.78rem; color: #777; margin-bottom: 0; }
  #results-list { margin: 8px 0; width: 100%; text-align: start; }
  #results-list::-webkit-scrollbar { width: 4px; }
  #results-list::-webkit-scrollbar-thumb { background: #c8ccd2; border-radius: 99px; }
  .result-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; margin-bottom: 5px; border-radius: 10px; font-size: 1rem; }
  .result-row.hit  { background: rgba(63,185,80,0.08);  border: 1px solid rgba(63,185,80,0.2); }
  .result-row.miss { background: rgba(248,81,73,0.08);  border: 1px solid rgba(248,81,73,0.2); }
  .result-town { font-weight: 600; }
  .result-region { font-size: 0.95rem; color: var(--muted); }
  .result-pts { font-weight: 700; }
  .result-pts.hit  { color: var(--green); }
  .result-pts.miss { color: var(--red); }
  .btn-row { display: flex; gap: 10px; justify-content: center; margin-top: 6px; }
  .btn-secondary { background: transparent; border: 1px solid rgba(255,255,255,0.12); color: var(--muted); border-radius: 50px; padding: 10px 20px; font-family: 'Source Serif 4', 'Alef', serif; font-size: 1rem; cursor: pointer; }

  /* ── SUN & CLOUDS ─────────────────────────────────────────────────── */
  @keyframes sunSpin {
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
  }
  @keyframes sunPulse {
    0%,100% { filter: brightness(1) drop-shadow(0 0 4px #ffb700); }
    50%      { filter: brightness(1.2) drop-shadow(0 0 10px #ffb700); }
  }
  @keyframes cloudDrift1 {
    0%   { transform: translateX(0); }
    50%  { transform: translateX(28px); }
    100% { transform: translateX(0); }
  }
  @keyframes cloudDrift2 {
    0%   { transform: translateX(0); }
    50%  { transform: translateX(-22px); }
    100% { transform: translateX(0); }
  }
  @keyframes cloudDrift3 {
    0%   { transform: translateX(0); }
    50%  { transform: translateX(18px); }
    100% { transform: translateX(0); }
  }
  @keyframes cloudDrift4 {
    0%   { transform: translateX(0); }
    50%  { transform: translateX(-15px); }
    100% { transform: translateX(0); }
  }
  @keyframes cloudDrift5 {
    0%   { transform: translateX(0); }
    50%  { transform: translateX(20px); }
    100% { transform: translateX(0); }
  }
  /* logo-wrapper: logo + sky overlay (kept for compatibility) */
  .logo-wrapper {
    position: relative;
    display: block;
    line-height: 0;
    align-self: center;
    text-align: center;
  }
  .sky-scene {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: visible;
    z-index: 10;
  }
  .sun {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    animation: sunPulse 3s ease-in-out infinite;
  }
  .cloud {
    position: absolute;
    display: flex;
    align-items: flex-end;
  }
  .cloud-body {
    position: relative;
    background: #fff;
    border-radius: 50px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .cloud-body::before, .cloud-body::after {
    content: '';
    position: absolute;
    background: #fff;
    border-radius: 50%;
  }
  .cloud1 {
    top: 20px; left: 2%;
    animation: cloudDrift1 7s ease-in-out infinite;
  }
  .cloud1 .cloud-body {
    width: 80px; height: 26px;
  }
  .cloud1 .cloud-body::before {
    width: 40px; height: 40px;
    top: -20px; left: 12px;
  }
  .cloud1 .cloud-body::after {
    width: 28px; height: 28px;
    top: -12px; left: 38px;
  }
  .cloud2 {
    top: 8px; right: 2%;
    animation: cloudDrift2 9s ease-in-out infinite;
  }
  .cloud2 .cloud-body {
    width: 90px; height: 28px;
  }
  .cloud2 .cloud-body::before {
    width: 44px; height: 44px;
    top: -22px; left: 14px;
  }
  .cloud2 .cloud-body::after {
    width: 30px; height: 30px;
    top: -14px; left: 48px;
  }
  .cloud3 {
    top: 50px; left: 18%;
    animation: cloudDrift3 11s ease-in-out infinite;
  }
  .cloud3 .cloud-body {
    width: 60px; height: 20px;
  }
  .cloud3 .cloud-body::before {
    width: 30px; height: 30px;
    top: -15px; left: 8px;
  }
  .cloud3 .cloud-body::after {
    width: 20px; height: 20px;
    top: -8px; left: 30px;
  }

  /* ── REDESIGNED MENU ────────────────────────────────────────────── */
  /* Overlay top bar */
  .overlay-topbar {
    position: absolute;
    top: 0; left: 0; right: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 24px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    box-shadow: 0 1px 6px rgba(0,0,0,0.07);
    z-index: 10;
  }
  .overlay-topbar-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .overlay-topbar-title {
    font-family: 'Playfair Display', 'Alef', serif;
    font-size: 1.25rem;
    font-weight: 900;
    background: linear-gradient(90deg, #1a6fd4, #7c3aed);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    white-space: nowrap;
  }
  .overlay-topbar-right {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .overlay-lang-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 50px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    color: var(--text);
    font-family: 'Source Serif 4', 'Alef', serif;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
  }
  .overlay-lang-btn:hover { border-color: rgba(0,0,0,0.2); background: var(--bg); }

  /* Background clouds (in overlay, not in card) */
  .overlay-bg-clouds {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    z-index: 1;
  }
  .bg-cloud {
    position: absolute;
    display: flex;
    align-items: flex-end;
  }
  .bg-cloud .cloud-body {
    position: relative;
    background: rgba(255,255,255,0.7);
    border-radius: 50px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
  }
  .bg-cloud .cloud-body::before, .bg-cloud .cloud-body::after {
    content: '';
    position: absolute;
    background: rgba(255,255,255,0.7);
    border-radius: 50%;
  }
  .bg-cloud1 { top: 15%; left: 3%; animation: cloudDrift1 12s ease-in-out infinite; }
  .bg-cloud1 .cloud-body { width: 100px; height: 32px; }
  .bg-cloud1 .cloud-body::before { width: 50px; height: 50px; top: -26px; left: 14px; }
  .bg-cloud1 .cloud-body::after  { width: 36px; height: 36px; top: -16px; left: 48px; }
  .bg-cloud2 { top: 22%; right: 5%; animation: cloudDrift2 15s ease-in-out infinite; }
  .bg-cloud2 .cloud-body { width: 110px; height: 34px; }
  .bg-cloud2 .cloud-body::before { width: 54px; height: 54px; top: -28px; left: 16px; }
  .bg-cloud2 .cloud-body::after  { width: 38px; height: 38px; top: -18px; left: 56px; }
  .bg-cloud3 { top: 55%; left: 8%; animation: cloudDrift4 18s ease-in-out infinite; }
  .bg-cloud3 .cloud-body { width: 70px; height: 24px; }
  .bg-cloud3 .cloud-body::before { width: 36px; height: 36px; top: -18px; left: 10px; }
  .bg-cloud3 .cloud-body::after  { width: 24px; height: 24px; top: -10px; left: 36px; }
  .bg-cloud4 { top: 68%; right: 6%; animation: cloudDrift5 14s ease-in-out infinite; }
  .bg-cloud4 .cloud-body { width: 85px; height: 28px; }
  .bg-cloud4 .cloud-body::before { width: 42px; height: 42px; top: -22px; left: 12px; }
  .bg-cloud4 .cloud-body::after  { width: 30px; height: 30px; top: -14px; left: 42px; }
  .bg-cloud5 { top: 82%; left: 15%; animation: cloudDrift3 16s ease-in-out infinite; }
  .bg-cloud5 .cloud-body { width: 60px; height: 20px; }
  .bg-cloud5 .cloud-body::before { width: 30px; height: 30px; top: -15px; left: 8px; }
  .bg-cloud5 .cloud-body::after  { width: 22px; height: 22px; top: -10px; left: 28px; }

  /* Menu card title area */
  .menu-title-section {
    text-align: center;
    margin-bottom: 2px;
  }
  .menu-mode-title {
    display: none;
  }
  .menu-mode-subtitle {
    font-size: 0.85rem;
    color: var(--muted);
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  /* Region icon cards */
  .region-grid {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin: 4px 0;
  }
  .region-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    transition: all 0.2s;
    padding: 4px;
    border-radius: 16px;
    min-width: 74px;
  }
  .region-card:hover {
    background: rgba(26,111,212,0.04);
  }
  .region-icon {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    background: var(--bg);
    border: 2.5px solid transparent;
    transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .region-card.active .region-icon {
    border-color: #1a6fd4;
    background: rgba(26,111,212,0.08);
    box-shadow: 0 0 0 3px rgba(26,111,212,0.15), 0 2px 8px rgba(0,0,0,0.06);
  }
  .region-label {
    font-size: 0.78rem;
    font-weight: 600;
    color: var(--muted);
    text-align: center;
    white-space: nowrap;
  }
  .region-card.active .region-label {
    color: #1a6fd4;
    font-weight: 700;
  }

  /* Start button */
  .btn-start-gold {
    background: linear-gradient(135deg, #1a6fd4, #1558b0);
    color: #fff;
    border: none;
    box-shadow: 0 4px 14px rgba(26,111,212,0.35);
    font-size: 0.95rem;
    padding: 8px 28px;
    min-width: 180px;
    text-align: center;
  }
  .btn-start-gold:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(26,111,212,0.5);
    background: linear-gradient(135deg, #2a7fe4, #1a6fd4);
  }

  #menu-card.card {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    position: relative;
    overflow: hidden;
  }
  #menu-card.card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: url('israel_flag.png') center/contain no-repeat;
    opacity: 0.25;
    z-index: -1;
    pointer-events: none;
  }

  /* Menu logo at top of menu card */
  .menu-logo {
    margin-top: 0;
    margin-bottom: 2px;
    width: auto;
    height: auto;
    max-width: 300px;
    max-height: 36vh;
    object-fit: contain;
    flex-shrink: 1;
    display: block;
  }

  /* DESKTOP – enlarge menu card & contents */
  @media (min-width: 769px) {
    #overlay {
      padding-top: 48px;
    }
    .card {
      max-width: 500px;
      padding: 10px 34px 12px;
      gap: 2px;
    }
    .card h2 {
      font-size: 1.9rem;
      margin-bottom: 4px;
    }
    .card p {
      font-size: 1.05rem;
      line-height: 1.3;
      margin-bottom: 4px;
    }
    .menu-title-section {
      margin-bottom: 0;
    }
    .menu-mode-title {
      font-size: 1.7rem;
      margin-bottom: 0;
    }
    .diff-row {
      gap: 10px;
    }
    .diff-btn {
      padding: 4px 18px;
      font-size: 0.92rem;
      min-width: 82px;
    }
    .diff-note {
      font-size: 0.82rem;
    }
    .region-grid {
      gap: 8px;
      margin: 2px 0;
    }
    .region-card {
      min-width: 76px;
      gap: 2px;
      padding: 4px;
    }
    .region-icon {
      width: 48px;
      height: 48px;
      font-size: 1.45rem;
    }
    .region-label {
      font-size: 0.82rem;
    }
    .btn-start-gold {
      font-size: 1rem;
      padding: 8px 30px;
      min-width: 200px;
    }
    .btn-learn {
      font-size: 0.92rem;
      padding: 6px 22px;
    }
    .menu-logo {
      max-width: 380px;
      max-height: 36vh;
      margin-top: 0;
      margin-bottom: 0;
    }
    #menu-desc {
      font-size: 0.92rem !important;
      line-height: 1.3 !important;
    }
    #lbl-region {
      font-size: 0.85rem !important;
    }
  }

  /* MOBILE RESPONSIVE STYLES */
  @media (max-width: 768px) {
    /* Scoreboard panel — popup below the results bar on mobile */
    #scoreboard-panel {
      top: 68px !important; left: 0 !important; right: 0 !important;
      bottom: auto !important; width: 100% !important;
    }
    #scoreboard-panel.show {
      animation: mobileScoreboardIn 0.3s cubic-bezier(.34,1.2,.64,1) !important;
    }
    @keyframes mobileScoreboardIn {
      from { transform: translateY(-12px); opacity: 0; }
      to   { transform: translateY(0);     opacity: 1; }
    }
    #scoreboard-card {
      border-right: none !important;
      border-bottom: 1px solid var(--border) !important;
      border-radius: 0 0 16px 16px !important;
      box-shadow: 0 8px 28px rgba(0,0,0,0.18) !important;
      height: auto !important;
      max-height: 55vh !important;
      padding: 14px 16px !important;
    }
    #sb-close-btn { display: block !important; }

    /* Hide logo and title on mobile */
    #topbar h1 {
      display: none !important;
    }
    
    /* Reorganize topbar for mobile — hud left, town center, ☰ right */
    #topbar {
      padding: 8px 12px;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: nowrap;
      position: relative;
    }

    /* Town name — centered between HUD and ☰ */
    #mobile-topbar-town {
      display: flex !important;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      min-width: 0;
      text-align: center;
      overflow: hidden;
    }
    #mobile-topbar-town .mob-find-label {
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 1.8px;
      color: var(--muted);
      font-weight: 700;
      line-height: 1;
      margin-bottom: 2px;
    }
    #mobile-topbar-town .mob-town-text {
      font-family: 'Playfair Display', 'Alef', serif;
      font-size: 1.05rem;
      font-weight: 900;
      line-height: 1.2;
      background: linear-gradient(90deg, #1a6fd4, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      white-space: normal;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      word-break: break-word;
    }

    /* HUD — override desktop absolute positioning, sit on the left */
    #hud {
      position: static !important;
      transform: none !important;
      display: flex;
      align-items: center;
      gap: 4px;
      flex-shrink: 0;
      z-index: 1;
    }

    /* Hide desktop town-card on mobile */
    #town-card {
      display: none !important;
    }

    /* Show mobile home button — right of HUD */
    #mobile-home-btn {
      display: flex !important;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      padding: 6px 10px;
      margin-left: 4px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      flex-shrink: 0;
    }
    #mobile-home-btn:active {
      background: var(--bg);
    }

    /* Mobile tools (binoculars) button + dropdown */
    #mobile-tools-wrap {
      display: block !important;
      position: relative;
      flex-shrink: 0;
    }
    #mobile-tools-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      padding: 6px 10px;
      margin-right: 4px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      flex-shrink: 0;
    }
    #mobile-tools-btn:active {
      background: var(--bg);
    }
    #mobile-tools-dropdown {
      display: none;
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      min-width: 200px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      z-index: 5000;
      padding: 8px;
    }
    #mobile-tools-dropdown.show {
      display: flex !important;
      flex-direction: column;
      gap: 8px;
    }
    #mobile-tools-dropdown button {
      width: 100%;
      justify-content: center;
    }

    /* Mobile confirm modal */
    #mobile-confirm-modal {
      display: none; position: fixed; inset: 0; z-index: 9500;
      background: rgba(0,0,0,0.55); backdrop-filter: blur(4px);
      align-items: center; justify-content: center;
    }
    #mobile-confirm-modal.open { display: flex; }
    #mobile-confirm-card {
      background: var(--surface); border-radius: 18px;
      padding: 28px 24px 22px; width: min(320px, 88vw);
      box-shadow: 0 20px 50px rgba(0,0,0,0.25);
      text-align: center;
      animation: ddPop 0.22s cubic-bezier(.34,1.4,.64,1);
    }
    #mobile-confirm-title {
      font-family: 'Playfair Display', 'Alef', serif;
      font-size: 1.25rem; font-weight: 800; margin-bottom: 6px;
    }
    #mobile-confirm-sub {
      font-size: 0.88rem; color: var(--muted); margin-bottom: 18px;
    }
    #mobile-confirm-actions {
      display: flex; gap: 10px; justify-content: center;
    }
    #mobile-confirm-yes {
      background: var(--red); color: #fff; border: none;
      padding: 10px 20px; border-radius: 10px; font-weight: 700;
      cursor: pointer; font-size: 0.9rem;
    }
    #mobile-confirm-no {
      background: var(--surface); color: var(--text);
      border: 1px solid var(--border);
      padding: 10px 20px; border-radius: 10px; font-weight: 700;
      cursor: pointer; font-size: 0.9rem;
    }
    
    /* Topbar adjustments */
    #topbar h1 {
      font-size: 1.3rem;
    }
    #topbar h1 svg {
      width: 32px !important;
      height: 32px !important;
    }
    
    /* HUD blocks smaller */
    .hud-block {
      min-width: 44px;
      text-align: center;
      padding: 2px 6px;
      background: rgba(26,111,212,0.06);
      border-radius: 8px;
      border: 1px solid rgba(26,111,212,0.12);
    }
    .hud-label {
      font-size: 0.7rem;
    }
    .hud-value {
      font-size: 1.3rem;
    }
    
    /* Town card adjustments */
    #town-card {
      padding: 8px 12px;
      font-size: 0.9rem;
    }
    #town-name {
      font-size: 1.3rem;
    }
    #town-desc {
      font-size: 0.85rem;
    }
    #town-actions {
      gap: 6px;
    }
    
    /* Buttons more touch-friendly */
    .btn {
      padding: 10px 18px;
      font-size: 0.95rem;
      min-height: 44px; /* Apple's minimum touch target */
    }
    .btn-hint {
      padding: 8px 14px;
      font-size: 0.85rem;
    }
    #btn-back {
      padding: 8px 14px;
      font-size: 0.85rem;
    }
    
    /* Menu card smaller */
    .card {
      max-width: 95%;
      padding: 10px 16px 14px;
      gap: 6px;
    }
    .card h2 {
      font-size: 1.4rem;
      margin-bottom: 4px;
    }
    .card p {
      font-size: 0.9rem;
      margin-bottom: 10px;
      line-height: 1.5;
    }

    /* Overlay topbar mobile */
    .overlay-topbar {
      padding: 10px 14px;
    }
    .overlay-topbar-title {
      font-size: 1rem;
    }
    .overlay-lang-btn {
      padding: 5px 10px;
      font-size: 0.78rem;
    }

    /* Region icons smaller on mobile */
    .region-icon {
      width: 46px;
      height: 46px;
      font-size: 1.3rem;
    }
    .region-grid {
      gap: 8px;
    }
    .region-card {
      min-width: 60px;
    }

    /* Difficulty buttons more compact */
    .diff-btn {
      padding: 6px 13px;
      font-size: 0.85rem;
    }

    /* Tighten diff-row gaps */
    .diff-row {
      gap: 6px;
      margin-bottom: 4px;
    }

    /* Diff note smaller */
    .diff-note {
      font-size: 0.82rem;
      margin-bottom: 10px;
    }

    /* Menu mode title */
    .menu-mode-title {
      font-size: 1.35rem;
    }

    /* Start button tighter */
    #start-btn {
      padding: 10px 32px !important;
      font-size: 1rem !important;
    }

    /* Overlay on mobile */
    #overlay {
      padding-top: 70px;
      align-items: flex-start;
    }

    /* Restore btn-learn to original size on mobile */
    #learn-btn {
      font-size: 1rem !important;
      padding: 10px 36px !important;
    }

    /* Menu logo on mobile */
    .menu-logo {
      max-width: 280px;
      max-height: 34vh;
      margin-top: 0;
      margin-bottom: 2px;
    }

    /* Restore menu description text to original size on mobile */
    #menu-desc {
      font-size: 0.9rem !important;
      line-height: 1.5 !important;
    }

    /* Results panel — compact top bar on mobile */
    #results-panel {
      width: 100% !important;
      max-width: 100% !important;
      top: 0; left: 0; right: 0;
      bottom: auto !important;
      height: auto !important;
    }
    #results-panel.show {
      animation: slideInTop 0.35s cubic-bezier(.34,1.2,.64,1);
    }
    @keyframes slideInTop {
      from { transform: translateY(-100%); opacity: 0; }
      to   { transform: translateY(0);     opacity: 1; }
    }
    #results-card {
      flex-direction: row !important;
      align-items: center !important;
      justify-content: space-between !important;
      flex-wrap: nowrap !important;
      gap: 6px !important;
      padding: 10px 14px !important;
      height: auto !important;
      border-right: none !important;
      border-bottom: 1px solid var(--border) !important;
      box-shadow: 0 4px 18px rgba(0,0,0,0.13) !important;
      overflow: visible !important;
    }
    /* Hide things we don't need in compact mode */
    #result-emoji,
    #results-list,
    #results-card h2 {
      display: none !important;
    }
    #score-display {
      font-size: 1.5rem !important;
      line-height: 1 !important;
      margin: 0 !important;
    }
    #result-title {
      display: none !important;
    }
    #result-sub {
      font-size: 0.75rem !important;
      margin: 2px 0 0 !important;
    }
    #results-summary-block {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 0;
    }
    .btn-row {
      flex-wrap: nowrap !important;
      margin-top: 0 !important;
      gap: 6px !important;
      flex-shrink: 0 !important;
    }
    #btn-play-again {
      font-size: 0.85rem !important;
      padding: 8px 14px !important;
      animation: none !important;
      white-space: nowrap;
    }
    #btn-menu {
      font-size: 0.85rem !important;
      padding: 8px 14px !important;
      white-space: nowrap;
    }
    
    /* Streak banner smaller */
    .streak-main {
      font-size: 2.2rem;
    }
    .streak-hebrew {
      font-size: 1.5rem;
    }
    .streak-flames {
      font-size: 2.8rem;
    }
    
    /* Feedback toast — compact on mobile */
    #feedback {
      white-space: normal !important;
      width: calc(100vw - 32px);
      max-width: 360px;
      text-align: center;
      font-size: 0.88rem !important;
      padding: 9px 14px !important;
      bottom: 16px;
      line-height: 1.4;
    }

    /* Easy mode banner smaller */
    #easy-mode-banner {
      font-size: 1.8rem;
      padding: 18px 36px 22px;
    }
    
    /* Fact modal more mobile-friendly */
    #fact-modal-content {
      max-width: 90%;
      padding: 20px;
    }
    #fact-modal-title {
      font-size: 1.5rem;
    }
    #fact-modal-body {
      font-size: 0.95rem;
    }
  }
  
  /* EXTRA SMALL MOBILE (phones in portrait) */
  @media (max-width: 480px) {
    #topbar h1 {
      font-size: 1.1rem;
    }
    #topbar h1 svg {
      width: 28px !important;
      height: 28px !important;
    }
    
    .hud-block {
      min-width: 60px;
    }
    .hud-label {
      font-size: 0.65rem;
    }
    .hud-value {
      font-size: 1.1rem;
    }
    #mobile-topbar-town .mob-town-text {
      font-size: 0.9rem;
    }
    
    #town-name {
      font-size: 1.1rem;
    }
    #town-desc {
      font-size: 0.8rem;
    }
    
    .card h2 {
      font-size: 1.3rem;
    }

    /* Overlay topbar even more compact */
    .overlay-topbar-title {
      font-size: 0.9rem;
    }
    .menu-logo {
      max-width: 220px;
      max-height: 28vh;
      margin-top: 0;
      margin-bottom: 2px;
    }
    .overlay-lang-btn {
      padding: 4px 8px;
      font-size: 0.72rem;
    }
    .region-icon {
      width: 42px;
      height: 42px;
      font-size: 1.2rem;
    }
    .region-label {
      font-size: 0.7rem;
    }
    .menu-mode-title {
      font-size: 1.2rem;
    }
    
    #results-panel {
      width: 90%;
    }
    
    .streak-main {
      font-size: 1.8rem;
    }
    .streak-hebrew {
      font-size: 1.2rem;
    }
    
    #easy-mode-banner {
      font-size: 1.5rem;
      padding: 16px 28px 18px;
    }
  }

  /* ── Learning Mode ───────────────────────────────────────────────────────── */
  #learning-hud {
    display: none;
    align-items: center;
    gap: 20px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }
  #learning-hud.active { display: flex; }
  .lr-dot { width: 11px; height: 11px; border-radius: 50%; background: #e0e0e0; border: 1.5px solid #ccc; display: inline-block; transition: background 0.2s, border-color 0.2s; }
  .lr-dot.used { background: #cf2316; border-color: #cf2316; }
  .lr-dot.mastered { background: #1a7f37; border-color: #1a7f37; }
  .lr-att-wrap { display: flex; gap: 5px; align-items: center; margin-top: 4px; justify-content: center; }
  #learning-results-panel {
    display: none;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    width: 280px;
    z-index: 9000;
    pointer-events: none;
  }
  #learning-results-panel.show {
    display: flex;
    flex-direction: column;
    pointer-events: auto;
    animation: slideInLeft 0.35s cubic-bezier(.34,1.2,.64,1);
  }
  #learning-results-card {
    background: var(--surface);
    border-right: 1px solid var(--border);
    box-shadow: 4px 0 24px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px 16px 20px;
    height: 100%;
    overflow-y: auto;
  }
  .lr-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid var(--border); font-size: 0.88rem; width: 100%; }
  .lr-row:last-child { border-bottom: none; }
  .lr-badge-mastered { color: #1a7f37; font-weight: 700; font-size: 0.82rem; flex-shrink: 0; margin-left: 6px; }
  .lr-badge-next { color: #9a6700; font-weight: 700; font-size: 0.82rem; flex-shrink: 0; margin-left: 6px; }
  #lr-level-up-banner { background: linear-gradient(135deg, #f0a500, #e05c00); color: #fff; border-radius: 10px; padding: 10px 14px; text-align: center; font-size: 0.95rem; font-weight: 700; margin: 4px 0; width: 100%; box-sizing: border-box; }
  #lr-list { width: 100%; overflow-y: auto; max-height: 260px; }
  #learning-preview-bar {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 850;
    background: rgba(0,0,0,0.78);
    color: #fff;
    border-radius: 30px;
    padding: 11px 22px;
    font-size: 0.95rem;
    font-weight: 600;
    display: none;
    align-items: center;
    gap: 14px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.35);
    pointer-events: none;
    white-space: nowrap;
  }
  #learning-preview-bar.active { display: flex; }
  #learning-preview-count {
    font-size: 1.4rem;
    font-weight: 900;
    min-width: 28px;
    text-align: center;
    color: #ffd700;
    font-family: 'Playfair Display', 'Alef', serif;
  }
  @keyframes lrPulse {
    0%   { transform: scale(1);    opacity: 1; }
    50%  { transform: scale(1.18); opacity: 0.85; }
    100% { transform: scale(1);    opacity: 1; }
  }
  #learning-big-countdown {
    display: none;
    position: fixed;
    top: 72px;
    right: 16px;
    z-index: 860;
    font-family: 'Playfair Display', 'Alef', serif;
    font-size: 5rem;
    font-weight: 900;
    color: #fff;
    text-shadow: 0 0 24px rgba(220,50,50,0.9), 0 2px 6px rgba(0,0,0,0.6);
    line-height: 1;
    pointer-events: none;
    animation: lrPulse 1s ease-in-out infinite;
  }
  #learning-big-countdown.active { display: block; }
  @media (max-width: 768px) {
    #learning-results-panel { width: 100% !important; }
    #learning-hud { position: static !important; transform: none !important; display: none; gap: 10px; }
    #learning-hud.active { display: flex; }
  }
  @media (max-width: 480px) {
    #learning-results-panel { width: 100% !important; }
  }
  /* Arab village Hebrew labels shown on street-view zoom-in */
  .arab-label {
    background: none !important;
    border: none !important;
    box-shadow: none !important;
    white-space: nowrap;
    font-size: 11px;
    font-weight: 700;
    color: #1a1a1a;
    text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
    pointer-events: none;
    direction: rtl;
  }
</style>
</head>
<body>

<div id="topbar">
  <h1>
    <svg width="38" height="38" viewBox="0 0 38 38" style="vertical-align:middle;margin-right:6px;flex-shrink:0;border-radius:4px;box-shadow:0 1px 4px rgba(0,0,0,0.18);" xmlns="http://www.w3.org/2000/svg">
      <!-- White background -->
      <rect width="38" height="38" fill="#fff"/>
      <!-- Top blue stripe -->
      <rect y="5.5" width="38" height="6" fill="#0038b8"/>
      <!-- Bottom blue stripe -->
      <rect y="26.5" width="38" height="6" fill="#0038b8"/>
      <!-- Star of David — two proper equilateral triangles, centered at 19,19 -->
      <polygon points="19.0,12.5 24.6,22.2 13.4,22.2" fill="none" stroke="#0038b8" stroke-width="1.6"/>
      <polygon points="19.0,25.5 13.4,15.8 24.6,15.8" fill="none" stroke="#0038b8" stroke-width="1.6"/>
    </svg>
    <span id="title-text">Gilly Israel Quiz</span>
  </h1>
  <div id="hud">
    <div class="hud-block">
      <span class="hud-label" id="lbl-round">Round</span>
      <span class="hud-value" id="round-val">1/—</span>
    </div>
    <div class="hud-block">
      <span class="hud-label" id="lbl-score">Score</span>
      <span class="hud-value" id="score-val" style="color:#1a6fd4">0</span>
    </div>
  </div>
  <div id="learning-hud">
    <div class="hud-block">
      <span class="hud-label" id="lr-prog-label">Location</span>
      <span class="hud-value" id="lr-prog-val">—</span>
    </div>
    <div class="hud-block">
      <span class="hud-label" id="lr-att-label">Tries</span>
      <div class="lr-att-wrap" id="lr-att-dots"></div>
    </div>
  </div>
  <div id="mobile-topbar-town" style="display:none"><span class="mob-find-label">📍 Find</span><span class="mob-town-text">—</span></div>
  <div id="mobile-tools-wrap" style="display:none">
    <button id="mobile-tools-btn" onclick="toggleMobileTools()">🔭</button>
    <div id="mobile-tools-dropdown">
      <button class="btn btn-hint" id="mobile-tools-hint" onclick="useHint()">💡 Hint (−10 pts) · 3 left</button>
      <button class="btn btn-hint" id="mobile-tools-layer" onclick="toggleMapLayer()">🗺️ מפת רחוב</button>
    </div>
  </div>
  <button id="mobile-home-btn" onclick="mobileGoHome()" style="display:none">🏠</button>
</div>

<!-- Mobile "Are you sure?" confirmation modal -->
<div id="mobile-confirm-modal">
  <div id="mobile-confirm-card">
    <div id="mobile-confirm-title">Are you sure?</div>
    <div id="mobile-confirm-sub">Your current game progress will be lost.</div>
    <div id="mobile-confirm-actions">
      <button class="btn" id="mobile-confirm-yes" onclick="confirmGoHome()">Yes, go home</button>
      <button class="btn" id="mobile-confirm-no" onclick="closeConfirmModal()">Cancel</button>
    </div>
  </div>
</div>

<div id="town-card">
  <div style="min-width:160px">
    <button class="btn btn-hint" id="btn-back" onclick="showMenu()" style="display:none">← תפריט</button>
  </div>
  <div id="town-center">
    <div id="town-name">—</div>
    <div id="town-desc">בחר/י רמת קושי והתחל/י את המשחק</div>
  </div>
  <div id="town-actions">
    <span id="hint-badge">📍 האזור מסומן על המפה</span>
    <button class="btn btn-hint" id="btn-hint" onclick="useHint()">💡 Hint (−10 pts) · 3 left</button>
    <button class="btn btn-hint" id="btn-layer" onclick="toggleMapLayer()">🗺️ מפת רחוב</button>
  </div>
</div>

<div style="flex:1;position:relative;">
  <div id="streak-banner"></div>
  <div id="easy-mode-banner"></div>
  <div id="pts-popup"></div>
  <div id="map" style="position:absolute;inset:0;"></div>
</div>
<div id="feedback"></div>

<!-- FACT MODAL (hidden by default) -->
<div id="fact-modal" style="display:none">
  <div id="fact-modal-card">
    <div id="fact-modal-title"></div>
    <div id="fact-modal-body"></div>
    <button id="fact-modal-close" onclick="closeFactModal()">סגור</button>
  </div>
</div>

<div id="overlay">
  <!-- Top navigation bar -->
  <div class="overlay-topbar">
    <div class="overlay-topbar-left">
      <span class="overlay-topbar-title" id="overlay-title-text">Gilly Israel Quiz</span>
    </div>
    <div class="overlay-topbar-right">
      <button class="overlay-lang-btn" id="lang-toggle" onclick="toggleLang()">🌐 English</button>
      <div id="auth-wrap" style="position:relative;flex-shrink:0;">
        <button id="auth-btn" onclick="handleAuthBtnClick()">
          <span class="auth-avatar" id="auth-avatar">👤</span>
          <span id="auth-label">התחברות</span>
        </button>
        <div id="auth-dropdown">
          <div id="auth-dropdown-user">
            <div id="auth-dropdown-name"></div>
            <div id="auth-dropdown-email"></div>
          </div>
          <div class="auth-dropdown-divider"></div>
          <button class="auth-dropdown-item" onclick="openSettingsModal()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            <span id="auth-dd-settings">Settings</span>
          </button>
          <button class="auth-dropdown-item" onclick="switchAccount()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            <span id="auth-dd-switch">Switch account</span>
          </button>
          <button class="auth-dropdown-item auth-dropdown-signout" onclick="signOutUser()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            <span id="auth-dd-signout">Sign out</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Background decorations -->
  <div class="overlay-bg-clouds">
    <div class="bg-cloud bg-cloud1"><div class="cloud-body"></div></div>
    <div class="bg-cloud bg-cloud2"><div class="cloud-body"></div></div>
    <div class="bg-cloud bg-cloud3"><div class="cloud-body"></div></div>
    <div class="bg-cloud bg-cloud4"><div class="cloud-body"></div></div>
    <div class="bg-cloud bg-cloud5"><div class="cloud-body"></div></div>
  </div>

  <!-- Main menu card -->
  <div class="card" id="menu-card" style="z-index:2;background:transparent;border:none;box-shadow:none;">
    <div class="menu-title-section">
      <img src="logo_nb.png" alt="Gilly Israel Quiz" class="menu-logo" id="menu-logo">
      <div class="menu-mode-title" id="menu-mode-title">מצב משחק</div>
    </div>
    <p id="menu-desc" style="margin:0;font-size:0.88rem;line-height:1.35;text-align:center;">
      מצא/י את המיקום על המפה
    </p>
    <div class="diff-row" id="diff-row">
      <button class="diff-btn" id="d-easy"   onclick="setDiff('easy')">קל</button>
      <button class="diff-btn active-medium" id="d-medium" onclick="setDiff('medium')">בינוני</button>
      <button class="diff-btn" id="d-hard"   onclick="setDiff('hard')">קשה</button>
    </div>
    <div class="diff-note" id="diff-note">ערים ועיירות</div>
    <div style="width:100%;border-top:1px solid var(--border);margin:4px 0 2px"></div>
    <div style="font-size:0.82rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);font-weight:600" id="lbl-region">אזור</div>
    <div class="region-grid">
      <div class="region-card active" id="r-all" onclick="setRegion('all')">
        <div class="region-icon"><svg width="32" height="32" viewBox="0 0 38 38" style="border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,0.15);" xmlns="http://www.w3.org/2000/svg"><rect width="38" height="38" fill="#fff"/><rect y="5" width="38" height="6.5" fill="#0038b8"/><rect y="26.5" width="38" height="6.5" fill="#0038b8"/><polygon points="19,11.5 25.2,22.2 12.8,22.2" fill="none" stroke="#0038b8" stroke-width="1.8"/><polygon points="19,26.5 12.8,15.8 25.2,15.8" fill="none" stroke="#0038b8" stroke-width="1.8"/></svg></div>
        <div class="region-label" id="r-all-label">הכל</div>
      </div>
      <div class="region-card" id="r-north" onclick="setRegion('north')">
        <div class="region-icon">🏔️</div>
        <div class="region-label" id="r-north-label">צפון</div>
      </div>
      <div class="region-card" id="r-center" onclick="setRegion('center')">
        <div class="region-icon">🏙️</div>
        <div class="region-label" id="r-center-label">מרכז</div>
      </div>
      <div class="region-card" id="r-south" onclick="setRegion('south')">
        <div class="region-icon">🏜️</div>
        <div class="region-label" id="r-south-label">דרום</div>
      </div>
    </div>
    <button id="start-btn" class="btn btn-start-gold" onclick="startGame()">← התחל משחק</button>
    <button id="learn-btn" class="btn btn-learn" onclick="startLearning()">🗺️ מצב למידה</button>
  </div>

</div>

<div id="results-panel">
  <div id="results-card">
    <div id="result-emoji" style="font-size:2.4rem;margin-bottom:4px">🏆</div>
    <h2 id="result-title">Excellent!</h2>
    <div id="results-summary-block">
      <div id="score-display" style="color:#1a6fd4">0 pts</div>
      <div style="color:var(--muted);font-size:1.1rem;font-weight:600;margin-bottom:4px" id="result-sub">0/8 correct</div>
    </div>
    <div id="results-list"></div>
    <div class="btn-row">
      <button id="btn-play-again" class="btn btn-primary" onclick="startGame()">▶ שחק שוב</button>
      <button id="btn-menu" class="btn-secondary" onclick="showMenu()">תפריט</button>
    </div>
    <div id="new-record-banner">
      <div class="record-title">🏅 New Personal Best!</div>
      <div class="record-sub" id="new-record-sub"></div>
    </div>
    <div id="history-section">
      <h3 id="history-title">Your Recent Games</h3>
      <div id="history-list"></div>
    </div>
  </div>
</div>
<div id="scoreboard-panel">
  <div id="scoreboard-card">
    <div id="sb-header">
      <h3 id="scoreboard-title">🏆 Leaderboard</h3>
      <button id="sb-close-btn" onclick="document.getElementById('scoreboard-panel').classList.remove('show')">✕</button>
    </div>
    <div id="scoreboard-list"></div>
    <div id="scoreboard-guest" style="display:none">
      <a style="cursor:pointer;color:#1a6fd4;text-decoration:underline" onclick="openLoginModal()" id="sb-signin-link">Sign in</a>
      <span id="sb-signin-text"> to see the leaderboard</span>
    </div>
  </div>
</div>

<!-- ── LEARNING PREVIEW BAR ──────────────────────────────────────────────── -->
<div id="learning-preview-bar">
  <span id="learning-preview-msg"></span>
  <span id="learning-preview-count">15</span>
</div>
<div id="learning-big-countdown"></div>

<!-- ── LEARNING RESULTS PANEL ─────────────────────────────────────────────── -->
<div id="learning-results-panel">
  <div id="learning-results-card">
    <div id="lr-emoji" style="font-size:2.2rem">📚</div>
    <h2 id="lr-title" style="margin:4px 0;text-align:center;font-size:1.15rem;line-height:1.3"></h2>
    <div id="lr-subtitle" style="color:var(--muted);font-size:0.88rem;text-align:center;margin-bottom:4px"></div>
    <div id="lr-level-up-banner" style="display:none"></div>
    <div id="lr-list"></div>
    <div class="btn-row" style="flex-direction:column;gap:8px;width:100%;margin-top:10px">
      <button class="btn btn-primary" id="lr-continue-btn" onclick="continueLearning()" style="width:100%">📚 Continue</button>
      <button class="btn-secondary" id="lr-menu-btn" onclick="showMenu()" style="width:100%;text-align:center;padding:9px 16px">← Menu</button>
    </div>
  </div>
</div>

<!-- ── MODALS (placed before script so getElementById works) ────────── -->
<!-- ── NICKNAME VALIDATION POPUP ──────────────────────────────────────────── -->
<div id="nickname-error-popup"></div>

<!-- ── SETTINGS MODAL ─────────────────────────────────────────────────────── -->
<div id="settings-modal">
  <div id="settings-card">
    <button id="settings-modal-close" onclick="closeSettingsModal()">✕</button>
    <h2 id="settings-title">⚙️ Settings</h2>

    <div class="settings-field">
      <label class="settings-label" id="settings-lbl-nickname">Nickname</label>
      <input class="login-input" id="settings-nickname" type="text" placeholder="Your nickname…" maxlength="15" pattern="[A-Za-z0-9_]{1,15}"/>
    </div>

    <div class="settings-field">
      <label class="settings-label" id="settings-lbl-gender">Gender</label>
      <div class="gender-options">
        <button class="gender-btn" data-gender="male"   onclick="selectGender('male')"  id="gender-male">👨 Male</button>
        <button class="gender-btn" data-gender="female" onclick="selectGender('female')" id="gender-female">👩 Female</button>
        <button class="gender-btn" data-gender="other"  onclick="selectGender('other')"  id="gender-other">🧑 Other</button>
      </div>
    </div>

    <div class="settings-field">
      <label class="settings-label" id="settings-lbl-language">Language</label>
      <div class="gender-options">
        <button class="gender-btn" onclick="selectSettingsLang('he')" id="settings-lang-he">🇮🇱 עברית</button>
        <button class="gender-btn" onclick="selectSettingsLang('en')" id="settings-lang-en">🇬🇧 English</button>
      </div>
    </div>

    <div id="settings-save-msg"></div>
  </div>
</div>

<div id="login-modal">
  <div id="login-card" style="position:relative">
    <button id="login-modal-close" onclick="closeLoginModal()">✕</button>
    <h2>🇮🇱 התחברות</h2>
    <p class="login-sub">Save your scores and track your progress</p>

    <button class="btn-google" onclick="signInGoogle()">
      <svg viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.31-8.16 2.31-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
      Continue with Google
    </button>

    <div class="login-divider">or</div>

    <div id="login-form-section">
      <div style="display:flex;flex-direction:column;gap:8px">
        <input class="login-input" id="login-name" type="text" placeholder="Display name" style="display:none"/>
        <input class="login-input" id="login-email" type="email" placeholder="Email address"/>
        <input class="login-input" id="login-password" type="password" placeholder="Password"/>
      </div>
      <div id="login-error"></div>
      <button class="btn-auth-submit" id="login-submit-btn" onclick="submitEmailAuth()">Sign in</button>
      <div id="login-toggle">
        Don't have an account? <a onclick="toggleAuthMode()">Sign up</a>
      </div>
    </div>
  </div>
</div>

<script>
// tier 1 = biggest cities (easy mode)
// tier 2 = medium-sized cities & towns (easy + medium mode)
// tier 3 = smaller towns (all modes, hard only)
const TOWNS = [
  // ── Major Cities — tier 1 ─────────────────────────────────────────────────
  { name:"Tel Aviv",        lat:32.0853, lng:34.7818, region:"Center",    tier:1, desc:"Israel's economic & cultural hub", nameHe:"תל אביב", descHe:"המרכז הכלכלי והתרבותי של ישראל", fact:"Tel Aviv was founded in 1909 when 66 Jewish families held a lottery on the sand dunes to divide plots of land — each family placed a grey shell for their name and a white shell for a plot number. It's also the world's largest contiguous UNESCO-listed Bauhaus city, with over 4,000 Bauhaus buildings.", factHe:"תל אביב היא העיר היחידה בעולם שנבנתה על חול מדברי בידי אנשים שלא ידעו לבנות ערים — רוב המייסדים היו סוחרים וסופרים, לא קבלנים. כיום היא עיר הסטארטאפ לנפש השנייה בעולם, אחרי סן פרנסיסקו." },
  { name:"Jerusalem",       lat:31.7788, lng:35.2258, region:"Jerusalem", tier:1, desc:"Capital city, holy to three religions", nameHe:"ירושלים", descHe:"עיר הבירה, קדושה לשלוש דתות", fact:"Jerusalem has been destroyed and rebuilt at least twice, besieged 23 times, attacked 52 times, and captured 44 times in its 5,000-year history. The Old City sits on bedrock riddled with ancient tunnels — archaeologists estimate less than 5% of it has ever been excavated.", factHe:"ירושלים מוזכרת בתנ\"ך יותר מ-600 פעם, אך שמה המלא אינו מופיע אף פעם — תמיד רק 'ירושלים' או 'ציון'. מתחת לרחובות העיר העתיקה מסתתרת מערכת מנהרות שאורכה הכולל עולה על 6 קילומטרים." },
  { name:"Haifa",           lat:32.7940, lng:34.9896, region:"North",     tier:1, desc:"Major port city on Mount Carmel", nameHe:"חיפה", descHe:"עיר נמל מרכזית על הכרמל", fact:"Haifa is the only city in Israel where public buses run on the Jewish Sabbath, thanks to a historic arrangement with its mixed Jewish-Arab population. It's also home to the world headquarters of the Bahá'í Faith, whose stunning terraced gardens descend Mount Carmel like a green staircase.", factHe:"חיפה היא העיר הישראלית היחידה שבה שוכן מרכז הבהאים הגדול בעולם — הגנים המדורגים שלו נחשבים לאחד מאתרי הגינון היפים ביותר על פני כדור הארץ. הכרמל ניצב עם קצהו ממש בים, תופעה גאוגרפית נדירה בישראל." },
  { name:"Beer Sheva",      lat:31.2457, lng:34.7925, region:"South",     tier:1, desc:"Capital of the Negev desert", nameHe:"באר שבע", descHe:"בירת הנגב", fact:"Beer Sheva is mentioned in the Bible over 30 times and was Abraham's home — he dug a famous well here whose name means 'Well of the Oath' or 'Well of Seven.' The city's ancient Bedouin market, held every Thursday, is one of the largest in the Middle East.", factHe:"באר שבע היא עיר השחמט של ישראל — בה נולדו ופעלו שחמטאים שהציבו את ישראל במקום הגבוה בעולם לנפש. בשוק הבדואי ההיסטורי שלה נמכרו פעם גמלים, מה שהפך אותו לאחד הייחודיים במזרח התיכון." },
  { name:"Rishon LeZion",   lat:31.9636, lng:34.8101, region:"Center",    tier:1, desc:"First city founded during modern Aliyah", nameHe:"ראשון לציון", descHe:"העיר הראשונה שנוסדה בעלייה המודרנית", fact:"Rishon LeZion, founded in 1882, was where the Israeli national anthem Hatikvah was first sung publicly in 1882 — the lyrics were penned by Naphtali Herz Imber while staying there. Its winery, established by Baron Rothschild, was for decades the largest in the Middle East.", factHe:"ראשון לציון מחזיקה ברשת המנהרות הגדולה ביותר בישראל — שנחפרו בתקופת מלחמת העצמאות כדי לאחסן נשק ולחבר מחסנים סמויים. היקב שהקים בה הברון רוטשילד בשנות ה-1880 עדיין פועל כיום." },
  { name:"Petah Tikva",     lat:32.0878, lng:34.8860, region:"Center",    tier:1, desc:"'Mother of the Moshavot'", nameHe:"פתח תקווה", descHe:"אם המושבות", fact:"Petah Tikva was the first modern Jewish agricultural settlement in Ottoman Palestine, founded in 1878 — four years before Rishon LeZion. The early settlers had to abandon it twice due to malaria from the nearby swamps before successfully draining the land and returning.", factHe:"פתח תקווה זכתה לכינוי 'אם המושבות' מפני שקמה לפני כל שאר הערים הציוניות — ב-1878, ארבע שנים לפני ראשון לציון. בית הספר החקלאי הראשון בארץ ישראל המודרנית נפתח בה, ולמדו בו מי שלימים הפכו למנהיגי הציונות." },
  { name:"Ashdod",          lat:31.7957, lng:34.6489, region:"South",     tier:1, desc:"Israel's largest seaport", nameHe:"אשדוד", descHe:"הנמל הגדול ביותר בישראל", fact:"Ancient Ashdod was one of the five great Philistine city-states, and archaeologists have found remains dating back 4,000 years beneath the modern city. Today it handles over 60% of all goods imported into Israel, making it one of the busiest ports in the entire Mediterranean.", factHe:"אשדוד היא אחת הערים הצעירות בישראל — הוקמה רשמית רק ב-1956, אך מתחתיה שכנה אשדוד הפלישתית בת 4,000 השנה. הנמל שלה גדול כל כך שספינות המגיעות אליו נאלצות להמתין בתור של ימים שלמים." },
  { name:"Netanya",         lat:32.3337, lng:34.8600, region:"Center",    tier:1, desc:"Diamond industry & beautiful beaches", nameHe:"נתניה", descHe:"תעשיית היהלומים וחופים יפים", fact:"Netanya became the diamond-polishing capital of the world in the 1940s after Belgian Jewish refugees brought their expertise there fleeing the Nazis. At its peak, 90% of the world's rough diamonds passed through Netanya for cutting and polishing.", factHe:"נתניה קרויה על שם נתן שטראוס, יהודי אמריקאי עשיר שתרם לבניית תשתיות הבריאות בארץ ישראל. חופה ארוך כל כך — 14 קילומטרים — עד שהוא הגדול בכל עיר ישראלית." },
  { name:"Eilat",           lat:29.5569, lng:34.9498, region:"South",     tier:1, desc:"Resort city on the Red Sea", nameHe:"אילת", descHe:"עיר נופש על ים סוף", fact:"Eilat sits at the northern tip of the Red Sea where Israel, Jordan, Egypt and Saudi Arabia nearly meet — you can see all four countries from the beach on a clear day. Its coral reefs are among the most northerly in the world, and uniquely, they appear resistant to climate-change bleaching.", factHe:"אילת היא העיר הישראלית היחידה הגובלת בארבע מדינות — ישראל, ירדן, מצרים וערב הסעודית — ואפשר לראות את כולן מרחבת הנמל ביום בהיר. שונית האלמוגים שלה היא מהצפוניות בעולם." },
  { name:"Holon",           lat:32.0160, lng:34.7860, region:"Center",    tier:1, desc:"Industrial city and children's museum hub", nameHe:"חולון", descHe:"עיר תעשייתית ומרכז מוזיאוני לילדים", fact:"Holon deliberately reinvented itself as 'the children's city of Israel,' building the country's first dedicated children's museum and commissioning giant colorful sculptures throughout the city. It's also the only city in Israel that holds an annual Purim carnival parade that draws hundreds of thousands of visitors.", factHe:"חולון בנתה את עצמה מחדש כ'עיר הילדים' — יש בה יותר גנים ציבוריים לנפש מכל עיר אחרת בישראל. מוזיאון הילדים שלה היה הראשון מסוגו בארץ, והיה כה מצליח שהפך למודל עבור מוזיאוני ילדים בעולם כולו." },
  { name:"Bnei Brak",       lat:32.0874, lng:34.8324, region:"Center",    tier:1, desc:"Ultra-Orthodox Jewish city near Tel Aviv", nameHe:"בני ברק", descHe:"עיר חרדית בסמוך לתל אביב", fact:"Bnei Brak has one of the highest population densities in the world — over 22,000 people per square kilometer — denser than Manhattan. On Yom Kippur, the streets fill entirely with cyclists since virtually no cars drive, creating one of the most unusual urban scenes in Israel.", factHe:"בני ברק היא אחת הערים הצפופות בעולם — יותר מ-22,000 איש לקילומטר מרובע, צפופה יותר ממנהטן. ביום כיפור, כשרוב התושבים מתענים ואינם נוסעים, הרחובות מתמלאים לגמרי ברוכבי אופניים." },
  { name:"Bat Yam",         lat:32.0155, lng:34.7505, region:"Center",    tier:1, desc:"Coastal city south of Tel Aviv", nameHe:"בת ים", descHe:"עיר חוף דרומית לתל אביב", fact:"Bat Yam means 'Daughter of the Sea' in Hebrew, and it was once nicknamed 'Little Moscow' due to the enormous wave of Russian-speaking immigrants who settled there in the 1990s, fundamentally transforming its culture, food scene, and language on the street.", factHe:"בת ים קיבלה את שמה מהים שלצדה — 'בת הים'. בשנות ה-90 הפכה לאחת הערים עם הריכוז הגבוה ביותר של עולים מברית המועצות לשעבר, עד שהרוסית נשמעה ברחוב יותר מאשר עברית." },
  { name:"Ramat Gan",       lat:32.0687, lng:34.8247, region:"Center",    tier:1, desc:"Home of the Israel Diamond Exchange", nameHe:"רמת גן", descHe:"הבורסה ליהלומים", fact:"The Israel Diamond Exchange in Ramat Gan is the world's largest diamond trading complex — a city within a city where billions of dollars of gems are traded daily, and where handshakes still seal multi-million-dollar deals based on trust alone. Ramat Gan also has one of Israel's only wildlife safari parks, home to white rhinos and giraffes.", factHe:"בבורסה ליהלומים ברמת גן, הגדולה בעולם, עסקאות במיליוני דולרים נסגרות בלחיצת יד ובמילה 'מזל וברכה' — ללא חוזים כתובים. הספארי של רמת גן הוא היחיד מחוץ לאפריקה שבו חיים קרנפי לבן בשטח פתוח." },
  { name:"Ashkelon",        lat:31.6688, lng:34.5742, region:"South",     tier:1, desc:"Ancient coastal city with rich history", nameHe:"אשקלון", descHe:"עיר חוף עתיקה עם היסטוריה עשירה", fact:"Ashkelon contains one of the oldest known dog cemeteries in the world — a 2,500-year-old Persian-era burial site where over 700 dogs were interred with care, suggesting they were sacred animals. The city also gave the world the word 'scallion' — the wild onion (Allium ascalonicum) was named after Ascalon, the ancient name for Ashkelon.", factHe:"אשקלון עתיקה כל כך עד שמתחת לשכונותיה המודרניות נמצאו שרידי 20 ערים שונות שישבו זו על גבי זו. מהעיר הפלישתית אשקלון הגיע שמו של הירק 'אשלוט' — הבצל הקטן שגדל בה פעם בשפע." },
  { name:"Rehovot",         lat:31.8953, lng:34.8106, region:"Center",    tier:1, desc:"Home of the Weizmann Institute of Science", nameHe:"רחובות", descHe:"בית מכון ויצמן למדע", fact:"The Weizmann Institute in Rehovot is home to one of Israel's most unusual landmarks: the grave of Israel's first president, Chaim Weizmann, is located in the institute's rose garden, where he asked to be buried. The institute also once housed one of the world's first computers outside the US, built in 1954.", factHe:"במכון ויצמן ברחובות נבנה ב-1954 אחד המחשבים הראשונים מחוץ לארה\"ב — כינויו היה 'ויצמק'. בגן הוורדים של המכון קבור חיים ויצמן, הנשיא הראשון, לפי רצונו האישי." },
  { name:"Herzliya",        lat:32.1677, lng:34.8308, region:"Center",    tier:1, desc:"Israel's tech hub & upscale marina", nameHe:"הרצליה", descHe:"מרכז ההייטק ומרינה של ישראל", fact:"Herzliya's 'Silicon Wadi' tech park spawned more Nasdaq-listed companies per capita than almost any place on Earth in the 2000s. The city is named after Theodor Herzl, the founder of modern Zionism, who never actually set foot in Israel — he died in 1904, four years before Herzliya was founded.", factHe:"הרצליה נקראת על שם תיאודור הרצל, שלא דרך מעולם על אדמת ישראל — הוא נפטר ב-1904, ארבע שנים לפני הקמת העיר. בפארק ההייטק שלה יש יותר חברות הנסחרות בנאסד\"ק לנפש מכמעט כל מקום אחר בעולם." },
  { name:"Hadera",          lat:32.4350, lng:34.9190, region:"Center",    tier:1, desc:"Industrial city with Nahal Hadera nature reserve", nameHe:"חדרה", descHe:"עיר תעשייתית עם שמורת נחל חדרה", fact:"Hadera was founded in 1891 on malaria-ridden swampland so deadly that nearly half the original settlers died within a few years. The survivors transformed it by planting 1.5 million eucalyptus trees imported from Australia to drain the swamps — an early and dramatic feat of ecological engineering.", factHe:"חדרה נוסדה על ביצות עמוסות מלריה שהרגו כמחצית ממייסדיה הראשונים. כדי לנצח את המחלה, שתלו המתיישבים 1.5 מיליון עצי אקליפטוס שייבשו את הביצות — מה שהפך את האזור לאחד מגדולי פלאי ההנדסה הסביבתית של התקופה." },
  { name:"Nazareth",        lat:32.7046, lng:35.2972, region:"North",     tier:1, desc:"Largest Arab city in Israel", nameHe:"נצרת", descHe:"העיר הערבית הגדולה בישראל", fact:"Nazareth's Old City contains the Basilica of the Annunciation, the largest church in the Middle East, built over the traditional site of Mary's home. Despite being central to Christianity, Nazareth is today a predominantly Muslim city, with a significant Christian Arab minority living side by side.", factHe:"נצרת היא העיר הערבית הגדולה בישראל ומרכז הנצרות בארץ הקודש — אך דווקא מסגד מהמאה ה-18 שוכן בסמוך לאתר שבו, לפי המסורת, בישר המלאך גבריאל. האוכלוסייה הנוצרית בה הולכת ומתכווצת, וכיום היא בעיקר מוסלמית." , arabVillage: true },
  { name:"Tiberias",        lat:32.7939, lng:35.5329, region:"North",     tier:1, desc:"City on the shores of the Sea of Galilee", nameHe:"טבריה", descHe:"עיר על חוף הכנרת", fact:"Tiberias sits at about 200 meters below sea level — among the lowest cities on Earth — on the shores of the Sea of Galilee, which is itself Israel's only freshwater lake and primary drinking water reservoir. It's one of Judaism's four holy cities, and the Jerusalem Talmud was compiled here in the 4th century CE.", factHe:"טבריה יושבת כ-200 מטר מתחת לפני הים — אחת הערים הנמוכות בעולם — על גדות הכנרת, מקור המים המתוקים הגדול של ישראל. בה נחתם התלמוד הירושלמי במאה ה-4 לספירה, והיא נחשבת לאחת מארבע הערים הקדושות ביהדות." },

  // ── Medium Cities & Towns — tier 2 ───────────────────────────────────────
  { name:"Modi'in",         lat:31.8969, lng:35.0095, region:"Jerusalem", tier:2, desc:"Israel's fastest-growing planned city", nameHe:"מודיעין", descHe:"העיר המתוכננת הצומחת ביותר בישראל", fact:"Modi'in is built near the ancient hometown of the Maccabees, the priestly family whose revolt is celebrated on Hanukkah — the actual tomb of Mattathias the Hasmonean is believed to be just outside the city. When founded in 1996, it was planned from scratch on a drawing board, designed to be a model Israeli city of the future.", factHe:"מודיעין נבנתה החל מ-1996 לחלוטין על השרטוט — ללא שכונות ישנות, ללא עיר עתיקה. היא ממוקמת ממש על אדמת מודיעין המקראית, מוצא המכבים, ועיריית מודיעין מדליקה בחנוכה אבוקה בקבר מתתיהו שנמצא בתחומה." },
  { name:"Beit Shemesh",    lat:31.7459, lng:34.9888, region:"Jerusalem", tier:2, desc:"Growing city in the Judean foothills", nameHe:"בית שמש", descHe:"עיר צומחת ברגלי הרי יהודה", fact:"Ancient Beit Shemesh is where, according to the Bible, the Philistines returned the Ark of the Covenant after capturing it — then 70 men were struck dead for looking inside it. The modern city has grown explosively, tripling in population in just 20 years, driven largely by ultra-Orthodox and Anglo immigration.", factHe:"בית שמש המודרנית גדלה פי שלושה בתוך עשרים שנה בלבד, בין השאר בזכות עלייה מארצות אנגלוסכסיה. ממש בשולי העיר נמצא האתר שבו, לפי המקרא, החזירו הפלישתים את ארון הברית לישראל." },
  { name:"Ma'ale Adumim",   lat:31.7769, lng:35.2983, region:"Jerusalem", tier:2, desc:"Large city east of Jerusalem", nameHe:"מעלה אדומים", descHe:"עיר גדולה מזרחית לירושלים", fact:"Ma'ale Adumim is built on the edge of the Judean Desert and sits along the ancient Roman road from Jerusalem to Jericho — the very road scholars believe Jesus referred to in the parable of the Good Samaritan. The city gets its name from the red-clay soil of the surrounding hills.", factHe:"מעלה אדומים שוכנת על הדרך הרומית העתיקה מירושלים ליריחו — הדרך שבה, לפי החוקרים, התרחש משל השומרוני הטוב. שמה נגזר מאדמת הטרה-רוסה האדומה-חמר של הגבעות הסובבות אותה." },
  { name:"Nahariya",        lat:33.0063, lng:35.0946, region:"North",     tier:2, desc:"Northernmost coastal city in Israel", nameHe:"נהריה", descHe:"העיר החוף הצפונית ביותר בישראל", fact:"Nahariya was founded in 1934 by German Jewish refugees fleeing the Nazis, who brought their Central European culture with them — for decades its cafés and bakeries had a distinctly German character, and German was widely spoken on its streets. A small river, the Ga'aton, runs through the center of town in an open channel, an unusual feature unique in Israel.", factHe:"נהריה הוקמה ב-1934 בידי פליטים יהודים מגרמניה, שהביאו איתם את תרבותם האירופית — ריח הקפה הגרמני והלחמניות האפויות ריחף ברחובות לדורות. נחל הגעתון, הזורם במרכז העיר בתעלה פתוחה, הוא תופעה ייחודית בישראל." },
  { name:"Akko",            lat:32.9282, lng:35.07560, region:"North",     tier:2, desc:"UNESCO-listed ancient Crusader port city", nameHe:"עכו", descHe:"עיר נמל צלבנית עתיקה ברשימת אונסקו", fact:"Beneath the streets of Akko's Old City lies a nearly complete Crusader city from the 12th century, preserved underground when the Mamluks built directly on top of it in 1291. Napoleon besieged Akko in 1799 but failed to capture it — he later said that if Akko had fallen, he would have conquered the entire East.", factHe:"מתחת לרחובות עכו העתיקה שוכנת עיר צלבנית שלמה מהמאה ה-12, שמורה כמעט בשלמותה מתחת לבנייה העות'מאנית. נפוליאון צר על עכו ב-1799 אך נכשל — והיא נותרת אחת הערים המבוצרות שעמדו בפני כיבושיו." },
  { name:"Safed",           lat:32.9646, lng:35.5025, region:"North",     tier:2, desc:"Ancient center of Jewish mysticism (Kabbalah)", nameHe:"צפת", descHe:"מרכז הקבלה והמיסטיקה היהודית", fact:"In the 16th century, Safed became the world capital of Kabbalah mysticism and Jewish law — Rabbi Joseph Karo wrote the Shulchan Aruch (the definitive code of Jewish law) here, and it was the first city in the Middle East to have a printing press. Safed is also considered one of Judaism's four holiest cities.", factHe:"צפת היא העיר הגבוהה ביותר בישראל, בגובה כ-900 מטר, ובמאה ה-16 הייתה עיר הקבלה הגדולה בעולם. בה הוקם בית הדפוס הראשון במזרח התיכון ב-1577, ורבי יוסף קארו כתב בה את השולחן ערוך." },
  { name:"Nof HaGalil",     lat:32.7023, lng:35.31830, region:"North",     tier:2, desc:"Jewish city in the Galilee, formerly Nazareth Illit", nameHe:"נוף הגליל", descHe:"עיר יהודית בגליל, לשעבר נצרת עילית", fact:"Nof HaGalil was established in 1957 as 'Nazareth Illit' (Upper Nazareth) on the hills above Arab Nazareth, part of a policy to 'Judaize the Galilee.' The city officially changed its name in 2019 to shed its controversial founding identity, but the name change sparked fierce debate and the city remains deeply connected to its complex origins.", factHe:"נוף הגליל הוקמה ב-1957 כ'נצרת עילית' על הגבעות מעל נצרת הערבית, כחלק ממדיניות 'ייהוד הגליל'. העיר שינתה רשמית את שמה ב-2019 כדי להיפטר מזהותה המייסדת השנויה במחלוקת, אך שינוי השם עורר ויכוח עז." },
  { name:"Karmiel",         lat:32.9159, lng:35.2934, region:"North",     tier:2, desc:"Development town in the Galilee", nameHe:"כרמיאל", descHe:"עיר פיתוח בגליל", fact:"Karmiel hosts the largest Israeli folk-dance festival in the world every summer — three days of non-stop dancing that draws over 250,000 participants and spectators from dozens of countries. The city was founded in 1964 as part of a government effort to settle Jews in the predominantly Arab Galilee region.", factHe:"כרמיאל מארחת כל קיץ את פסטיבל המחול הגדול בישראל — שלושה ימים של ריקודי עם המושכים למעלה מ-250,000 משתתפים מ-50 מדינות שונות. העיר הוקמה ב-1964 כדי להגביר את הנוכחות היהודית בגליל." },
  { name:"Afula",           lat:32.6091, lng:35.2857, region:"North",     tier:2, desc:"Capital of the Jezreel Valley", nameHe:"עפולה", descHe:"בירת עמק יזרעאל", fact:"Afula sits in the Jezreel Valley, which the Book of Revelation identifies as the site of the battle of Armageddon — 'Har Megiddo' (Mount Megiddo) is just a few kilometers away. The ancient site of Megiddo was strategically crucial for 5,000 years, and archaeologists have found evidence of 26 distinct layers of civilization there.", factHe:"עפולה שוכנת בלב עמק יזרעאל — העמק שספר ההתגלות מזהה כזירת קרב הארמגדון העתידי. תל מגידו, שממנו שאוב השם 'ארמגדון' (הר מגידו), נמצא כמה קילומטרים בלבד ממנה." },
  { name:"Kiryat Shmona",   lat:33.2075, lng:35.5706, region:"North",     tier:2, desc:"Northernmost major city in Israel", nameHe:"קריית שמונה", descHe:"העיר הגדולה הצפונית ביותר בישראל", fact:"Kiryat Shmona is named for the 'Eight' — the Hebrew word 'shmona' means eight — in memory of Joseph Trumpeldor and seven comrades who died defending nearby Tel Hai in 1920. The city has absorbed more Katyusha rocket fire than any other Israeli city, having been bombarded in almost every Lebanon conflict since the 1970s.", factHe:"שם העיר 'קריית שמונה' ניתן לזכר שמונת הנופלים בקרב תל חי ב-1920, ובראשם יוסף טרומפלדור. היא ספגה יותר רקטות מכל עיר ישראלית אחרת, ובכל זאת מתאפיינת ברוח קהילתית חזקה." },
  { name:"Umm al-Fahm",     lat:32.5158, lng:35.1525, region:"North",     tier:2, desc:"Largest Arab city in the Triangle region", nameHe:"אום אל-פחם", descHe:"העיר הערבית הגדולה באזור המשולש", fact:"Umm al-Fahm, meaning 'Mother of Charcoal' in Arabic, earned its name from the charcoal industry that historically dominated the region. In 2000, Israeli Arab leader Raed Salah led a general strike from here that became a defining moment in Arab-Israeli political history, known as the 'October events.'", factHe:"אום אל-פחם פירושה בערבית 'אם הפחם', שם שמקורו בתעשיית הפחם שהייתה מרכזית לאזור. היא אחת הערים הערביות הגדולות בישראל, וב-2000 הפכה למוקד אירועי 'אוקטובר' שסימנו נקודת מפנה ביחסים בין ערבים ליהודים בישראל." , arabVillage: true },
  { name:"Kfar Saba",       lat:32.1802, lng:34.9181, region:"Center",    tier:2, desc:"Affluent city in the Sharon region", nameHe:"כפר סבא", descHe:"עיר אמידה באזור השרון", fact:"Kfar Saba is built on the site of ancient Capharsaba, mentioned in the writings of the Jewish historian Josephus. The city was revived in 1903 and holds the unusual distinction of having been briefly abandoned and re-established — early settlers fled Bedouin pressure before returning a few years later.", factHe:"כפר סבא בנויה על שטח כפר סבא המקראית, המוזכרת אצל יוספוס פלביוס. היישוב נוסד ב-1903 ואוכלוסייתו ננטשה וחזרה אליה מספר פעמים לפני שהתבססה סופית." },
  { name:"Ra'anana",        lat:32.1860, lng:34.8678, region:"Center",    tier:2, desc:"Prosperous city with many English speakers", nameHe:"רעננה", descHe:"עיר שגשוגית עם קהילה אנגלו-סכסית גדולה", fact:"Ra'anana has such a large community of English-speaking immigrants that it's sometimes jokingly called 'the most American city in Israel' — it even has a baseball league. The city consistently ranks as one of Israel's most livable, and its high standard of living has attracted waves of South African, British, and North American aliyah.", factHe:"רעננה מכונה לעיתים 'העיר האנגלו-סכסית של ישראל' — יש בה ליגת בייסבול, קהילות דוברות אנגלית ענקיות, ובתי קפה שמגישים סקונס בריטיים. היא מדורגת בעקביות בדירוגים הגבוהים של איכות חיים בכל הסקרים." },
  { name:"Lod",             lat:31.9489, lng:34.8885, region:"Center",    tier:2, desc:"Mixed city next to Ben Gurion Airport", nameHe:"לוד", descHe:"עיר מעורבת בסמוך לנמל בן גוריון", fact:"Lod (ancient Lydda) is the traditional burial place of Saint George — yes, the patron saint of England — who according to tradition was born there. The city also contains one of the most spectacular ancient mosaic floors ever found in Israel, a 1,700-year-old Roman villa floor discovered in 1996 by workers paving a road.", factHe:"לוד, העתיקה 'לידא', היא המקום שבו קבור לפי המסורת הנוצרית גיאורג הקדוש — פטרון אנגליה. בסמוך לה נמצאה ב-1996 רצפת פסיפס רומית מהמאה ה-3, אחת המרהיבות שנחשפו אי פעם בישראל." },
  { name:"Ramla",           lat:31.9260, lng:34.8707, region:"Center",    tier:2, desc:"One of the few cities founded by Arabs", nameHe:"רמלה", descHe:"אחת הערים הבודדות שנוסדה בידי ערבים", fact:"Ramla is the only city in Israel founded by Arabs — established in 716 CE by the Umayyad caliph Suleiman ibn Abd al-Malik, who was born there. Its stunning White Tower, a 9th-century minaret, still dominates the skyline, and beneath the city lies a vast 8th-century cistern so large you can tour it by boat.", factHe:"רמלה היא העיר היחידה בישראל שנוסדה בידי ערבים — הח'ליף האומיי סולימאן אבן עבד אל-מאלכ הקים אותה ב-716 לספירה. מתחתיה מסתתר מאגר מים עות'מאני עצום מהמאה ה-8, שניתן לסייר בו בסירה." },
  { name:"Nes Ziona",       lat:31.9296, lng:34.7991, region:"Center",    tier:2, desc:"City in the central coastal plain", nameHe:"נס ציונה", descHe:"עיר במישור החוף המרכזי", fact:"Nes Ziona was the first place in modern Israel to fly the Zionist flag — in 1891, settlers hoisted a blue-and-white flag over the town, predating Herzl's first Zionist Congress by six years. The city is also home to Israel's biological and chemical weapons research institute, IIBR, whose existence was officially unacknowledged for decades.", factHe:"נס ציונה היא המקום הראשון שבו הונף דגל ציוני בארץ ישראל המודרנית — ב-1891, שש שנים לפני הקונגרס הציוני הראשון של הרצל. בה שוכן גם המכון הביולוגי הישראלי, IIBR, שקיומו לא אושר רשמית עשרות שנים." },
  { name:"Rosh HaAyin",     lat:32.0953, lng:34.9533, region:"Center",    tier:2, desc:"City on the Yarkon River headwaters", nameHe:"ראש העין", descHe:"עיר על ראשי נחל הירקון", fact:"Rosh HaAyin sits at the source of the Yarkon River, the water source that the Ottomans and British both relied on to supply Jerusalem and coastal cities. In the 1950s it absorbed a massive wave of Yemenite Jewish immigrants — today it has the highest concentration of Yemenite Jewish heritage of any Israeli city.", factHe:"ראש העין יושבת על מוצאות נחל הירקון, שמימיו שימשו את הרומאים, הצלבנים והבריטים לאספקת מים לירושלים. בשנות ה-50 קלטה גל עצום של עולים תימנים, והיא כיום בעלת הריכוז הגבוה ביותר של מורשת יהדות תימן בישראל." },
  { name:"Dimona",          lat:31.0687, lng:35.0366, region:"South",     tier:2, desc:"Desert development town in the Negev", nameHe:"דימונה", descHe:"עיירת פיתוח מדברית בנגב", fact:"Near Dimona lies the Negev Nuclear Research Center, Israel's open secret — a facility never officially acknowledged but widely understood to be the site of Israel's nuclear weapons program. The whistleblower Mordechai Vanunu worked there before leaking details to the British press in 1986 and spending 18 years in prison.", factHe:"בסמוך לדימונה שוכן הכור הגרעיני הישראלי — 'הכיפה האדומה' — שישראל אינה מאשרת ואינה מכחישה את קיומו. מרדכי ואנונו, שחשף את הסוד לעיתונות הבריטית ב-1986, ישב 18 שנה בכלא בעקבות כך." },
  { name:"Arad",            lat:31.2600, lng:35.1951, region:"South",     tier:2, desc:"Planned city with stunning Dead Sea views", nameHe:"ערד", descHe:"עיר מתוכננת עם נוף מרהיב לים המלח", fact:"Arad was purpose-built in 1962 as a 'city of the future' by architects who designed it on a clean grid to maximize desert living. The city's high, dry desert air has made it a haven for asthma sufferers — doctors have been prescribing 'move to Arad' to patients for decades, giving it an unusually high proportion of residents with respiratory conditions.", factHe:"ערד תוכננה ב-1962 בידי אדריכלים שביקשו לשמר את עקרונות הבנייה המדברית — בנייה נמוכה, רחובות צרים לצל, וגגות שטוחים. האוויר היבש שלה הפך אותה ל'בית מרשם' לחולי אסתמה, ורבים עברו אליה בהמלצת רופאים." },
  { name:"Kiryat Gat",      lat:31.6094, lng:34.7712, region:"South",     tier:2, desc:"Development town in the northern Negev", nameHe:"קריית גת", descHe:"עיירת פיתוח בצפון הנגב", fact:"Kiryat Gat sits near the ancient city of Gath — the biblical home of Goliath the Philistine giant. Intel built one of its largest chip fabrication plants here in the 1990s, transforming a struggling development town into a major high-tech manufacturing hub and single-handedly reshaping its economy.", factHe:"קריית גת יושבת ממש סמוך לגת הפלישתית — עיר גלית הגיבור. מפעל אינטל שנפתח בה בשנות ה-90 הפך את העיירה המתקשה לאחת ממרכזי ייצור השבבים המתקדמים בעולם." },
  { name:"Sderot",          lat:31.5240, lng:34.5966, region:"South",     tier:2, desc:"Resilient city near the Gaza border", nameHe:"שדרות", descHe:"עיר חוסן בסמוך לגבול עזה", fact:"Sderot has been struck by more rocket fire than any other Israeli city — over 15,000 rockets and mortars since 2001, giving residents just 15 seconds warning to reach a shelter when the alarm sounds. Despite this, the city has become famous for its music scene, producing a disproportionate number of Israel's top musicians and being dubbed 'the Nashville of Israel.'", factHe:"שדרות ספגה מאז 2001 למעלה מ-15,000 רקטות ופגזים, ותושביה חיים עם '15 שניות למקלט'. למרות זאת, העיר ידועה בזכות סצנת המוזיקה הענפה שלה, ומכונה לעיתים 'נאשוויל של ישראל'." },
  { name:"Rahat",           lat:31.3934, lng:34.75470, region:"South",     tier:2, desc:"Largest Bedouin city in the world", nameHe:"רהט", descHe:"העיר הבדואית הגדולה בעולם", fact:"Rahat was established in 1972 as part of Israel's effort to settle the traditionally nomadic Negev Bedouin into permanent towns. Today it's the largest Bedouin city in the world and one of Israel's fastest-growing cities, yet it remains the poorest municipality in the country — a stark contrast to the wealth of nearby Beer Sheva.", factHe:"רהט היא העיר הבדואית הגדולה בעולם, ואחת הצומחות ביותר בישראל. היא הוקמה ב-1972 כדי להעביר את הבדואים להתיישבות קבע, ועד היום עומדת בניגוד חד לעושרה של באר שבע הסמוכה." , arabVillage: true },
  { name:"Mitzpe Ramon",    lat:30.6120, lng:34.8012, region:"South",     tier:2, desc:"Town overlooking the spectacular Ramon Crater", nameHe:"מצפה רמון", descHe:"עיירה המשקיפה על מכתש רמון", fact:"The Ramon Crater (Makhtesh Ramon) is the world's largest 'makhtesh' — a geological formation unique to the Negev and Sinai, created by erosion rather than meteor impact, unlike similar-looking craters elsewhere. Israeli astronaut Ilan Ramon, who died in the Space Shuttle Columbia disaster in 2003, took his surname from this crater — 'Ramon' means 'high' or 'exalted' in Hebrew.", factHe:"מצפה רמון שוכנת על שפת מכתש רמון — המכתש הגדול בעולם מסוגו, שנוצר מסחף ולא ממטאוריט. העיר קרויה על שם אילן רמון, האסטרונאוט הישראלי שנספה באסון מעבורת קולומביה ב-2003." },
  { name:"Zichron Ya'akov", lat:32.5712, lng:34.9530, region:"North",     tier:2, desc:"Historic wine-country town on the Carmel ridge", nameHe:"זכרון יעקב", descHe:"עיירה היסטורית על הכרמל עם יין מפורסם", fact:"Zichron Ya'akov is home to Carmel Winery, established in 1892 with funding from Baron Edmond de Rothschild — it was one of the first modern wineries in the Middle East and helped establish Israel's wine industry. The town was also the base of NILI, a secret Jewish spy ring that passed intelligence to the British against the Ottomans during WWI.", factHe:"זכרון יעקב היא מרכז יקב כרמל, שהוקם ב-1892 בתמיכת הברון אדמונד דה רוטשילד ועדיין מייצר יין. העיר שימשה גם בסיס לרשת הריגול 'ניל\"י' שסייעה לבריטים במלחמת העולם הראשונה נגד העות'מאנים." },
  { name:"Shfar'am",        lat:32.8056, lng:35.1684, region:"North",     tier:2, desc:"Mixed Muslim-Christian-Druze city in Galilee", nameHe:"שפרעם", descHe:"עיר מעורבת מוסלמים-נוצרים-דרוזים בגליל", fact:"Shfar'am is one of the very few cities in Israel where Muslims, Christians, and Druze have coexisted in the same municipality for centuries without significant conflict — a fact locals take great pride in. It contains one of the oldest functioning churches in Israel, continuously active since the Byzantine period.", factHe:"שפרעם היא אחת הערים הנדירות שבהן מוסלמים, נוצרים ודרוזים חיים יחד באותה עירייה מאות שנים — ומתגאים בכך. כנסייתה הקדומה פועלת ללא הפסקה מאז התקופה הביזנטית." , arabVillage: true },
  { name:"Tayibe",          lat:32.2999, lng:34.9881, region:"Center",    tier:2, desc:"Arab city in the central Triangle", nameHe:"טייבה", descHe:"עיר ערבית במשולש המרכזי", fact:"Tayibe is best known in Israel for its beer — the Taybeh Brewery, actually just across the border in the West Bank town of Taybeh, is often confused with it, but Tayibe Israel has its own strong identity. The city was at the center of the 'Triangle' — the dense cluster of Arab towns along the Green Line that Israel nearly transferred to Palestinian Authority control in peace negotiations.", factHe:"טייבה ממוקמת בלב 'המשולש' — הצביר הצפוף של ערים ערביות לאורך הקו הירוק. העיר נידונה בשיחות שלום שונות כחלק מהשטח שיוחלף עם הרשות הפלסטינית." , arabVillage: true },

  { name:"Mevaseret Zion",  lat:31.8040, lng:35.1570, region:"Jerusalem", tier:2, desc:"Affluent suburb on the western hills of Jerusalem", nameHe:"מבשרת ציון", descHe:"פרבר אמיד על גבעות ירושלים המערביות", fact:"Mevaseret Zion sits on the ridge that guards the western approach to Jerusalem, and the ruins of the Crusader castle of Aqua Bella lie within its boundaries. The town absorbed thousands of Georgian and Ethiopian Jewish immigrants in the 1990s, transforming from a small commuter suburb into one of the fastest-growing communities in the Jerusalem corridor.", factHe:"מבשרת ציון שוכנת על הרכס השומר על הכניסה המערבית לירושלים, ובשטחה שוכנות חורבות הטירה הצלבנית 'אקווה בלה'. העיר קלטה אלפי עולים מגאורגיה ואתיופיה בשנות ה-90, והפכה מפרבר קטן לאחת הקהילות הצומחות ביותר במסדרון ירושלים." },
  { name:"Ariel",           lat:32.1057, lng:35.1674, region:"West Bank",  tier:2, desc:"Large Israeli city in the heart of Samaria", nameHe:"אריאל", descHe:"עיר ישראלית גדולה בלב השומרון", fact:"Ariel was founded in 1978 on a hill in the Samarian highlands and grew into the largest Israeli city in the West Bank, with a full university, hospital, and sports stadium. Its location — roughly 20 kilometers east of the Green Line — places it deep inside the West Bank, making it a central point of contention in any peace negotiation over borders.", factHe:"אריאל נוסדה ב-1978 על גבעה בגבעות השומרון וצמחה לעיר הישראלית הגדולה ביהודה ושומרון, עם אוניברסיטה מלאה, בית חולים ואצטדיון ספורט. מיקומה — כ-20 קילומטרים מזרחית לקו הירוק — הופך אותה לנקודת מחלוקת מרכזית בכל משא ומתן שלום." },
  { name:"Giv'at Shmuel",   lat:32.0764, lng:34.8520, region:"Center",    tier:2, desc:"Affluent suburb between Tel Aviv and Petah Tikva", nameHe:"גבעת שמואל", descHe:"פרבר אמיד בין תל אביב לפתח תקווה", fact:"Giv'at Shmuel is named after Samuel Mohilever, one of the founders of Religious Zionism, and has evolved into one of Israel's most sought-after addresses for religious professionals. Despite being tiny — just 3.5 square kilometers — it houses Bar-Ilan University's campus edge and its real estate prices rival central Tel Aviv.", factHe:"גבעת שמואל קרויה על שם שמואל מוהיליבר, מאבות הציונות הדתית, והפכה לאחת הכתובות המבוקשות ביותר לאנשי מקצוע דתיים בישראל. למרות שטחה הזעיר — 3.5 קמ\"ר בלבד — שוכן בשוליה קמפוס אוניברסיטת בר אילן ומחירי הנדל\"ן שלה מתחרים במרכז תל אביב." },
  { name:"Shoham",          lat:32.0005, lng:34.9465, region:"Center",    tier:2, desc:"Planned community between Tel Aviv and Jerusalem", nameHe:"שוהם", descHe:"עיר מתוכננת בין תל אביב לירושלים", fact:"Shoham was deliberately planned in the 1990s as a balanced, car-friendly community with wide roads and greenery, drawing heavily from suburban American design philosophies. It grew from nothing to over 22,000 residents in under two decades, making it one of the fastest-growing planned communities in Israeli history.", factHe:"שוהם תוכננה בכוונה בשנות ה-90 כקהילה מאוזנת וידידותית לרכב, עם כבישים רחבים ושטחי ירק, תוך השראה מהפרברים האמריקאיים. היא צמחה מאפס לכ-22,000 תושבים בפחות משני עשורים — אחת הקהילות המתוכננות שצמחו הכי מהר בישראל." },
  { name:"Omer",            lat:31.2678, lng:34.8513, region:"South",     tier:2, desc:"Affluent suburb north of Beer Sheva", nameHe:"עומר", descHe:"פרבר אמיד צפונית לבאר שבע", fact:"Omer is one of Israel's wealthiest local councils — a stark island of affluence sitting directly next to Beer Sheva, one of the country's largest cities. It is home to a disproportionate number of senior IDF officers, defense industry executives, and Ben-Gurion University professors who want Beer Sheva's amenities without its urban character.", factHe:"עומר היא אחת המועצות המקומיות העשירות ביותר בישראל — אי של שגשוג הגובל ישירות בבאר שבע הגדולה. בה מרוכזים קציני צבא בכירים, מנהלי תעשיית הביטחון ופרופסורים מאוניברסיטת בן גוריון." },
  { name:"Gan Yavne",       lat:31.7871, lng:34.7097, region:"Center",    tier:2, desc:"City in the coastal plain between Ashdod and Rehovot", nameHe:"גן יבנה", descHe:"עיר במישור החוף בין אשדוד לרחובות", fact:"Gan Yavne was established in 1931 by pioneers who drained the local swamps — the town's name literally means 'Garden of Yavne.' Its proximity to both Ashdod port and Ben Gurion Airport has made it a hub for logistics workers, and it has quietly grown into one of the more prosperous midsize cities in the southern coastal plain.", factHe:"גן יבנה הוקמה ב-1931 על ידי חלוצים שניקזו את הביצות המקומיות — שמה פירושו 'גן יבנה'. קרבתה לנמל אשדוד ולנמל בן גוריון הפכה אותה למרכז לוגיסטי, והיא צמחה בשקט לאחת הערים הבינוניות המשגשגות של מישור החוף הדרומי." },
  { name:"Yehud",           lat:32.0332, lng:34.8908, region:"Center",    tier:2, desc:"Historic city next to Ben Gurion Airport", nameHe:"יהוד", descHe:"עיר היסטורית בסמוך לנמל בן גוריון", fact:"Yehud, ancient Jehud, is mentioned in the Bible in the territory of Dan, making it one of the oldest continuously named localities in Israel. Today its residents live with the constant roar of aircraft from Ben Gurion Airport, whose main runway ends just a kilometer from the town — leading to decades of debate over expansion and compensation.", factHe:"יהוד, 'יהוד' המקראית, מוזכרת בתנ\"ך בנחלת שבט דן — מהישובים הוותיקים ביותר בשם רציף בישראל. כיום תושביה חיים עם רעש המטוסים הנמשך מנמל בן גוריון, שסוף מסלולו הראשי נמצא קילומטר אחד בלבד מהעיר." },
  { name:"Harish",          lat:32.4596, lng:35.0511, region:"Center",    tier:2, desc:"Israel's newest planned city in the Wadi Ara corridor", nameHe:"חריש", descHe:"העיר המתוכננת החדשה ביותר בישראל, במסדרון ואדי ערה", fact:"Harish was officially declared a city in 2015 and is Israel's youngest city, built on the site of the former IDF training base Camp Shunit. It was designed from scratch to be affordable and welcoming to first-time home buyers, and its population is doubling nearly every three years — a remarkable growth rate for any city anywhere in the world.", factHe:"חריש הוכרזה רשמית כעיר ב-2015 והיא העיר הצעירה בישראל; היא נבנתה על שטח בסיס צבאי לשעבר. היא תוכננה מאפס כדי להיות נגישה ומזמינה לרוכשי דירה ראשונה, ואוכלוסייתה מכפילה את עצמה כמעט כל שלוש שנים." },

  { name:"Qalansawe",       lat:32.2849, lng:34.9802, region:"Center",    tier:2, desc:"Large Arab city in the Triangle region", nameHe:"קלנסווה", descHe:"עיר ערבית גדולה באזור המשולש", fact:"Qalansawe is one of the largest Arab cities in Israel, sitting in the Triangle region near the Green Line. The city's name comes from a type of traditional Muslim cap, and it has been inhabited continuously since the early Islamic period. Despite economic challenges, it hosts a growing industrial zone that employs residents from across the region.", factHe:"קלנסווה היא אחת הערים הערביות הגדולות בישראל, שוכנת באזור המשולש ליד הקו הירוק. שם העיר מגיע מסוג כובע מוסלמי מסורתי, והיא מיושבת ברציפות מאז התקופה האסלאמית המוקדמת. למרות אתגרים כלכליים, היא מארחת אזור תעשייה צומח." , arabVillage: true },
  { name:"Tira",            lat:32.2330, lng:34.9504, region:"Center",    tier:2, desc:"Arab city in the central Triangle", nameHe:"טירה", descHe:"עיר ערבית במשולש המרכזי", fact:"Tira has one of the highest car ownership rates among Arab cities in Israel — a reflection of limited public transit to the Triangle region and relative economic success. The city was founded in the early Ottoman period and has ancient olive groves that local families have tended for generations.", factHe:"לטירה יש שיעור הבעלות על רכב הגבוה ביותר בקרב ערים ערביות בישראל — שיקוף של תחבורה ציבורית מוגבלת לאזור המשולש והצלחה כלכלית יחסית. העיר נוסדה בתקופה העות'מאנית המוקדמת, ובה מטעי זית עתיקים שמשפחות מקומיות מטפחות לדורותיהן." , arabVillage: true },
  { name:"Beit She'an",     lat:32.4968, lng:35.4973, region:"North",     tier:2, desc:"Ancient city with stunning Roman ruins", nameHe:"בית שאן", descHe:"עיר עתיקה עם חורבות רומאיות מדהימות", fact:"Beit She'an's Roman theater seats 7,000 people and is so well-preserved it still hosts performances today. The city has been continuously inhabited for 6,000 years, and in its heyday was one of the ten great cities of the Roman Decapolis.", factHe:"התיאטרון הרומי של בית שאן מכיל 7,000 מקומות ישיבה ושמור כל כך היטב עד שהוא עדיין מארח הופעות כיום. העיר מיושבת ברציפות 6,000 שנה, ובשיאה הייתה אחת מעשר הערים הגדולות של הדקפוליס הרומי." },
  { name:"Kiryat Motzkin",  lat:32.8391, lng:35.0804, region:"North",     tier:2, desc:"Northern suburb of Haifa", nameHe:"קריית מוצקין", descHe:"פרבר צפוני של חיפה", fact:"Kiryat Motzkin is named after Leo Motzkin, a Russian Zionist who fought for Jewish minority rights in Europe. The city's beaches were once the preferred vacation spot for Haifa families, and despite being swallowed by urban sprawl, it maintains a laid-back Mediterranean character distinct from its larger neighbor.", factHe:"קריית מוצקין נקראת על שם לאון מוצקין, ציוני רוסי שנלחם לזכויות מיעוטים יהודיים באירופה. חופי העיר היו פעם יעד הנופש המועדף של משפחות חיפאיות, ולמרות שנבלעה בהתפשטות עירונית, היא שומרת על אופי ים-תיכוני נינוח." },
  { name:"Beitar Illit",    lat:31.6981, lng:35.0988, region:"West Bank",  tier:2, desc:"Large ultra-Orthodox settlement in Gush Etzion", nameHe:"ביתר עילית", descHe:"ישוב חרדי גדול בגוש עציון", fact:"Beitar Illit is one of the fastest-growing cities in Israel, with an ultra-Orthodox population that has one of the highest birth rates in the world — averaging over 7 children per family. Founded in 1985, it grew from nothing to over 60,000 residents in under 40 years, becoming the fourth-largest settlement in the West Bank.", factHe:"ביתר עילית היא אחת הערים הצומחות הכי מהר בישראל, עם אוכלוסייה חרדית שיש לה אחד משיעורי הילודה הגבוהים בעולם — בממוצע למעלה מ-7 ילדים למשפחה. נוסדה ב-1985 וצמחה מאפס ליותר מ-60,000 תושבים." },
  { name:"Kafr Qara",       lat:32.5047, lng:35.0456, region:"North",     tier:2, desc:"Arab town in the Wadi Ara corridor", nameHe:"כפר קרע", descHe:"עיירה ערבית במסדרון ואדי ערה", fact:"Kafr Qara sits along Highway 65 in Wadi Ara, the main artery connecting Haifa to the Jezreel Valley. The town has a mixed Muslim and Christian population that has coexisted peacefully for centuries, and its location on the crossroads has made it a commercial hub for surrounding villages.", factHe:"כפר קרע שוכנת לאורך כביש 65 בואדי ערה, העורק הראשי המחבר את חיפה לעמק יזרעאל. לעיר אוכלוסייה מעורבת מוסלמית ונוצרית החיה יחד בשלום במשך מאות שנים, ומיקומה על הצומת הפך אותה למרכז מסחרי." , arabVillage: true },
  { name:"Fureidis",        lat:32.5988, lng:34.9542, region:"North",     tier:2, desc:"Arab coastal town between Haifa and Caesarea", nameHe:"פוריידיס", descHe:"עיירת חוף ערבית בין חיפה לקיסריה", fact:"Fureidis, meaning 'little paradise' in Arabic, is one of the few Arab towns in Israel with direct Mediterranean coastline. The town was spared destruction in 1948 when its residents raised white flags and cooperated with Israeli forces, and today it maintains a unique position as an Arab coastal community in an otherwise Jewish-dominated shoreline.", factHe:"פוריידיס, שמשמעותה בערבית 'גן עדן קטן', היא אחת מהעיירות הערביות הבודדות בישראל עם קו חוף ים-תיכוני ישיר. העיר ניצלה מהרס ב-1948 כשתושביה הניפו דגלים לבנים ושיתפו פעולה עם הכוחות הישראליים." , arabVillage: true },
  { name:"Eilon",           lat:33.0633, lng:35.2197, region:"North",     tier:2, desc:"Kibbutz in the far north near the Lebanese border", nameHe:"אילון", descHe:"קיבוץ בצפון הרחוק ליד גבול לבנון", fact:"Kibbutz Eilon sits less than 2 kilometers from the Lebanese border, in one of the most volatile corners of northern Israel. During the 2006 Lebanon War, it was evacuated when Hezbollah rockets struck the kibbutz directly. Despite the danger, residents returned and the kibbutz maintains vineyards and a guest house that draws visitors seeking the stunning Galilee scenery.", factHe:"קיבוץ אילון שוכן פחות מ-2 קילומטרים מגבול לבנון, באחת הפינות הסוערות ביותר של צפון ישראל. במלחמת לבנון השנייה ב-2006 הוא פונה כשרקטות חיזבאללה פגעו בו ישירות. למרות הסכנה, התושבים חזרו והקיבוץ מתחזק כרמים ובית הארחה." },
  { name:"Qiryat Tiv'on",   lat:32.7332, lng:35.1453, region:"North",     tier:2, desc:"Affluent town on the Carmel ridge", nameHe:"קריית טבעון", descHe:"עיירה אמידה על רכס הכרמל", fact:"Qiryat Tiv'on is one of the most affluent communities in northern Israel, spread across the Carmel ridge with stunning views of the Jezreel Valley below. The town was formed in 1958 by merging several small communities, and today it's known for excellent schools and a high quality of life that attracts professionals from Haifa.", factHe:"קריית טבעון היא אחת הקהילות האמידות ביותר בצפון ישראל, פרושה על פני רכס הכרמל עם נוף מרהיב לעמק יזרעאל שלרגליה. העיר נוצרה ב-1958 על ידי איחוד כמה קהילות קטנות, וכיום היא ידועה בבתי ספר מצוינים ואיכות חיים גבוהה." },
  // ── Smaller Towns — tier 3 ────────────────────────────────────────────────
  { name:"Givat Ze'ev",     lat:31.8663, lng:35.1739, region:"Jerusalem", tier:3, desc:"Suburban town northwest of Jerusalem", nameHe:"גבעת זאב", descHe:"עיירת פרוור צפונית לירושלים", fact:"Givat Ze'ev sits on the watershed ridge between the coastal plain and the Judean Desert, where rain falling on one side flows to the Mediterranean and on the other side flows toward the Dead Sea. It grew rapidly in the 1980s as a suburban community for Jerusalem commuters, and its hilltop location gives it panoramic views of the city.", factHe:"גבעת זאב ממוקמת על קו פרשת המים בין ים התיכון לים המלח — גשם שיורד על הגג המזרחי של בניין זורם לבסוף לים המלח, ומהגג המערבי — לים התיכון. הנוף לירושלים הנשקף ממנה בשעות השקיעה נחשב למרהיב." },
  { name:"Migdal HaEmek",   lat:32.6766, lng:35.2413, region:"North",     tier:3, desc:"Lower Galilee development town", nameHe:"מגדל העמק", descHe:"עיירת פיתוח בגליל התחתון", fact:"Migdal HaEmek was established in 1952 on the ruins of the Arab village of Mujaydil, and in a remarkable act of coexistence, Israeli and Arab archaeologists have worked together to document both the ancient Jewish and Arab history of the site. The town is named for the Valley of Jezreel ('HaEmek') that spreads below it.", factHe:"מגדל העמק הוקמה ב-1952 על חורבות הכפר הערבי מוג'ידל, ובמחווה לשיתוף פעולה, ארכאולוגים יהודים וערבים תיעדו יחד את שתי שכבות ההיסטוריה של המקום. שמה נגזר מהעמק — עמק יזרעאל — הנשקף ממנה." },
  { name:"Rosh Pinna",      lat:32.9682, lng:35.5438, region:"North",     tier:3, desc:"One of the first modern Jewish settlements in Israel", nameHe:"ראש פינה", descHe:"אחת המושבות היהודיות הראשונות בישראל", fact:"Rosh Pinna, founded in 1882, got its name ('Cornerstone') from Psalm 118:22 — 'the stone the builders rejected has become the cornerstone.' Many of Israel's founding figures passed through its famous guesthouse, and its Ottoman-era stone buildings have been so beautifully restored it's become one of Israel's most picturesque tourist villages.", factHe:"ראש פינה, שנוסדה ב-1882, שמה לקוח מתהלים: 'אֶבֶן מָאֲסוּ הַבּוֹנִים הָיְתָה לְרֹאשׁ פִּנָּה'. בניניה האבניים מהתקופה העות'מאנית שוחזרו בקפידה, והיא הפכה לאחת הכפרים הציוריים ביותר בישראל." },
  { name:"Metula",          lat:33.2692, lng:35.572300, region:"North",     tier:3, desc:"Israel's northernmost town, on the Lebanese border", nameHe:"מטולה", descHe:"הישוב הצפוני ביותר בישראל, על גבול לבנון", fact:"Metula is the only Israeli town with a 'Good Fence' — a crossing point that was kept open with Lebanon from 1976–2000, allowing Lebanese civilians (mostly from the South Lebanon Army's zone) to cross into Israel for work and medical care. The town is also home to Canada Centre, Israel's largest ice hockey and figure skating arena — built by a Canadian donor.", factHe:"מטולה היא הישוב הצפוני ביותר בישראל, ממש על גבול לבנון. בה שוכן 'קנדה סנטר' — האצטדיון הגדול בישראל לספורט חורף, שנבנה בתרומת קנדים. ב'גדר הטובה' הסמוכה, בין 1976 ל-2000, עברו לבנונים לישראל לעבודה וטיפול רפואי." },
  { name:"Ma'alot-Tarshiha",lat:33.0145, lng:35.2848, region:"North",     tier:3, desc:"Mixed Jewish-Arab twin city in western Galilee", nameHe:"מעלות-תרשיחא", descHe:"עיר מעורבת יהודית-ערבית בגליל המערבי", fact:"Ma'alot-Tarshiha is actually two towns officially merged in 1963 — the Jewish development town of Ma'alot and the Arab town of Tarshiha — making it one of Israel's only formally binational municipalities. The area is noted for its ancient olive trees, some of which are over 1,000 years old and still producing fruit.", factHe:"מעלות-תרשיחא הן שתי ערים שאוחדו רשמית ב-1963 — מעלות היהודית ותרשיחא הערבית — ומהוות אחת מהרשויות הדו-לאומיות הנדירות בישראל. הזיתים הסובבים את העיר, חלקם בני אלף שנה, עדיין נקטפים מדי שנה." , arabVillage: true },
  { name:"Yokneam",         lat:32.6481, lng:35.0944, region:"North",     tier:3, desc:"Tech park town at the Carmel foothills", nameHe:"יקנעם", descHe:"עיירת פארק טכנולוגי ברגלי הכרמל", fact:"Ancient Yokneam guarded the most important western pass through the Carmel mountain range — the Megiddo Pass — making it a strategic prize fought over for millennia. Today it hosts one of Israel's first and most successful industrial technology parks, which helped establish the country's medical device industry.", factHe:"יקנעם שולטת על ה'מעבר המערבי' דרך הכרמל — הנתיב האסטרטגי שצבאות ממצרים עד אשור עברו בו לכיבוש כנען. כיום היא בית לאחד מפארקי הטכנולוגיה הוותיקים בישראל, שסייע לבסס את תעשיית המכשירים הרפואיים." },
  { name:"Nesher",          lat:32.7709, lng:35.03810, region:"North",     tier:3, desc:"Town south of Haifa known for its cement factory", nameHe:"נשר", descHe:"עיירה דרומית לחיפה, ידועה במפעל המלט", fact:"Nesher's massive cement factory, established in 1925, supplied the concrete for many of modern Israel's most iconic infrastructure projects including the Knesset building and the National Water Carrier. The factory's chimney was for decades the tallest structure in the region and a navigation landmark for sailors approaching Haifa port.", factHe:"בנשר שוכן מפעל המלט הגדול בישראל, שהוקם ב-1925 ותרם את הבטון לפרויקטים כמו הכנסת והמוביל הארצי. ארובתו הייתה לפני שנים רבות המבנה הגבוה ביותר בצפון הארץ, ונווטי ים השתמשו בה לניווט." },
  { name:"Tirat Carmel",    lat:32.7614, lng:34.9716, region:"North",     tier:3, desc:"Town at the southern foot of Mount Carmel", nameHe:"טירת כרמל", descHe:"עיירה ברגלי הכרמל מדרום", fact:"Tirat Carmel sits below the Carmel ridge near ancient Dor, one of the most important Phoenician ports in the ancient world. The town is known for a unique annual multicultural festival celebrating the coexistence of its mixed Jewish and Arab population, reflecting the broader Carmel region's history of diverse communities.", factHe:"טירת הכרמל שוכנת ממש מתחת להר הכרמל הדרומי, בסמוך לדור הפיניקית העתיקה. בה מתקיים כל שנה פסטיבל רב-תרבותי החוגג את מגוון תושביה." },
  { name:"Kiryat Ata",      lat:32.8042, lng:35.1041, region:"North",     tier:3, desc:"Industrial town in the Haifa metropolitan area", nameHe:"קריית אתא", descHe:"עיירה תעשייתית במטרופולין חיפה", fact:"Kiryat Ata is built on the site of the ancient village of Kfar Ata, mentioned in Talmudic sources as a place known for its fine linen production. The town has a large community of Ethiopian Jewish immigrants who arrived in Operation Solomon in 1991, and hosts one of Israel's most vibrant Ethiopian cultural centers.", factHe:"קריית אתא בנויה על שטחי כפר אתא התלמודי, הנזכר כמקום ידוע לייצור פשתן איכותי. יש בה קהילה אתיופית גדולה שהגיעה במבצע שלמה ב-1991, ואחד ממרכזי התרבות האתיופית הפעילים בישראל." },
  { name:"Kiryat Bialik",   lat:32.8367, lng:35.0893, region:"North",     tier:3, desc:"Town in the Haifa bay area", nameHe:"קריית ביאליק", descHe:"עיירה בחוף מפרץ חיפה", fact:"Kiryat Bialik is named after Chaim Nachman Bialik, considered the national poet of Israel, who never actually lived there but whose influence on Hebrew literature was so great that three Israeli towns were named after him. The town was founded in 1934 and rapidly absorbed Holocaust survivors after WWII, shaping its communal identity.", factHe:"קריית ביאליק קרויה על שם ח.נ. ביאליק — 'המשורר הלאומי' של ישראל, שמעולם לא גר בה. היא נוסדה ב-1934 וקלטה ניצולי שואה רבים לאחר מלחמת העולם השנייה, מה שעיצב את זהותה הקהילתית." },
  { name:"Kiryat Yam",      lat:32.8510, lng:35.0635, region:"North",     tier:3, desc:"Haifa bay coastal town", nameHe:"קריית ים", descHe:"עיירת חוף בחוף מפרץ חיפה", fact:"Kiryat Yam gained brief international fame in 2009 when it offered a $1 million prize to anyone who could prove the existence of a mermaid reportedly seen off its shores — a tourism stunt that generated global headlines. The town sits on one of Israel's most polluted coastlines due to the nearby Haifa bay's petrochemical industries, though cleanup efforts have intensified.", factHe:"קריית ים זכתה לפרסום עולמי ב-2009 כשהציעה פרס של מיליון דולר למי שיוכיח קיומה של בתולת ים שנראתה לחוף — תרגיל יחסי ציבור שהפך לכותרת בכלי תקשורת ברחבי העולם." },
  { name:"Or Akiva",        lat:32.5090, lng:34.9196, region:"North",     tier:3, desc:"Town between Caesarea and Hadera", nameHe:"אור עקיבא", descHe:"עיירה בין קיסריה לחדרה", fact:"Or Akiva is named after Rabbi Akiva, the great Talmudic sage who was born into poverty nearby and taught himself to read at the age of 40 before becoming one of Judaism's greatest scholars. The town sits just south of ancient Caesarea Maritima, Herod's grand Roman port city whose stunning amphitheater still hosts outdoor concerts today.", factHe:"אור עקיבא נקראת על שם רבי עקיבא, שלפי המסורת נולד בסמוך ולמד קרוא וכתוב בגיל 40. ממש לצדה שוכנת קיסריה המפוארת של הורדוס, שהאמפיתיאטרון שלה עדיין מארח קונצרטים בקנה מידה ענק." },
  { name:"Pardes Hanna",    lat:32.4809, lng:34.9877, region:"North",     tier:3, desc:"Small town in the Sharon plain", nameHe:"פרדס חנה", descHe:"עיירה קטנה במישור השרון", fact:"Pardes Hanna ('Orchard of Hanna') was founded in 1913 and named after a Jewish woman named Hanna who owned orange groves there. During the British Mandate, it housed a large detention camp for Jewish underground fighters, and later for Holocaust survivors attempting to enter Palestine — the remains of the camp still exist.", factHe:"פרדס חנה הוקמה ב-1913 על פרדסי תפוזים, ושמה נגזר משמה של אישה יהודייה בשם חנה שהחזיקה בהם. בתקופת המנדט שכן בה מחנה מעצר בריטי לפעילי מחתרת יהודים, ולאחר מכן — לעולים מאירופה." },
  { name:"Hod HaSharon",    lat:32.1499, lng:34.8851, region:"Center",    tier:3, desc:"Suburban city in the central Sharon", nameHe:"הוד השרון", descHe:"עיר פרברית במרכז השרון", fact:"Hod HaSharon, meaning 'Splendor of the Sharon,' was formed by merging several small moshavot in 1990 and is now one of Israel's wealthiest municipalities by per-capita income. The area is famous in Israel for its plant nurseries, which supply much of the country's garden and landscaping trade.", factHe:"הוד השרון, 'הדר השרון', נוצרה ב-1990 מאיחוד מושבות קטנות. היא עשירה יחסית לערים ישראליות, ואזור המשתלות שלה מספק חלק גדול מהצמחים לגינות פרטיות בכל הארץ." },
  { name:"Ramat HaSharon",  lat:32.1397, lng:34.8359, region:"Center",    tier:3, desc:"Affluent northern suburb of Tel Aviv", nameHe:"רמת השרון", descHe:"פרבר אמיד צפוני לתל אביב", fact:"Ramat HaSharon consistently ranks among the richest municipalities in Israel, and its real estate prices rival those of central Tel Aviv. The town was established in 1922 and is home to several of Israel's most elite secondary schools, giving it a reputation as the educational address of choice for ambitious Israeli families.", factHe:"רמת השרון מדורגת באופן עקבי בין הערים העשירות בישראל, ובתי הספר התיכוניים שלה נחשבים בין ה'מבוקשים' ביותר. היא הוקמה ב-1922 ושמרה על אופי פרברי שקט לאורך כל גידולה." },
  { name:"Givatayim",       lat:32.0730, lng:34.8113, region:"Center",    tier:3, desc:"Dense urban city east of Tel Aviv", nameHe:"גבעתיים", descHe:"עיר עירונית צפופה ממזרח לתל אביב", fact:"Givatayim is Israel's most densely populated city — even more so than Bnei Brak — packed into just 2.7 square kilometers. Despite its tiny size, it has its own philharmonic orchestra, one of the few municipal orchestras outside Tel Aviv, reflecting its strong cultural identity and middle-class character.", factHe:"גבעתיים היא העיר הצפופה ביותר בישראל — 2.7 קילומטרים מרובעים בלבד, דחוסה יותר מבני ברק. למרות זעירותה, יש לה תזמורת פילהרמונית עירונית משלה — נדירות שמעידה על הזהות התרבותית הגאה של תושביה." },
  { name:"Or Yehuda",       lat:32.0270, lng:34.8630, region:"Center",    tier:3, desc:"City east of Tel Aviv near Ben Gurion Airport", nameHe:"אור יהודה", descHe:"עיר ממזרח לתל אביב, בסמוך לנמל בן גוריון", fact:"Or Yehuda was the birthplace of former Israeli Prime Minister Ehud Barak, the most decorated soldier in IDF history. The city became famous in 2010 when its deputy mayor organized a mass burning of hundreds of copies of the Talmud as a provocative stunt, causing an international scandal.", factHe:"אור יהודה היא עיר הולדתו של אהוד ברק, ראש הממשלה לשעבר ואיש הצבא המצוין בתולדות צה\"ל. ב-2010 הסעיר סגן ראש העיר שלה את הציבור כשארגן שריפה המונית של ספרי תלמוד." },
  { name:"Yavne",           lat:31.8769, lng:34.7383, region:"Center",    tier:3, desc:"Ancient city, now a modern industrial center", nameHe:"יבנה", descHe:"עיר עתיקה, כיום מרכז תעשייתי מודרני", fact:"Yavne is where Rabbi Yochanan ben Zakai established the great Sanhedrin academy after the destruction of Jerusalem in 70 CE — it essentially saved Judaism as a religion by shifting its center from the Temple to study and prayer. The phrase 'Yavne and its sages' became a Jewish metaphor for intellectual renewal after catastrophe.", factHe:"ביבנה הקים רבי יוחנן בן זכאי את הסנהדרין לאחר חורבן ירושלים ב-70 לספירה — וכך הציל את היהדות מהכחדה לאחר אובדן המקדש. הביטוי 'יבנה וחכמיה' הפך במסורת היהודית לסמל חידוש מול קטסטרופה." },
  { name:"Gedera",          lat:31.8118, lng:34.78040, region:"Center",    tier:3, desc:"Small town in the southern Sharon", nameHe:"גדרה", descHe:"עיירה קטנה בדרום השרון", fact:"Gedera was founded in 1884 by members of the Bilu movement, the first organized Zionist immigration wave to Ottoman Palestine. The town's founders were young Russian Jewish idealists who arrived with almost nothing and struggled desperately to farm the land, but their perseverance made Gedera a symbol of early Zionist pioneering spirit.", factHe:"גדרה נוסדה ב-1884 על ידי חלוצי תנועת 'ביל\"ו', הגל הציוני המאורגן הראשון שעלה לארץ. המייסדים הגיעו כמעט חסרי כל ובקושי שרדו — אך עמידותם הפכה את גדרה לסמל ה'חלוציות הציונית'." },
  { name:"Kiryat Ono",      lat:32.0592, lng:34.8594, region:"Center",    tier:3, desc:"Suburban city east of Tel Aviv", nameHe:"קריית אונו", descHe:"עיר פרברית ממזרח לתל אביב", fact:"Kiryat Ono is home to one of Israel's most prestigious law schools, the College of Management Academic Studies, which has produced a large fraction of Israel's lawyers and judges. The city is notable for its surprising amount of green space considering its location squeezed between Tel Aviv's dense eastern suburbs.", factHe:"קריית אונו מכילה שטחי ירק רבים ביחס לגודלה — תכונה נדירה באזור המטרופולין הצפוף של תל אביב. בית הספר למשפטים שלה, מכללת ניהול, הכשיר חלק ניכר מהעורכי דין והשופטים בישראל." },
  { name:"Netivot",         lat:31.4214, lng:34.5884, region:"South",     tier:3, desc:"Religious development town in the Negev", nameHe:"נתיבות", descHe:"עיירת פיתוח דתית בנגב", fact:"Netivot is home to the tomb of the Baba Sali, Rabbi Yisrael Abuhatzeira — one of the most venerated Moroccan Jewish Kabbalist saints — which draws hundreds of thousands of pilgrims each year on his yahrzeit, making it one of Israel's largest annual religious gatherings. The city has an overwhelmingly Moroccan Jewish cultural character.", factHe:"נתיבות מפורסמת בזכות קברו של הבבא סאלי, הרב ישראל אבוחצירא, שאליו עולים בהמוניהם ביום פטירתו. הרוב המוחלט של תושביה הוא ממוצא מרוקאי, ותרבות יהדות מרוקו חיה בה בעוצמה." },
  { name:"Ofakim",          lat:31.3126, lng:34.6209, region:"South",     tier:3, desc:"Development town in the western Negev", nameHe:"אופקים", descHe:"עיירת פיתוח במערב הנגב", fact:"Ofakim, meaning 'Horizons,' was founded in 1955 to absorb Jewish immigrants from North Africa and was long one of Israel's most economically deprived towns. In recent years it has been transformed by high-tech investment, particularly in the solar energy sector — the surrounding Negev desert makes it ideal for large-scale solar farms.", factHe:"אופקים, שפירושה 'אופקים', הוקמה ב-1955 לקליטת עולים מצפון אפריקה ונחשבה לאחת הענייות בישראל. בשנים האחרונות עברה תמורה עם הגעת מפעלי אנרגיה סולארית — שהמדבר הסובב אותה מאפשר." },
  { name:"Yeroham",         lat:30.9888, lng:34.9251, region:"South",     tier:3, desc:"Negev development town near the Makhtesh Gadol", nameHe:"ירוחם", descHe:"עיירת פיתוח בנגב בסמוך למכתש גדול", fact:"Yeroham was built next to a large natural reservoir created by desert flash floods — Yeroham Lake — which despite being in the Negev supports surprising biodiversity including migratory birds. The town has reinvented itself as an arts destination, with an artist residency program attracting creatives who come for the otherworldly desert landscape.", factHe:"ירוחם שוכנת בסמוך לאגם ירוחם — מאגר טבעי של מי שיטפונות המדבר התומך בעופות נדידה ייחודיים. בעשורים האחרונים התפתחה כיעד אמנות עם תכנית שהייה לאמנים." },
  { name:"Kiryat Malachi",  lat:31.7312, lng:34.7448, region:"South",     tier:3, desc:"Development town in the southern coastal plain", nameHe:"קריית מלאכי", descHe:"עיירת פיתוח במישור החוף הדרומי", fact:"Kiryat Malachi has one of Israel's highest concentrations of Ethiopian Jewish immigrants, giving it a distinct cultural character and some of the best Ethiopian food in the country. The town is named after Los Angeles ('City of Angels' — Malachi means 'my angel' in Hebrew), in honor of the American Jewish community that funded its establishment in 1951.", factHe:"קריית מלאכי קרויה על שם לוס אנג'לס ('עיר המלאכים', מלאכי = 'מלאכי' בעברית) — לכבוד התורמים האמריקאים שסייעו להקמתה ב-1951. יש בה אחד הריכוזים הגבוהים של יהדות אתיופיה בישראל." },
  { name:"Jericho",         lat:31.8614, lng:35.4444, region:"West Bank",  tier:3, desc:"Oldest continuously inhabited city in the world", nameHe:"יריחו", descHe:"העיר העתיקה ביותר בעולם, מיושבת ללא הפסקה", fact:"Jericho's Tell es-Sultan contains evidence of human settlement dating back 11,000 years, making it arguably the world's oldest city. It sits 258 meters below sea level, the lowest permanently inhabited city on Earth, in an oasis fed by a powerful ancient spring — Ein es-Sultan — that has been flowing for thousands of years.", factHe:"יריחו היא כנראה העיר המיושבת ברצף הארוך ביותר בעולם — למעלה מ-11,000 שנה. היא שוכנת 258 מטר מתחת לפני הים, הנמוכה שבערים המיושבות בעולם, בנווה שמוזנת ממעיין עתיק." },
  { name:"Ein Gedi",        lat:31.4524, lng:35.3848, region:"South",     tier:3, desc:"Oasis kibbutz on the Dead Sea shores", nameHe:"עין גדי", descHe:"קיבוץ אואזיס על חוף ים המלח", fact:"Ein Gedi is a lush tropical oasis in the Judean Desert where ibex, hyrax, and leopards roam free among waterfalls and date palms — just meters from the Dead Sea's salt flats. The Song of Songs mentions Ein Gedi's vineyards, and an ancient synagogue floor found there features a stunning mosaic with a mysterious Aramaic curse threatening anyone who causes communal strife.", factHe:"עין גדי היא אואזיס בלב מדבר יהודה, שבה חיים יעלים, שפנים וטורפים בטבע פתוח. שיר השירים מזכיר את כרמי עין גדי, ורצפת בית כנסת עתיק שנמצאה בה נושאת קללה ארמית נגד כל מי שיגרום מחלוקת קהילתית." },
  { name:"Sakhnin",         lat:32.8638, lng:35.3023, region:"North",     tier:3, desc:"Arab city known for its football club", nameHe:"סח'נין", descHe:"עיר ערבית ידועה בקבוצת הכדורגל שלה", fact:"Sakhnin's football club, Bnei Sakhnin, became a national symbol of coexistence in 2004 when — fielding Jewish, Arab, and foreign players — it won the Israeli State Cup, the only Arab-majority city to ever win the trophy. The victory prompted a spontaneous celebration that united Israelis across ethnic lines.", factHe:"סח'נין הפכה לסמל שותפות ב-2004, כשמועדון הכדורגל שלה — בני סח'נין — זכה בגביע המדינה בהרכב מעורב של שחקנים יהודים, ערבים וזרים. זו הייתה הפעם היחידה שמועדון מעיר ערבית זכה בתואר." , arabVillage: true },
  { name:"Arrabe",          lat:32.8486, lng:35.3358, region:"North",     tier:3, desc:"Arab town in Lower Galilee", nameHe:"עראבה", descHe:"עיירה ערבית בגליל התחתון", fact:"Arrabe is renowned in Israel for its olive oil — the surrounding hills are blanketed with ancient olive trees, some over 1,000 years old, and the town's harvest festival draws visitors from across the country. It also has a rich tradition of Palestinian embroidery that has been revived as a cottage industry in recent decades.", factHe:"עראבה מפורסמת בשמן הזית שלה — הסביבה מכוסה עצי זית עתיקים, חלקם בני אלף שנה. פסטיבל הקציר השנתי שלה מושך מבקרים מרחבי הארץ, ורקמת הכפר מתחדשת כתעשיית בית." , arabVillage: true },
  { name:"Tamra",           lat:32.8535, lng:35.1979, region:"North",     tier:3, desc:"Arab city west of Karmiel", nameHe:"טמרה", descHe:"עיר ערבית מערבית לכרמיאל", fact:"Tamra has one of the highest birth rates in Israel and its population has grown fivefold since 1948, yet it received almost no new land allocation for housing — leading to extreme overcrowding and one of Israel's most acute illegal construction crises, with thousands of homes built without permits for lack of alternatives.", factHe:"טמרה היא אחת הערים הצומחות ביותר באוכלוסייה בישראל, אך מגבלות על הרחבת השטח גרמו לצפיפות בנייה חמורה וקשיי תכנון. היא יושבת ממערב לכרמיאל, ועל גבעותיה נשקף נוף לכרמל ולגליל." , arabVillage: true },
  { name:"Baqa al-Gharbiyye",lat:32.4197, lng:35.0428, region:"North",   tier:3, desc:"Arab city in the Wadi Ara region", nameHe:"באקה אל-ע'רביה", descHe:"עיר ערבית באזור ואדי ערה", fact:"Baqa al-Gharbiyye sits right on the 1949 armistice 'Green Line,' and its twin city Baqa al-Sharqiyye is just meters away in the West Bank — families were literally split by the border. In peace negotiations, the area was repeatedly discussed as a potential land swap zone, and locals have lived for decades with the unusual experience of a border running through their community.", factHe:"באקה אל-ע'רביה יושבת ממש על הקו הירוק — גבול 1949 — ועיר תאומתה באקה א-שרקיה נמצאת מטרים ספורים ממנה בגדה המערבית. משפחות רבות נקרעו בין שתי הצלעות." , arabVillage: true },
  { name:"Daliyat al-Karmel",lat:32.6922, lng:35.0483, region:"North",   tier:3, desc:"Largest Druze town in Israel, on Mount Carmel", nameHe:"דלית אל-כרמל", descHe:"העיר הדרוזית הגדולה בישראל, על הכרמל", fact:"Daliyat al-Karmel is the spiritual and cultural heart of Israel's Druze community, whose men serve in the IDF and take great pride in their Israeli patriotism — an unusual stance among Arab communities in Israel. The town's souk is famous throughout Israel for handmade Druze crafts, particularly the distinctive star-patterned fabrics and woven goods.", factHe:"דלית אל-כרמל היא לב קהילת הדרוזים בישראל — גברים דרוזים משרתים בצה\"ל ומתגאים בכך, תופעה ייחודית בקרב ערביי ישראל. השוק שלה ידוע בכל ישראל בזכות אריגים ומלאכת יד דרוזית מסורתית." , arabVillage: true },

  { name:"Degania Alef",    lat:32.7085, lng:35.5749, region:"North",     tier:3, desc:"The world's first kibbutz, on the southern shore of the Sea of Galilee", nameHe:"דגניה א'", descHe:"הקיבוץ הראשון בעולם, על החוף הדרומי של הכנרת", fact:"Degania Alef, founded in 1910, is the mother of all kibbutzim — the first communal agricultural settlement in the world, which gave birth to an entirely new form of society. At its gate stands a Syrian tank burned to a halt during the 1948 War of Independence, stopped by a combination of a PIAT anti-tank hit and a Molotov cocktail thrown by kibbutz defenders — the scorched tank still stands at the gate as a memorial.", factHe:"דגניה א', שנוסדה ב-1910, היא אם כל הקיבוצים — הישוב החקלאי הקומונלי הראשון בעולם. בשערה ניצב טנק סורי שנבלם במלחמת העצמאות ב-1948 בשילוב של פגיעת פיאט ובקבוק תבערה שהשליכו מגיני הקיבוץ — הטנק השרוף עומד שם עד היום כאנדרטה." },
  { name:"Binyamina",       lat:32.5203, lng:34.9436, region:"North",     tier:3, desc:"Wine-country town at the foot of the Carmel ridge", nameHe:"בנימינה", descHe:"עיירת יין ברגלי רכס הכרמל", fact:"Binyamina is named after Baron Edmond de Rothschild, whose Hebrew name was Binyamin, as he funded the town's founding in 1922. The area is prime wine country — the Tishbi Estate winery there is one of Israel's oldest family wineries and produces prize-winning wines. Binyamina also has one of Israel's finest Ottoman-era train stations, beautifully restored.", factHe:"בנימינה קרויה על שם הברון אדמונד דה רוטשילד, ששמו העברי היה בנימין, שמימן את הקמת העיירה ב-1922. האזור שוכן בלב אזור יין — יקב טישבי שם הוא מהיקבים המשפחתיים הוותיקים בישראל. לבנימינה גם אחת מתחנות הרכבת היפות מהתקופה העות'מאנית." },
  { name:"Atlit",           lat:32.6928, lng:34.9402, region:"North",     tier:3, desc:"Coastal town with a famous Crusader castle and detention camp", nameHe:"עתלית", descHe:"עיירת חוף עם טירה צלבנית ומחנה מעצר היסטורי", fact:"Atlit's massive Crusader sea-fortress, built in 1218, was the last Crusader stronghold in the Holy Land to fall — its garrison held out until 1291. Nearby, the restored British detention camp where Jewish immigrants were interned after WWII is now a museum, and the daring 1945 Palmach raid to free 208 detainees from it is considered one of the greatest commando operations of the pre-state era.", factHe:"המבצר הימי הצלבני של עתלית, שנבנה ב-1218, היה המעוז הצלבני האחרון בארץ הקודש שנפל — חיל המצב שלו החזיק עד 1291. בסמוך, מחנה המעצר הבריטי המשוחזר שבו הוחזקו עולים יהודים לאחר מלחמת העולם השנייה הפך למוזיאון, והפשיטה ב-1945 לשחרור 208 עצורים נחשבת לאחת ממבצעי הקומנדו הגדולים של תקופת הטרום-מדינה." },
  { name:"Abu Ghosh",       lat:31.8064, lng:35.1089, region:"Jerusalem", tier:3, desc:"Arab village west of Jerusalem, famous for hummus", nameHe:"אבו גוש", descHe:"כפר ערבי מערבית לירושלים, ידוע בחומוס", fact:"Abu Ghosh is one of the only Arab villages in Israel that sided with the Jewish forces during the 1948 War of Independence, and the friendship forged then has never broken — its residents serve in the IDF voluntarily and enjoy peaceful relations with Jewish neighbors. The village hosts a world-famous hummus rivalry between two competing family restaurants, each claiming to make the best in the country.", factHe:"אבו גוש הוא אחד הכפרים הערביים היחידים בישראל שצידד בכוחות היהודיים במלחמת העצמאות ב-1948, והידידות שנרקמה אז לא נשברה מאז. הכפר מארח יריבות חומוס מפורסמת בין שתי מסעדות משפחתיות מתחרות, כל אחת טוענת שהיא עושה את הטוב ביותר בארץ." , arabVillage: true },
  { name:"Kafr Yasif",      lat:32.9533, lng:35.1657, region:"North",     tier:3, desc:"Ancient Arab town near Akko in the western Galilee", nameHe:"כפר יסיף", descHe:"עיירה ערבית עתיקה בסמוך לעכו בגליל המערבי", fact:"Kafr Yasif is one of the oldest continuously inhabited Arab towns in Israel, with roots stretching back to the Roman period. The village is home to three Christian denominations — Greek Orthodox, Greek Catholic, and Roman Catholic — along with a Muslim community, making it a microcosm of the religious diversity of the Galilee.", factHe:"כפר יסיף הוא אחת מהעיירות הערביות הוותיקות ביישוב רציף בישראל, עם שורשים הנמשכים לתקופה הרומית. הכפר מכיל שלוש כנסיות נוצריות — יוונית אורתודוקסית, יוונית קתולית ורומית קתולית — לצד קהילה מוסלמית." , arabVillage: true },
  { name:"Maghar",          lat:32.8858, lng:35.4062, region:"North",     tier:3, desc:"Large mixed Druze, Christian and Muslim village in Galilee", nameHe:"מע'אר", descHe:"כפר גדול מעורב דרוזי, נוצרי ומוסלמי בגליל", fact:"Maghar is one of the very few villages in Israel — and the world — where Druze, Christians, and Muslims live as a single mixed community under one municipality. Despite occasional internal tensions, the three communities have maintained a functioning joint identity for centuries, and the village is regularly cited as a model of pluralistic coexistence.", factHe:"מע'אר הוא אחד הכפרים הנדירים בישראל — ובעולם — שבהם דרוזים, נוצרים ומוסלמים חיים כקהילה מעורבת אחת תחת עירייה אחת. למרות מתחים פנימיים מדי פעם, שלוש הקהילות שמרו על זהות משותפת ומתפקדת במשך מאות שנים." , arabVillage: true },
  { name:"Kochav Yair",     lat:32.1573, lng:34.9719, region:"Center",    tier:3, desc:"Affluent community in the Sharon, near the Green Line", nameHe:"כוכב יאיר", descHe:"קהילה אמידה בשרון, בסמוך לקו הירוק", fact:"Kochav Yair sits just a few kilometers from the Green Line, at a point where Israel narrows dramatically. The community was named after Avraham (Yair) Stern, the leader of the Lehi underground, who was killed by British police in Tel Aviv in 1942. Despite its proximity to the border, it is considered one of the most desirable addresses in the Sharon region.", factHe:"כוכב יאיר שוכן כמה קילומטרים מהקו הירוק, בנקודה שבה ישראל מצטמצמת דרמטית. הקהילה נקראה על שם אברהם (יאיר) שטרן, מנהיג מחתרת לח\"י, שנהרג על ידי המשטרה הבריטית בתל אביב ב-1942." },
  { name:"Even Yehuda",     lat:32.2725, lng:34.8868, region:"Center",    tier:3, desc:"Town in the central Sharon plain", nameHe:"אבן יהודה", descHe:"עיירה במישור השרון המרכזי", fact:"Even Yehuda was founded in 1932 and named after Eliezer Ben-Yehuda, the man who single-handedly revived spoken Hebrew from a dead liturgical language into the living tongue of modern Israel. Ben-Yehuda was famous for refusing to speak any language but Hebrew — reportedly he raised his son Ben-Zion as the first native Hebrew-speaking child in modern history.", factHe:"אבן יהודה נוסדה ב-1932 ונקראת על שם אליעזר בן-יהודה, שהחיה את השפה העברית משפת קודש לשפה חיה. בן-יהודה היה ידוע בסירובו לדבר כל שפה מלבד עברית — לפי המסורת, הוא גידל את בנו בן-ציון כילד הדובר עברית כשפת אם הראשון בהיסטוריה המודרנית." },
  { name:"Tel Mond",        lat:32.2536, lng:34.9185, region:"Center",    tier:3, desc:"Pastoral town in the heart of the Sharon", nameHe:"תל מונד", descHe:"עיירה כפרית בלב השרון", fact:"Tel Mond is named after Sir Alfred Mond, the British industrialist and Zionist philanthropist who funded the town's establishment in 1929. The town has maintained a slower, more pastoral character than its neighbors, and its citriculture heritage — ancient orange groves still ring the community — makes it one of the most fragrant places in Israel in spring.", factHe:"תל מונד קרוי על שם סר אלפרד מונד, התעשיין הבריטי הציוני שמימן את הקמת העיירה ב-1929. העיירה שמרה על אופי כפרי ושקט יותר משכנותיה, ומורשת ההדרים שלה — פרדסי תפוזים עתיקים מקיפים את הקהילה — הופכת אותה לאחד המקומות הריחניים ביותר בישראל באביב." },
  { name:"Ganei Tikva",     lat:32.0604, lng:34.8761, region:"Center",    tier:3, desc:"Suburban town east of Tel Aviv near Petah Tikva", nameHe:"גני תקווה", descHe:"עיירת פרוור ממזרח לתל אביב, בסמוך לפתח תקווה", fact:"Ganei Tikva, meaning 'Gardens of Hope,' was founded in 1949 largely by Holocaust survivors who named it to express their determination to rebuild. Despite being entirely surrounded by other municipalities, it maintains its own independent local council — a geographic oddity in the dense urban fabric of the Gush Dan region.", factHe:"גני תקווה, 'גני התקווה', הוקמה ב-1949 ברובה על ידי ניצולי שואה שנתנו לה שם כביטוי לרצון לבנות מחדש. למרות שהיא מוקפת לחלוטין בעיריות אחרות, היא שומרת על מועצה מקומית עצמאית — תופעה גיאוגרפית ייחודית ברקמה העירונית הצפופה של גוש דן." },
  { name:"Kafr Qasim",      lat:32.1152, lng:34.9753, region:"Center",    tier:3, desc:"Arab town in the Triangle, site of the 1956 massacre", nameHe:"כפר קאסם", descHe:"עיירה ערבית במשולש, זירת טבח 1956", fact:"Kafr Qasim became one of Israel's most painful historical chapters in 1956, when Israeli border police shot and killed 49 Arab civilians returning from their fields unaware of a newly imposed curfew. The event led to landmark criminal trials, an unprecedented military conviction, and is now commemorated annually — a defining moment in the history of Arab-Jewish relations in Israel.", factHe:"כפר קאסם הפך לאחד הפרקים הכואבים ביותר בהיסטוריה הישראלית ב-1956, כשמשמר הגבול ירה והרג 49 אזרחים ערבים שחזרו משדותיהם מבלי לדעת על עוצר שהוטל. האירוע הוביל למשפטים פורצי דרך ולהרשעה צבאית חסרת תקדים." , arabVillage: true },
  { name:"Beit Dagan",      lat:32.0020, lng:34.9640, region:"Center",    tier:3, desc:"Town east of Tel Aviv in the Coastal Plain", nameHe:"בית דגן", descHe:"עיירה ממזרח לתל אביב במישור החוף", fact:"Beit Dagan was founded in 1948 on the site of the ancient Philistine city of Bit Daganna mentioned in Assyrian records, settled by Mizrahi Jewish immigrants from Yemen and North Africa. The Israeli Meteorological Service's main weather station is located here, making Beit Dagan the official reference point for weather data across all of Israel.", factHe:"בית דגן הוקמה ב-1948 על שטח עיר פלישתית עתיקה, ואוכלסה בעולים יהודים מתימן וצפון אפריקה. תחנת מזג האוויר הראשית של השירות המטאורולוגי הישראלי ממוקמת בה, מה שהופך את בית דגן לנקודת הייחוס הרשמית למידע מזג האוויר בכל ישראל." },
  { name:"Nir David",       lat:32.5270, lng:35.4460, region:"North",     tier:3, desc:"Historic kibbutz at the foot of the Gilboa, with Israel's largest natural pool", nameHe:"ניר דוד", descHe:"קיבוץ היסטורי ברגלי הגלבוע, עם הבריכה הטבעית הגדולה בישראל", fact:"Nir David (also known as Tel Amal) was established in 1936 using the 'tower and stockade' method — an entire settlement was erected in a single day to create facts on the ground before British authorities could intervene. Its natural spring pool, fed by the largest freshwater spring in the region, is the biggest natural swimming pool in Israel and draws visitors from across the country.", factHe:"ניר דוד (הידוע גם כתל עמל) הוקם ב-1936 בשיטת 'חומה ומגדל' — יישוב שלם הוקם ביום אחד כדי ליצור עובדות על הקרקע לפני שהשלטון הבריטי יוכל להתערב. בריכת המעיינות הטבעית שלו, המוזנת מהמעיין הגדול ביותר באזור, היא הגדולה בישראל." },
  { name:"Sde Boker",       lat:30.8737, lng:34.7926, region:"South",     tier:3, desc:"Negev kibbutz where David Ben-Gurion chose to retire", nameHe:"שדה בוקר", descHe:"קיבוץ נגב שבו בחר דוד בן-גוריון לפרוש", fact:"David Ben-Gurion, Israel's founding father and first prime minister, shocked the nation in 1953 by retiring to Sde Boker — a struggling Negev kibbutz — to prove his belief that Israel's future lay in developing the desert. He and his wife Paula are buried there on a stunning cliff overlooking the Zin Valley, and the site draws a quarter of a million visitors a year.", factHe:"דוד בן-גוריון, מייסד המדינה ורוה\"מ הראשון, הדהים את האומה ב-1953 כשפרש לשדה בוקר — קיבוץ נגב מאתגר — כדי להוכיח את אמונתו שעתיד ישראל בפיתוח המדבר. הוא ורעייתו פולה קבורים שם על צוק מרהיב מעל מכתש צין, והאתר מושך רבע מיליון מבקרים בשנה." },
  { name:"Ein Bokek",       lat:31.2014, lng:35.363900, region:"South",     tier:3, desc:"Dead Sea resort with luxury hotels and the lowest point on Earth", nameHe:"עין בוקק", descHe:"אזור נופש בים המלח עם מלונות יוקרה ונקודת השפל על פני כדור הארץ", fact:"Ein Bokek sits at the edge of the Dead Sea, the lowest point on Earth at about 430 meters below sea level, where the extremely salty water makes it physically impossible to sink. The mineral-rich black mud that tourists smear over themselves has genuine therapeutic properties, and the ultra-violet filtering effect of the thick atmosphere at this depth means you can sunbathe for twice as long without burning.", factHe:"עין בוקק שוכנת על גדות ים המלח, הנקודה הנמוכה ביותר על פני כדור הארץ בכ-430 מטר מתחת לפני הים, שבו המים מלוחים כל כך עד שאי אפשר לטבוע. הבוץ המינרלי השחור שתיירים מורחים על עצמם בעל סגולות ריפוי אמיתיות." },
  { name:"Latrun",          lat:31.8361, lng:34.9878, region:"Jerusalem", tier:3, desc:"Trappist monastery and 1948 battle site on the road to Jerusalem", nameHe:"לטרון", descHe:"מנזר טרפיסטי ואתר קרב 1948 בדרך לירושלים", fact:"Latrun commands the strategic crossroads where the road from the coastal plain climbs to Jerusalem — armies have fought over this position since ancient times, including Maccabees, Romans, Crusaders, and Ottomans. In 1948, newly arriving Holocaust survivors were thrown into battle here hours after landing, suffering catastrophic losses; the Armored Corps Museum at the site commemorates them with a stunning collection of tanks spanning Israel's wars.", factHe:"לטרון שולט בצומת האסטרטגית שבה הדרך מהמישור עולה לירושלים — צבאות נלחמו על עמדה זו מאז ימי קדם, כולל המכבים, הרומאים, הצלבנים והעות'מאנים. ב-1948 נשלחו ניצולי שואה שזה עתה עלו לקרב כאן שעות אחרי נחיתתם. מוזיאון חיל השריון באתר מנציח אותם עם אוסף טנקים מרשים." },
  { name:"Efrat",           lat:31.6588, lng:35.1580, region:"West Bank",  tier:3, desc:"Large settlement in the Gush Etzion bloc south of Jerusalem", nameHe:"אפרת", descHe:"ישוב גדול בגוש עציון, דרומית לירושלים", fact:"Efrat is the largest Israeli settlement in the Gush Etzion bloc and the cultural capital of the region, a cluster of settlements on land that was Jewish-owned before 1948 — when the area was captured by the Jordanian Arab Legion and its defenders were massacred. The town is home to a large English-speaking community and is sometimes called 'the most American settlement in Israel.'", factHe:"אפרת היא יישוב ישראלי גדול ביהודה ושומרון ובירת התרבות של גוש עציון — אשכול יישובים על אדמה שהייתה בבעלות יהודים לפני 1948, שאז נכבשה על ידי הלגיון הערבי הירדני ומגיניה נטבחו. בעיירה יש קהילה אנגלו-סכסית גדולה ולעיתים היא מכונה 'הישוב האמריקאי ביותר בישראל'." },
  { name:"Meona",           lat:33.0167, lng:35.25970, region:"North",     tier:3, desc:"Small community in the Upper Galilee near Lebanon", nameHe:"מאונה", descHe:"קהילה קטנה בגליל העליון ליד לבנון", fact:"Meona sits in the Upper Galilee just a few kilometers from the Lebanese border, in one of Israel's most scenic but volatile regions. The surrounding valleys are covered with ancient olive and almond trees, and the village's elevated position gives panoramic views stretching from the Mediterranean coast to Mount Hermon on a clear day.", factHe:"מאונה שוכנת בגליל העליון כמה קילומטרים מגבול לבנון, באחד מאזורי ישראל הציוריים אך הסוערים ביותר. עמקי הסביבה מכוסים עצי זית ושקד עתיקים, ומיקומה הגבוה מאפשר נוף פנורמי עד חוף הים התיכון והר החרמון." },

  { name:"Jisr az-Zarqa",   lat:32.5376, lng:34.9132, region:"North",     tier:3, desc:"Only Arab town on Israel's Mediterranean coast", nameHe:"ג'סר א-זרקא", descHe:"העיירה הערבית היחידה על חוף הים התיכון", fact:"Jisr az-Zarqa is the only Arab town in Israel sitting directly on the Mediterranean coast, squeezed between Caesarea to the south and Kibbutz Ma'agan Michael to the north. Despite its prime beachfront location, it remains one of the poorest communities in Israel, with chronic infrastructure problems and limited access to the beaches that surround it — a stark contrast to the luxury developments nearby.", factHe:"ג'סר א-זרקא היא העיירה הערבית היחידה בישראל היושבת ישירות על חוף הים התיכון, דחוסה בין קיסריה מדרום לקיבוץ מעגן מיכאל מצפון. למרות מיקומה הפרמיום על החוף, היא נותרת אחת הקהילות העניות ביותר בישראל, עם בעיות תשתית כרוניות וגישה מוגבלת לחופים." , arabVillage: true },
  { name:"Majd al-Krum",    lat:32.9226, lng:35.2580, region:"North",     tier:3, desc:"Large Arab village in the Galilee", nameHe:"מג'ד אל-כרום", descHe:"כפר ערבי גדול בגליל", fact:"Majd al-Krum is one of the largest Arab villages in the Galilee and has produced a disproportionate number of prominent Arab-Israeli politicians, academics, and artists. The village sits on ancient ruins dating back to the Canaanite period, and locals take pride in their long history of resistance — both to the Crusaders in the Middle Ages and to various modern authorities.", factHe:"מג'ד אל-כרום הוא אחד הכפרים הערביים הגדולים בגליל והפיקה מספר בלתי פרופורציונלי של פוליטיקאים, אקדמאים ואמנים ערבים-ישראלים בולטים. הכפר יושב על חורבות עתיקות מהתקופה הכנענית, והמקומיים מתגאים בהיסטוריה הארוכה של התנגדות." , arabVillage: true },
  { name:"Yavne'el",        lat:32.7081, lng:35.5039, region:"North",     tier:3, desc:"Village in the Lower Galilee near the Sea of Galilee", nameHe:"יבנאל", descHe:"כפר בגליל התחתון בסמוך לכנרת", fact:"Yavne'el was one of the very first Jewish agricultural settlements in the Lower Galilee, founded in 1901 by pioneers from Romania. Baron Rothschild funded its establishment, and early settlers had to defend against Bedouin raiders while draining the malarial swamps. Today it's a quiet agricultural community surrounded by avocado and olive groves.", factHe:"יבנאל הייתה אחת מהמושבות החקלאיות היהודיות הראשונות בגליל התחתון, שנוסדה ב-1901 על ידי חלוצים מרומניה. הברון רוטשילד מימן את הקמתה, והמתיישבים הראשונים נאלצו להתגונן מפני פושטים בדואים תוך ניקוז ביצות המלריה." },
  { name:"Sha'ar HaGolan",  lat:32.6858, lng:35.6043, region:"North",     tier:3, desc:"Kibbutz in the Jordan Valley known for ancient clay figurines", nameHe:"שער הגולן", descHe:"קיבוץ בעמק הירדן הידוע בפסלוני חימר עתיקים", fact:"Sha'ar HaGolan sits at the entrance to the Golan Heights ('Gate of the Golan') and is famous for the discovery of 8,000-year-old clay figurines — the 'Yarmukian culture' — that represent some of the oldest representational art ever found. The kibbutz museum displays these prehistoric 'Venus figurines' that predate writing itself.", factHe:"שער הגולן שוכן בכניסה לרמת הגולן ('שער הגולן') ומפורסם בגילוי פסלוני חימר בני 8,000 שנה — 'תרבות הירמוכיאן' — המייצגים חלק מהאמנות הייצוגית העתיקה ביותר שנמצאה אי פעם. מוזיאון הקיבוץ מציג את 'פסלוני הוונוס' הפרהיסטוריים." },
  { name:"Mitzpe Netofa",   lat:32.7978, lng:35.3189, region:"North",     tier:3, desc:"Community overlooking the Netofa Valley", nameHe:"מצפה נטופה", descHe:"ישוב המשקיף על עמק נטופה", fact:"Mitzpe Netofa was founded in 2012 as part of a government program to attract young families to the Galilee with subsidized housing. It was designed from scratch with modern infrastructure and family-friendly amenities, making it one of the few planned communities specifically targeting secular Israelis seeking small-town life.", factHe:"מצפה נטופה נוסדה ב-2012 כחלק מתוכנית ממשלתית למשוך משפחות צעירות לגליל עם דיור מסובסד. היא תוכננה מאפס עם תשתית מודרנית ושירותים ידידותיים למשפחה, מה שהופך אותה לאחת הקהילות המתוכננות הבודדות המכוונות במיוחד לישראלים חילוניים." },
  { name:"Isfiya",          lat:32.7152, lng:35.0671, region:"North",     tier:3, desc:"Druze village on Mount Carmel", nameHe:"עיספיה", descHe:"כפר דרוזי על הכרמל", fact:"Isfiya is an ancient Druze village on Mount Carmel that has existed for at least 400 years. It sits next to Daliyat al-Karmel, and together they form the heart of the Druze community on the Carmel ridge. The village is known for its traditional handicrafts, especially basket weaving, and its views over Haifa Bay are spectacular.", factHe:"עיספיה הוא כפר דרוזי עתיק על הכרמל שקיים לפחות 400 שנה. הוא יושב ליד דלית אל-כרמל, וביחד הן מהוות את לב הקהילה הדרוזית על רכס הכרמל. הכפר ידוע במלאכות יד מסורתיות, במיוחד אריגת סלים, והנוף שלו מעל מפרץ חיפה מרהיב." , arabVillage: true },
  { name:"Birya",           lat:32.9776, lng:35.5006, region:"North",     tier:3, desc:"Hilltop community overlooking Safed", nameHe:"ביריה", descHe:"קהילה על גבעה המשקיפה על צפת", fact:"Birya was the site of a dramatic confrontation in 1946 when the British tried to evict Jewish settlers from this strategic hilltop overlooking Safed. Thousands of Jews marched to Birya in protest, and the British backed down — a rare Jewish victory over the Mandate authorities that became a powerful symbol of pre-state resistance.", factHe:"ביריה הייתה אתר עימות דרמטי ב-1946 כשהבריטים ניסו לפנות מתיישבים יהודים מגבעה אסטרטגית זו המשקיפה על צפת. אלפי יהודים צעדו לביריה במחאה, והבריטים נסוגו — ניצחון יהודי נדיר על שלטונות המנדט." },
  { name:"Yoqne'am Illit",  lat:32.6583, lng:35.1108, region:"North",     tier:3, desc:"Upper Yokneam residential neighborhood", nameHe:"יקנעם עילית", descHe:"שכונת מגורים של יקנעם העילית", fact:"Yoqne'am Illit is the residential section of Yokneam, built on the hills above the industrial tech park. The separation creates an unusual two-tier city — with families living in the quiet upper neighborhoods while thousands work in the bustling technology corridor below.", factHe:"יקנעם עילית היא החלק המגורים של יקנעם, שנבנה על הגבעות מעל פארק הטכנולוגיה התעשייתי. ההפרדה יוצרת עיר דו-רמתית יוצאת דופן — עם משפחות שגרות בשכונות העליונות השקטות בעוד אלפים עובדים במסדרון הטכנולוגיה התוסס למטה." },
  { name:"Kibbutz Sasa",    lat:33.0611, lng:35.4556, region:"North",     tier:3, desc:"Northernmost kibbutz in Israel near Mount Meron", nameHe:"קיבוץ סאסא", descHe:"הקיבוץ הצפוני ביותר בישראל ליד הר מירון", fact:"Kibbutz Sasa, founded in 1949, is famous for being attacked by Lebanese forces on the very night of Israel's independence declaration. The settlers fought them off with limited weapons, and today Sasa thrives as one of Israel's most successful kibbutzim, running a major cosmetics factory that employs hundreds.", factHe:"קיבוץ סאסא, שנוסד ב-1949, מפורסם בכך שהותקף על ידי כוחות לבנונים בליל הכרזת עצמאות ישראל עצמו. המתיישבים הדפו אותם עם נשק מוגבל, וכיום סאסא משגשג כאחד הקיבוצים המצליחים ביותר בישראל." },
  { name:"Katzrin",         lat:32.9920, lng:35.6877, region:"North",     tier:3, desc:"Capital of the Golan Heights", nameHe:"קצרין", descHe:"בירת רמת הגולן", fact:"Katzrin is the only town (as opposed to moshav or kibbutz) in the Israeli-controlled Golan Heights. Founded in 1977 on the ruins of an ancient Jewish village, it serves as the administrative center for the Golan and features a restored ancient synagogue and a reconstructed Talmudic village that draws thousands of visitors.", factHe:"קצרין היא העיר היחידה (בניגוד למושב או קיבוץ) ברמת הגולן הנשלטת על ידי ישראל. נוסדה ב-1977 על חורבות כפר יהודי עתיק, משמשת כמרכז המנהלי של הגולן וכוללת בית כנסת עתיק משוחזר וכפר תלמודי משוחזר." },
  { name:"Neve Shalom",     lat:31.8478, lng:34.9894, region:"Jerusalem", tier:3, desc:"Unique Jewish-Arab cooperative village", nameHe:"נווה שלום", descHe:"כפר שיתופי יהודי-ערבי ייחודי", fact:"Neve Shalom (Wahat al-Salam in Arabic — both mean 'Oasis of Peace') is Israel's only intentionally mixed Jewish-Arab community. Founded in 1972 by a Dominican monk and a group of idealists, families from both communities choose to live together and raise their children bilingually, creating a living laboratory of coexistence unique in the Middle East.", factHe:"נווה שלום (ווהאת אל-סלאם בערבית — שניהם פירושם 'נווה המדבר של שלום') היא הקהילה היהודית-ערבית המעורבת במכוון היחידה בישראל. נוסדה ב-1972 על ידי נזיר דומיניקני וקבוצת אידיאליסטים, ומשפחות משתי הקהילות בוחרות לחיות יחד." },
  { name:"Buq'ata",         lat:33.2347, lng:35.7589, region:"North",     tier:3, desc:"Druze village on Mount Hermon in the Golan", nameHe:"בוקעאתא", descHe:"כפר דרוזי על הר חרמון ברמת הגולן", fact:"Buq'ata is the northernmost permanently inhabited community in Israeli-controlled territory, sitting on the slopes of Mount Hermon at over 1,100 meters elevation. Most residents are Druze who accepted Israeli citizenship after 1967, though a minority retained Syrian citizenship. The village is the gateway to Israel's only ski resort on Hermon's upper slopes.", factHe:"בוקעאתא היא הקהילה המיושבת הצפונית ביותר בשטח הנשלט על ידי ישראל, היושבת על מדרונות הר החרמון בגובה של למעלה מ-1,100 מטרים. רוב התושבים הם דרוזים שקיבלו אזרחות ישראלית לאחר 1967." , arabVillage: true },
  { name:"Mishmar HaNegev", lat:31.3908, lng:34.6864, region:"South",     tier:3, desc:"Historic kibbutz in the northern Negev", nameHe:"משמר הנגב", descHe:"קיבוץ היסטורי בצפון הנגב", fact:"Mishmar HaNegev played a crucial role in the 1948 war when Egyptian forces surrounded and besieged it for months. The kibbutz held out despite being vastly outnumbered, and the successful defense helped secure the northern Negev for Israel. Today a museum at the kibbutz preserves the original bunkers and tells the story of the siege.", factHe:"משמר הנגב שיחק תפקיד מכריע במלחמת 1948 כשכוחות מצריים הקיפו והטילו עליו מצור במשך חודשים. הקיבוץ החזיק מעמד למרות שהיה מועט במספר, וההגנה המוצלחת עזרה להבטיח את הנגב הצפוני לישראל." },
  { name:"Revivim",         lat:31.0432, lng:34.7207, region:"South",     tier:3, desc:"Historic kibbutz in the Negev Highlands", nameHe:"רביבים", descHe:"קיבוץ היסטורי בהר הנגב", fact:"Revivim was one of three 'tower and stockade' kibbutzim established in a single night in October 1943 deep in the Negev desert, at a time when the British had forbidden new Jewish settlements. The simultaneous founding of Revivim, Gvulot, and Beit Eshel was a bold assertion of Jewish claims to the Negev that helped establish the southern border of the future state.", factHe:"רביבים הייתה אחד משלושה קיבוצים 'חומה ומגדל' שהוקמו בלילה אחד באוקטובר 1943 עמוק במדבר הנגב, בזמן שהבריטים אסרו על התנחלויות יהודיות חדשות. ההקמה המקבילה של רביבים, גבולות ובאר אשל הייתה הצהרה נועזת." },
  { name:"Ramot Naftali",   lat:33.1333, lng:35.4833, region:"North",     tier:3, desc:"Kibbutz in the Upper Galilee Panhandle", nameHe:"רמות נפתלי", descHe:"קיבוץ בצבעון הגליל העליון", fact:"Ramot Naftali sits in the narrow 'Galilee Panhandle' — the finger of Israeli territory that juts north between Lebanon and Syria. During the 1948 war, Syrian forces briefly captured the kibbutz before being driven back. Its strategic location makes it one of the most vulnerable communities in Israel, regularly targeted during conflicts with Hezbollah.", factHe:"רמות נפתלי שוכן ב'צבעון הגליל' הצר — אצבע השטח הישראלי שבולטת צפונה בין לבנון לסוריה. במלחמת 1948 כוחות סורים כבשו בקצרה את הקיבוץ לפני שנדחקו אחורה. מיקומו האסטרטגי הופך אותו לאחת הקהילות הפגיעות ביותר בישראל." },
  // ── Major Road Interchanges — tier 4 (hard mode only) ────────────────────
  { name:"Gesher HaYarkon Interchange", lat:32.1020, lng:34.9180, region:"Center",  tier:4, desc:"Highway 40/444 junction near the Yarkon River", nameHe:"מחלף גשר הירקון", descHe:"מחלף כביש 40/444 בסמוך לנחל הירקון", fact:"The Yarkon River crossing here has been a strategic travel point since antiquity — Ottoman-era documents record a bridge toll station at this exact location. Today it's one of the busiest junctions in Israel, handling over 100,000 vehicles a day where Highway 40 meets the Trans-Israel Highway.", factHe:"מחלף גשר הירקון שוכן על נתיב מעבר עתיק שמסמכי העות'מאנים תיעדו בו תחנת גביית מכס על הגשר. כיום הוא אחד הצמתים העמוסים ביותר בישראל, עם למעלה מ-100,000 כלי רכב ביום." },
  { name:"Sha'ar HaGai Interchange",    lat:31.8030, lng:34.9730, region:"Jerusalem",tier:4, desc:"Highway 1/38 junction at the Jerusalem hills ascent", nameHe:"מחלף שער הגיא", descHe:"מחלף כביש 1/38 בעלייה להרי ירושלים", fact:"Sha'ar HaGai ('Gate of the Valley') marks the dramatic start of the ascent to Jerusalem, where the coastal plain suddenly gives way to the Judean Hills. Rusting armored vehicles from the 1948 war — left deliberately as a memorial — line the roadside here, commemorating the convoys that fought through Arab ambushes to bring food to besieged Jerusalem.", factHe:"שער הגיא מסמן את תחילת העלייה לירושלים מהשפלה — כאן המישור הופך לגבעות יהודה בפתאומיות. לאורך הכביש עומדים שרידי שריוניות מחורבות מ-1948 כאנדרטה לשיירות שנלחמו לשבור את המצור על ירושלים." },
  { name:"Qasem Interchange",           lat:32.3280, lng:35.0060, region:"Center",  tier:4, desc:"Highway 65/6 junction in the Wadi Ara corridor", nameHe:"מחלף קסם", descHe:"מחלף כביש 65/6 במסדרון ואדי ערה", fact:"The Wadi Ara road through this interchange follows an ancient trade and military route used since the Bronze Age — Egyptian, Assyrian, and Crusader armies all passed through this narrow valley. The interchange is named after Kafr Qasim, the nearby village site of a 1956 massacre of Arab civilians by Israeli border police that remains a painful chapter in Israeli history.", factHe:"מחלף קסם ממוקם בוואדי ערה, שהיה ציר מעבר מרכזי מהברונזה המוקדמת ועד ימינו — צבאות מצרים ואשור עברו בו. ליד המחלף שוכן כפר קאסם, זירת אחת מהפרשיות הקשות בתולדות מדינת ישראל." },
  { name:"Golani Interchange",          lat:32.7310, lng:35.3060, region:"North",   tier:4, desc:"Highway 77/90 junction gateway to the Lower Galilee", nameHe:"מחלף גולני", descHe:"מחלף כביש 77/90, שער לגליל התחתון", fact:"The Golani Interchange is named after the Golani Brigade, Israel's most decorated infantry unit, which was formed in the Lower Galilee in 1948 and has fought in every Israeli war. A large Golani Brigade memorial and museum stands adjacent to the interchange, making it both a transit hub and a pilgrimage site for soldiers and veterans.", factHe:"מחלף גולני קרוי על שם חטיבת גולני — החטיבה המפורסמת ביותר בצה\"ל. בסמוך למחלף ניצב מוזיאון גולני ואנדרטה לנופליה, שמושכים אלפי מבקרים מדי שנה." },
  { name:"Yokneam Interchange",         lat:32.6640, lng:35.1380, region:"North",   tier:4, desc:"Highway 70/2 junction at the Carmel foothills", nameHe:"מחלף יקנעם", descHe:"מחלף כביש 70/2 ברגלי הכרמל", fact:"This interchange sits at the mouth of the Iron Valley (Wadi Ara's northern counterpart), the pass through the Carmel range where the ancient Egyptian general Thutmose III launched his surprise attack on Canaanite forces in 1457 BCE — considered the earliest recorded military battle with detailed tactical documentation.", factHe:"מחלף יקנעם שוכן בפתח מעבר עמק יזרעאל — שם שיגר תחמוסיס השלישי את צבאו במפתיע ב-1457 לפנה\"ס בקרב הראשון המתועד בפירוט טקטי בהיסטוריה האנושית." },
  { name:"Glilot Interchange",          lat:32.1390, lng:34.8300, region:"Center",  tier:4, desc:"Highway 2/20 junction north of Tel Aviv", nameHe:"מחלף גלילות", descHe:"מחלף כביש 2/20 צפונית לתל אביב", fact:"Glilot Interchange sits adjacent to Glilot military base, which houses the headquarters of Unit 8200 — Israel's elite signals intelligence unit, often compared to the NSA and credited with many of Israel's most significant cyber operations. The area has become so dense with tech startups founded by 8200 alumni that it's nicknamed 'Silicon Wadi North.'", factHe:"מחלף גלילות שוכן בסמוך לבסיס גלילות, שבו שוכן מטה יחידה 8200 — יחידת המודיעין האותות של ישראל, הדומה ל-NSA. בוגרי היחידה הקימו מאות חברות הייטק המרוכזות סביב המחלף." },
  { name:"Hemed Interchange",           lat:32.0410, lng:34.9550, region:"Center",  tier:4, desc:"Highway 40/6 junction in the central plain", nameHe:"מחלף חמד", descHe:"מחלף כביש 40/6 במישור המרכזי", fact:"The Hemed area was the site of an important 1948 battle where Irgun and Haganah forces captured the strategic hill controlling the road to Jerusalem. The interchange today is one of the key entry points onto the Trans-Israel Highway (Route 6), Israel's only toll road, which was controversially built through the center of the country in the 2000s.", factHe:"אזור חמד היה זירת קרב ב-1948 שבו נלחמו כוחות ירדן ועצמאות ישראל על השליטה בדרך לירושלים. כיום הוא אחת הגישות המרכזיות אל כביש 6, כביש החוצה ישראל." },
  { name:"Eyal Interchange",            lat:32.1810, lng:34.9630, region:"Center",  tier:4, desc:"Highway 6/55 junction in the northern Sharon", nameHe:"מחלף אייל", descHe:"מחלף כביש 6/55 בצפון השרון", fact:"Eyal Interchange sits just meters from the Green Line — the 1949 armistice border — at a point where Israel is only about 15 kilometers wide, its narrowest point. The West Bank security barrier runs nearby, and on clear days you can see both the Mediterranean coast and the hills of Samaria from the overpass.", factHe:"מחלף אייל שוכן כמה מטרים מהקו הירוק — גבול 1949 — בנקודה שבה ישראל צרה לכ-15 קילומטרים. בימי בהירות אפשר לראות מהמחלף גם לכיוון הים התיכון וגם לכיוון השומרון." },
  { name:"Plugot Interchange",          lat:31.7680, lng:34.7200, region:"South",   tier:4, desc:"Highway 6/35 junction in the southern coastal plain", nameHe:"מחלף פלוגות", descHe:"מחלף כביש 6/35 במישור החוף הדרומי", fact:"'Plugot' means 'battalions' in Hebrew, named for the military formations that fought in this area during the 1948 War of Independence. The surrounding area contains some of Israel's most productive agricultural land — vast fields of wheat, sunflowers and vegetables stretch in every direction from the interchange.", factHe:"שם 'פלוגות' מציין את הכוחות הצבאיים שנלחמו באזור זה במלחמת העצמאות. הסביבה כיום שלווה לחלוטין — שדות חיטה, חמניות וירקות נמתחים לכל עבר." },
  { name:"Zohar Interchange",           lat:31.3950, lng:35.1640, region:"South",   tier:4, desc:"Highway 31/25 junction in the northern Negev", nameHe:"מחלף זוהר", descHe:"מחלף כביש 31/25 בצפון הנגב", fact:"Near Zohar Interchange lies the Nahal Zohar streambed, where archaeologists discovered a treasure trove of Byzantine-era gold coins in 2015 — 44 coins dating to the 7th century CE, perfectly preserved in the desert. The Dead Sea is visible just a few kilometers east, with its eerie white salt flats and turquoise waters.", factHe:"בסמוך למחלף זוהר נמצא נחל זוהר, שבו התגלו ב-2015 44 מטבעות זהב ביזנטיות מהמאה ה-7 לספירה, שמורות כחדשות בחול המדבר. ים המלח נראה ממנו כמה קילומטרים מזרחה." },
  { name:"Lehavim Interchange",         lat:31.3640, lng:34.8160, region:"South",   tier:4, desc:"Highway 6/40 junction north of Beer Sheva", nameHe:"מחלף להבים", descHe:"מחלף כביש 6/40 צפונית לבאר שבע", fact:"Lehavim Interchange is the southern terminus of the Trans-Israel Highway (Route 6) and marks the transition from Israel's settled center to the wide-open Negev desert. The nearby Lehavim community is notable as one of Israel's wealthiest rural communities, a striking contrast to the development towns just a few kilometers away.", factHe:"מחלף להבים מסמן את הקצה הדרומי של כביש 6 — ממנו ואילך נפרש הנגב הפתוח. הקהילה לידו, להבים, נחשבת לאחד היישובים העשירים ביותר בפריפריה, ניגוד בולט לעיירות הפיתוח הסמוכות." },
  { name:"Afula Interchange",           lat:32.5900, lng:35.2580, region:"North",   tier:4, desc:"Highway 60/65 junction in the Jezreel Valley", nameHe:"מחלף עפולה", descHe:"מחלף כביש 60/65 בעמק יזרעאל", fact:"This interchange sits in the heart of the Jezreel Valley, which was a malarial swamp purchased by early Zionists from absentee Arab landlords and painstakingly drained in the 1920s — one of the most dramatic landscape transformations in modern Israeli history. The valley is now some of the most fertile farmland in the Middle East.", factHe:"מחלף עפולה שוכן בלב עמק יזרעאל — ביצה מלארית שנרכשה בידי הציונים ונוקזה בשנות ה-20, שינוי נוף דרמטי שהפך את העמק לאחד הפוריים במזרח התיכון." },
  { name:"Haifa North Interchange",     lat:32.8350, lng:35.0420, region:"North",   tier:4, desc:"Highway 2/4/22 interchange in the Haifa bay area", nameHe:"מחלף חיפה צפון", descHe:"מחלף כביש 2/4/22 באזור מפרץ חיפה", fact:"The Haifa North Interchange is one of the most complex road junctions in Israel, where the coastal highway, the inland highway, and the Haifa bay industrial road converge. Just offshore from this point, divers have discovered ancient Phoenician anchors and a well-preserved Roman-era shipwreck loaded with marble columns, sitting undisturbed on the seafloor.", factHe:"מחלף חיפה צפון הוא אחד הצמתים המסועפים ביותר בישראל, שבו נפגשים כבישי החוף, הפנים ומפרץ חיפה. מולו, בקרקעית הים, שוכנים עוגנים פיניקיים ושברי ספינה רומית עמוסת עמודי שיש." },
  { name:"Gan Shmuel Interchange",      lat:32.4590, lng:34.9560, region:"Center",  tier:4, desc:"Highway 65/4 junction in the central Sharon", nameHe:"מחלף גן שמואל", descHe:"מחלף כביש 65/4 בשרון המרכזי", fact:"Gan Shmuel kibbutz, which gives this interchange its name, was founded in 1913 and is one of Israel's oldest and wealthiest kibbutzim — its juice factory, 'Gan Shmuel Foods,' supplies a large share of Israel's fresh-squeezed juice market. The surrounding Sharon region was once entirely orange groves, whose fragrance filled the coastal plain in spring.", factHe:"קיבוץ גן שמואל, שנותן שמו למחלף, הוא מהוותיקים בישראל ומפעיל מפעל מיצים המספק חלק ניכר מהמיצים הטריים בארץ. אזור השרון שמסביב היה פעם כולו פרדסי תפוזים שריחם מילא את המישור." },

  { name:"Caesarea Interchange",     lat:32.5056, lng:34.9067, region:"North",   tier:4, desc:"Highway 2/65 junction at the ancient Roman port city", fact:"The Caesarea Interchange marks the turnoff to one of the ancient world's greatest engineering achievements — Caesarea Maritima, Herod the Great's artificial harbor city, which had the first hydraulic concrete harbor in history. Today the Roman amphitheater beside this interchange regularly hosts sold-out rock concerts attended by 100,000 people.", factHe:"מחלף קיסריה מסמן את הפנייה לאחד ממפעלי ההנדסה הגדולים של העולם העתיק — קיסריה מריטימה של הורדוס, שבנה את הנמל הראשון בהיסטוריה המבוסס על בטון הידראולי. האמפיתיאטרון הרומי ליד המחלף מארח קונצרטים הנמכרים מראש עם 100,000 משתתפים.", nameHe:"מחלף קיסריה", descHe:"מחלף כביש 2/65 בסמוך לעיר הנמל הרומי העתיקה" },
  { name:"Megiddo Interchange",      lat:32.5816, lng:35.1850, region:"North",   tier:4, desc:"Highway 65/66 junction near the site of biblical Armageddon", fact:"The Megiddo Interchange sits directly below Tel Megiddo — the ancient city whose name gave the world the word 'Armageddon' (Har Megiddo — Mount of Megiddo), the prophesied site of the final battle. Over 34 separate layers of civilization have been excavated at Tel Megiddo, representing 9,000 years of continuous habitation at this critical crossroads.", factHe:"מחלף מגידו שוכן ממש מתחת לתל מגידו — העיר העתיקה ששמה נתן לעולם את המילה 'ארמגדון' (הר מגידו), מקום קרב האחרית על פי הנבואה. יותר מ-34 שכבות ציוויליזציה נחפרו בתל מגידו, המייצגות 9,000 שנות ישוב רציף.", nameHe:"מחלף מגידו", descHe:"מחלף כביש 65/66 בסמוך לאתר ארמגדון המקראי" },
  { name:"Geha Interchange",         lat:32.1090, lng:34.8590, region:"Center",  tier:4, desc:"Highway 4/40 junction, one of Israel's busiest road junctions", fact:"The Geha Interchange is one of the most congested junctions in Israel, where two of the country's major arteries cross — Route 4 (the old coastal road) and Route 40 (the main inland artery). It is named after Geha Mental Health Center, Israel's largest psychiatric hospital, which sits directly beside the interchange — leading to the dark joke that driving through it drives people crazy.", factHe:"מחלף גהה הוא אחד הצמתים הצפופים ביותר בישראל, שבו חוצים שניים מהכבישים הראשיים בארץ — כביש 4 וכביש 40. הוא קרוי על שם מרכז בריאות הנפש גהה — בית החולים הפסיכיאטרי הגדול בישראל — השוכן ממש לצד המחלף.", nameHe:"מחלף גהה", descHe:"מחלף כביש 4/40, אחד מהצמתים העמוסים בישראל" },
  { name:"Latrun Interchange",       lat:31.8367, lng:34.9833, region:"Jerusalem",tier:4, desc:"Highway 1/3 junction at the gateway to the Jerusalem hills", fact:"The Latrun Interchange marks the exact point where Israel's coastal plain ends and the Judean Hills begin — a geographical transition so abrupt you can feel the road start to climb within meters. The interchange was the site of some of the most ferocious fighting in the 1948 war, as both sides understood that whoever held Latrun controlled the road to Jerusalem.", factHe:"מחלף לטרון מסמן את הנקודה המדויקת שבה מסתיים מישור החוף ומתחילים הרי יהודה — מעבר גיאוגרפי כה פתאומי שניתן לחוש בו בכביש תוך מטרים. המחלף היה זירת הקרבות העזים ביותר במלחמת 1948, כשכל הצדדים הבינו שמי שמחזיק בלטרון שולט בדרך לירושלים.", nameHe:"מחלף לטרון", descHe:"מחלף כביש 1/3 בשער הרי ירושלים" },
  { name:"Beer Sheva North Interchange", lat:31.2970, lng:34.7990, region:"South", tier:4, desc:"Highway 40/6 junction, northern gateway to Beer Sheva", fact:"The Beer Sheva North Interchange is the southern terminus of the Trans-Israel Highway's northern segment and serves as the main gateway to Israel's 'capital of the Negev.' The surrounding area contains some of the world's largest solar farms, taking advantage of the Negev's 330 days of sunshine per year to generate power for much of southern Israel.", factHe:"מחלף באר שבע צפון הוא תחנת הקצה הדרומית של החלק הצפוני של כביש 6 ומהווה שער הכניסה הראשי ל'בירת הנגב'. האזור הסובב כולל כמה מחוות השמש הגדולות בעולם, המנצלות את 330 ימי השמש בשנה של הנגב לייצור חשמל לישראל הדרומית.", nameHe:"מחלף באר שבע צפון", descHe:"מחלף כביש 40/6, שער הכניסה הצפוני לבאר שבע" },
  { name:"Kfar Netter Interchange",  lat:32.3410, lng:34.9360, region:"Center",  tier:4, desc:"Highway 4/65 junction in the central Sharon", fact:"The Kfar Netter Interchange sits at the crossroads of the old coastal highway and the Wadi Ara road — a strategic junction that has channeled traffic between the coast and the valleys since the Ottoman era. Nearby Kfar Netter was founded by Baron de Rothschild's colonization organization in 1932, and its original red-roofed buildings still stand.", factHe:"מחלף כפר נטר שוכן בצומת כביש החוף הישן וכביש ואדי ערה — צומת אסטרטגי שניתב תנועה בין החוף לעמקים מאז התקופה העות'מאנית. כפר נטר הסמוך נוסד על ידי ארגון ההתיישבות של הברון דה רוטשילד ב-1932.", nameHe:"מחלף כפר נטר", descHe:"מחלף כביש 4/65 בשרון המרכזי" },
  { name:"Mahanayim Interchange",    lat:32.9700, lng:35.5680, region:"North",   tier:4, desc:"Highway 90/91 junction in the Upper Galilee near the Jordan Valley", fact:"Mahanayim Interchange sits near the site of ancient Mahanaim, where the Bible says the angels met Jacob on his return to Canaan. The area is at the gateway to the upper Jordan Valley — a fertile agricultural corridor that supplies much of Israel's fresh produce — and the small Mahanayim airfield nearby is one of Israel's oldest active airstrips.", factHe:"מחלף מחניים שוכן בסמוך לאתר מחניים המקראי, שבו לפי המסורת פגשו המלאכים את יעקב בדרכו חזרה לכנען. האזור נמצא בשערו של עמק הירדן העליון — מסדרון חקלאי פורה המספק חלק גדול מהתוצרת הטרייה של ישראל.", nameHe:"מחלף מחניים", descHe:"מחלף כביש 90/91 בגליל העליון, שער עמק הירדן" },

  { name:"Ben Gurion Interchange",   lat:32.0033, lng:34.8867, region:"Center",  tier:4, desc:"Highway 1/4 junction next to Ben Gurion Airport", fact:"The Ben Gurion Interchange is the main highway junction serving Israel's only international airport — Ben Gurion Airport — and handles some of the heaviest traffic in the country. The constant stream of taxis, buses, and rental cars to and from the terminals creates perpetual congestion, making it one of the most frustrating bottlenecks for travelers.", factHe:"מחלף בן גוריון הוא צומת הכבישים הראשי המשרת את נמל התעופה הבינלאומי היחיד של ישראל — נמל התעופה בן גוריון — ומטפל בחלק מהתנועה הכבדה ביותר בארץ. הזרם המתמיד של מוניות, אוטובוסים ורכבי השכרה אל הטרמינלים וממנו יוצר עומס תמידי.", nameHe:"מחלף בן גוריון", descHe:"מחלף כביש 1/4 ליד נמל התעופה בן גוריון" },
  { name:"Bilu Interchange",         lat:31.8639, lng:34.8167, region:"Center",  tier:4, desc:"Highway 412/431 junction in the southern coastal plain", fact:"The Bilu Interchange is named after the BILU movement — the first modern Zionist organization to promote 'aliyah' (immigration) to Ottoman Palestine in 1882. 'BILU' is a Hebrew acronym for 'House of Jacob, come let us go' from Isaiah 2:5, and the members of this group founded several of Israel's earliest agricultural settlements including Rishon LeZion.", factHe:"מחלף בילו קרוי על שם תנועת ביל\"ו — הארגון הציוני המודרני הראשון שקידם עלייה לפלסטין העות'מאנית ב-1882. 'ביל\"ו' הוא ראשי תיבות עבריים ל'בית יעקב לכו ונלכה' מישעיהו ב:ה, וחברי קבוצה זו הקימו כמה מהיישובים החקלאיים הראשונים.", nameHe:"מחלף בילו", descHe:"מחלף כביש 412/431 במישור החוף הדרומי" },
  { name:"HaSharon Interchange",     lat:32.1986, lng:34.8656, region:"Center",  tier:4, desc:"Highway 4/5 junction in the heart of the Sharon", fact:"The HaSharon Interchange connects the old coastal highway (Route 4) with Highway 5, which runs east to Ariel in the West Bank. The junction sits in the middle of orange groves that once covered the entire Sharon plain, and a few historic orchards are still visible from the highway — remnants of the citriculture industry that was Israel's economic backbone for decades.", factHe:"מחלף השרון מחבר את כביש החוף הישן (כביש 4) עם כביש 5, העובר מזרחה לאריאל ביהודה ושומרון. הצומת יושב בתוך פרדסי תפוזים שכיסו פעם את כל מישור השרון, וכמה מטעים היסטוריים עדיין נראים מהכביש.", nameHe:"מחלף השרון", descHe:"מחלף כביש 4/5 בלב השרון" },
  { name:"Ein Tut Interchange",      lat:32.6147, lng:35.0817, region:"North",   tier:4, desc:"Highway 70/75 junction near Yokneam", fact:"The Ein Tut Interchange sits at the western entrance to the Jezreel Valley, where the Megiddo Pass has historically been one of the most strategic chokepoints in the entire region. Armies from ancient Egypt, Assyria, Rome, the Crusaders, Napoleon, and Allenby all fought for control of this gateway — making it one of the most blood-soaked pieces of real estate in human history.", factHe:"מחלף עין טוט שוכן בכניסה המערבית לעמק יזרעאל, שם היה מעבר מגידו היסטורית אחד הצווארים האסטרטגיים החשובים ביותר באזור כולו. צבאות ממצרים העתיקה, אשור, רומא, הצלבנים, נפוליאון ואלנבי — כולם נלחמו על שליטה בשער זה.", nameHe:"מחלף עין טוט", descHe:"מחלף כביש 70/75 ליד יקנעם" },
  { name:"Morasha Interchange",      lat:32.1122, lng:34.8333, region:"Center",  tier:4, desc:"Highway 4/20 junction in central Gush Dan", fact:"The Morasha Interchange is one of the most congested junctions in the Tel Aviv metropolitan area, connecting two major arteries in the dense heart of Gush Dan. The name 'Morasha' means 'heritage' in Hebrew, though there's nothing particularly historic about the location — it simply connects Bnei Brak, Ramat Gan, and Petah Tikva at a chokepoint that traps commuters for hours.", factHe:"מחלף מורשה הוא אחד הצמתים הצפופים ביותר במטרופולין תל אביב, המחבר שני עורקים ראשיים בלב הצפוף של גוש דן. המילה 'מורשה' פירושה 'מורשת' בעברית, אם כי אין דבר היסטורי מיוחד במיקום.", nameHe:"מחלף מורשה", descHe:"מחלף כביש 4/20 במרכז גוש דן" },
  { name:"Ramat Yishay Interchange", lat:32.7103, lng:35.1372, region:"North",   tier:4, desc:"Highway 75/79 junction near Qiryat Tiv'on", fact:"The Ramat Yishay Interchange serves the rural council of Ramat Yishay, a cluster of small communities on the Carmel ridge. The junction marks the transition from the lowlands to the highlands, and in spring the surrounding hills explode with wildflowers — a brief window when the usually dry landscape transforms into a riot of color.", factHe:"מחלף רמת ישי משרת את המועצה האזורית רמת ישי, אשכול קהילות קטנות על רכס הכרמל. הצומת מסמן את המעבר מהשפלה לגבעות, ובאביב הגבעות הסובבות מתפוצצות בפרחי בר — חלון קצר שבו הנוף היבש בדרך כלל הופך למהומת צבעים.", nameHe:"מחלף רמת ישי", descHe:"מחלף כביש 75/79 ליד קריית טבעון" },
  { name:"Nahshonim Interchange",    lat:32.0097, lng:34.9275, region:"Center",  tier:4, desc:"Highway 1/6 junction between Tel Aviv and Jerusalem", fact:"The Nahshonim Interchange is where Highway 6 — Israel's main toll road running north-south — crosses Highway 1, the historic Tel Aviv-Jerusalem road. The location is named after Kibbutz Nahshonim, founded in 1949, which took its name from Nahshon ben Aminadav, the biblical figure who was the first to step into the Red Sea during the Exodus.", factHe:"מחלף נחשונים הוא המקום שבו כביש 6 — כביש האגרה הראשי של ישראל העובר צפון-דרום — חוצה את כביש 1, דרך תל אביב-ירושלים ההיסטורית. המיקום קרוי על שם קיבוץ נחשונים, שנוסד ב-1949 ושמו נלקח מנחשון בן עמינדב.", nameHe:"מחלף נחשונים", descHe:"מחלף כביש 1/6 בין תל אביב לירושלים" },

  // ── NEWLY ADDED CITIES ──────────────────────────────────────────────────
  { name:"Elad",            lat:32.0501, lng:34.9522, region:"Center",    tier:2, desc:"Haredi city founded in 1998 east of Petah Tikva", nameHe:"אלעד", descHe:"עיר חרדית שנוסדה ב-1998 ממזרח לפתח תקווה", fact:"Elad was established in 1998 and grew with extraordinary speed, becoming one of Israel's fastest-growing cities due to its large ultra-Orthodox population. The city's name is an acronym for 'El David' (To David), a nod to the biblical king, and it sits near the ancient Philistine city of Ekron. With one of the highest birth rates in the country, Elad's infrastructure is in a constant race to keep up with its swelling population.", factHe:"אלעד הוקמה ב-1998 וצמחה במהירות יוצאת דופן, והפכה לאחת הערים הצומחות ביותר בישראל בזכות אוכלוסייתה החרדית הגדולה. שם העיר הוא ראשי תיבות של 'אל דוד', וזו אחת הערים בעלות שיעור הילודה הגבוה ביותר בישראל." },
  { name:"Hazor HaGlilit",  lat:32.9792, lng:35.5433, region:"North",     tier:3, desc:"Development town in the Upper Galilee near the ancient Tel Hazor", nameHe:"חצור הגלילית", descHe:"עיירת פיתוח בגליל העליון, בסמוך לתל חצור העתיק", fact:"Hazor HaGlilit was established in 1953 as a development town for new immigrants, but it sits in the shadow of Tel Hazor — the largest biblical-era site in Israel, where a great Canaanite city-state once dominated the northern trade routes. The ancient city of Hazor, just nearby, is mentioned in Egyptian records, the Book of Joshua, and even the Mari archives from ancient Syria, attesting to its regional importance 3,500 years ago.", factHe:"חצור הגלילית הוקמה ב-1953 כעיירת פיתוח לעולים חדשים, אך היא יושבת בצלו של תל חצור — האתר הגדול ביותר מהתקופה המקראית בישראל. חצור העתיקה מוזכרת במסמכים מצריים, בספר יהושע ואף בארכיוני מארי הסוריים." },
  { name:"Hura",             lat:31.2972, lng:34.9379, region:"South",     tier:3, desc:"Bedouin city in the Negev, one of the first to be officially recognized", nameHe:"חורה", descHe:"עיר בדואית בנגב, מהראשונות שהוכרו רשמית", fact:"Hura was established in 1989 as one of the first Bedouin townships officially recognized by the Israeli government, part of an effort to transition nomadic and semi-nomadic Bedouin communities into permanent settlements. The city faces significant challenges: high unemployment, rapid population growth, and a history of conflict over land rights with the state. Despite this, Hura has developed a strong local identity and hosts one of the Negev's most vibrant weekly markets.", factHe:"חורה הוקמה ב-1989 כאחד מהיישובים הבדואיים הראשונים שהוכרו רשמית על ידי המדינה, כחלק ממאמץ להעביר קהילות נוודות למגורים קבועים. היא מתמודדת עם אתגרי תעסוקה, גידול אוכלוסין מהיר ומחלוקות קרקע, אך פיתחה זהות מקומית חזקה." , arabVillage: true },
  { name:"Jaljulia",         lat:32.1523, lng:34.9537, region:"Center",    tier:3, desc:"Arab town in the Triangle east of Kfar Saba", nameHe:"ג'לג'וליה", descHe:"עיירה ערבית במשולש, ממזרח לכפר סבא", fact:"Jaljulia sits directly on the Green Line — the 1949 armistice border — and for decades its residents could see across a barbed-wire fence to the West Bank town of Beit Arye just meters away. The town's name likely derives from the ancient Canaanite toponym, and archaeological finds in the area date back to the Bronze Age. Jaljulia has a high rate of car ownership and an economy heavily tied to construction and small industry.", factHe:"ג'לג'וליה יושבת ממש על הקו הירוק — גבול 1949 — ולאורך שנים יכלו תושביה לראות דרך גדר תיל אל העיירה הפלסטינית בית אריה שממש מעברה. שמה נגזר מטופונים כנעני עתיק, וממצאים ארכאולוגיים באזור מתוארכים לתקופת הברונזה." , arabVillage: true },
  { name:"Kadima-Zoran",     lat:32.3033, lng:34.9197, region:"Center",    tier:2, desc:"Town in the Sharon formed by merging two older communities", nameHe:"קדימה-צורן", descHe:"עיירה בשרון שנוצרה ממיזוג שני יישובים", fact:"Kadima and Zoran were merged into a single municipality in 2003, creating one of Israel's 'twin towns.' Kadima — meaning 'forward' — was also the name of Ariel Sharon's centrist political party, which he founded in 2005 after leaving Likud, though the town predates the party by decades. The merged community sits at the heart of Israel's citrus-growing country, and its surrounding orange and grapefruit groves are among the last large orchards remaining in the crowded Sharon plain.", factHe:"קדימה וצורן אוחדו לעירייה אחת ב-2003. 'קדימה' היה גם שם מפלגתו של אריאל שרון, שהקים ב-2005 לאחר פרישתו מהליכוד — אם כי העיירה קדמה למפלגה בעשרות שנים. היישוב יושב בלב אזור הגידול של פרי הדר בישראל." },
  { name:"Kafr Kanna",       lat:32.7460, lng:35.3398, region:"North",     tier:2, desc:"Arab city traditionally identified as the site of Jesus's first miracle", nameHe:"כפר כנא", descHe:"עיר ערבית המזוהה מסורתית עם נס הפיכת המים ליין", fact:"Kafr Kanna is traditionally identified as the biblical Cana of Galilee where, according to the Gospel of John, Jesus performed his first miracle — turning water into wine at a wedding feast. Two Franciscan churches and a Greek Orthodox church mark the supposed site, drawing pilgrims year-round. Despite its Christian significance, Kafr Kanna is predominantly Muslim today, and its residents navigate a unique daily reality in which religious tourism from across the world is woven into ordinary town life.", factHe:"כפר כנא מזוהה מסורתית עם קנה שבגליל, שלפי הבשורה על פי יוחנן בה ביצע ישו את נסו הראשון — הפיכת מים ליין בחתונה. שתי כנסיות פרנציסקניות וכנסייה יוונית-אורתודוקסית מציינות את האתר. למרות חשיבותה הנוצרית, רוב תושבי כפר כנא כיום מוסלמים." , arabVillage: true },
  { name:"Kfar Yona",        lat:32.3145, lng:34.9321, region:"Center",    tier:2, desc:"Town in the Sharon north of Netanya", nameHe:"כפר יונה", descHe:"עיירה בשרון, צפונית לנתניה", fact:"Kfar Yona was founded in 1932 and named after Yona Halperin, one of the founders of the Labor movement in Palestine. For decades it remained a quiet agricultural moshav growing citrus fruit, but rapid urbanization transformed it into a full town. It sits at the intersection of some of the Sharon's main arteries and has become a bedroom community for Tel Aviv commuters — a transformation repeated across dozens of former farming villages in Israel's coastal plain.", factHe:"כפר יונה נוסדה ב-1932 ונקראה על שם יונה הלפרין, אחד ממייסדי תנועת העבודה בארץ ישראל. במשך עשורים נשארה מושב חקלאי שקט לגידול פרי הדר, אך עיור מהיר הפך אותה לעיירה. כיום היא עיר שינה לרבים מהמועסקים בתל אביב." },
  { name:"Kiryat Arba",      lat:31.5278, lng:35.1192, region:"West Bank",  tier:2, desc:"Large settlement adjacent to Hebron, site of the 1994 Cave of Machpelah massacre", nameHe:"קריית ארבע", descHe:"ישוב גדול סמוך לחברון, אתר טבח מערת המכפלה 1994", fact:"Kiryat Arba was the first modern Jewish settlement established in the West Bank after 1967, founded in 1970 when a group of settlers led by Rabbi Moshe Levinger checked into a Hebron hotel claiming to be Swiss tourists and then refused to leave. It sits adjacent to Hebron and next to the Cave of Machpelah — the second holiest site in Judaism, where Abraham, Isaac, Jacob, Sarah, Rebecca, and Leah are said to be buried. In 1994, Kiryat Arba resident Baruch Goldstein carried out the Cave of Machpelah massacre, killing 29 Palestinian worshippers.", factHe:"קריית ארבע הייתה ההתנחלות הראשונה שהוקמה ביהודה ושומרון לאחר 1967, ב-1970, כשקבוצה בהנהגת הרב משה לוינגר התמקמה במלון בחברון וסירבה לעזוב. היא שוכנת ליד מערת המכפלה, האתר השני בקדושתו ליהדות. ב-1994 ביצע תושב קריית ארבע, ברוך גולדשטיין, את טבח מערת המכפלה שבו נרצחו 29 מתפללים פלסטינים." },
  { name:"Kiryat Ekron",     lat:31.8608, lng:34.8233, region:"Center",    tier:3, desc:"Small town in the Shephelah between Ashdod and Rehovot", nameHe:"קריית עקרון", descHe:"עיירה קטנה בשפלה בין אשדוד לרחובות", fact:"Kiryat Ekron sits near the ancient site of Ekron — one of the five Philistine city-states mentioned throughout the Hebrew Bible, known for its massive olive oil industry that archaeologists have uncovered. The modern town was established in 1948 as a transit camp for new immigrants and grew into a permanent community. It has one of Israel's highest concentrations of immigrants from Ethiopia and is home to a major absorption center that has processed thousands of new arrivals.", factHe:"קריית עקרון יושבת ליד האתר העתיק של עקרון — אחת מחמש ערי-המדינה הפלישתיות, הידועה בתעשיית שמן הזית העצומה שלה שארכאולוגים חשפו. העיירה הוקמה ב-1948 כמחנה מעבר לעולים חדשים. כיום יש בה ריכוז גבוה של עולים מאתיופיה." },
  { name:"Laqiya",           lat:31.3233, lng:34.9217, region:"South",     tier:3, desc:"Bedouin city in the Negev, model for planned Bedouin urbanization", nameHe:"לקיה", descHe:"עיר בדואית בנגב, מודל לעיור מתוכנן", fact:"Laqiya was established in 1990 as a planned Bedouin township and has become something of a model for social development in Israel's Bedouin sector. The city is home to the Association for the Improvement of the Status of Women, a Bedouin-led NGO that has been recognized internationally for empowering Bedouin women through economic and educational programs — fighting polygamy, early marriage, and domestic violence in a deeply traditional society.", factHe:"לקיה הוקמה ב-1990 כיישוב בדואי מתוכנן והפכה למעין מודל לפיתוח חברתי במגזר הבדואי. בעיר פועלת 'עמותה לשיפור מעמד האישה', ארגון בדואי שזכה להכרה בינלאומית בשל חיזוק מעמד האישה הבדואית בתחומי כלכלה, חינוך ומאבק בפוליגמיה ובנישואין מוקדמים." , arabVillage: true },
  { name:"Lehavim",          lat:31.3703, lng:34.81370, region:"South",     tier:3, desc:"Affluent community settlement in the northern Negev", nameHe:"להבים", descHe:"ישוב קהילתי אמיד בצפון הנגב", fact:"Lehavim is one of Israel's wealthiest community settlements, established in 1984 on the edge of the northern Negev. It was built as a planned community with strict admission criteria and has attracted high-income professionals, many of them working in Beer Sheva's high-tech and defense industries. Despite its location in the Negev — associated in Israeli consciousness with hardship and frontier life — Lehavim enjoys a quality of life comparable to Israel's most sought-after suburbs.", factHe:"להבים הוא אחד מהיישובים הקהילתיים העשירים ביותר בישראל, שהוקם ב-1984 על קצה הנגב הצפוני. הוא נבנה כקהילה מתוכננת עם קריטריונים קפדניים לקבלת תושבים, ומשך אנשי מקצוע בעלי הכנסה גבוהה — רבים מהם עובדים בהייטק ובתעשיות הביטחון של באר שבע." },
  { name:"Majdal Shams",     lat:33.2684, lng:35.7694, region:"North",     tier:3, desc:"Largest Druze village in the Golan Heights, near Mount Hermon", nameHe:"מג'דל שמס", descHe:"הכפר הדרוזי הגדול ביותר ברמת הגולן, בסמוך להר חרמון", fact:"Majdal Shams is the largest of four Druze villages in the Golan Heights, an area Israel captured from Syria in 1967. Most residents identify as Syrian rather than Israeli and refused Israeli citizenship when it was offered in 1982 — they hold residency status instead. The village became famous for the 'Shouting Fence,' where Druze families divided by the border would gather on either side to shout news across to each other before modern communication made it obsolete. The village sits at the foot of Mount Hermon, which provides winter skiing.", factHe:"מג'דל שמס הוא הגדול מבין ארבעה כפרים דרוזיים ברמת הגולן שנכבשה מסוריה ב-1967. רוב התושבים מזדהים כסורים ולא כישראלים וסירבו לאזרחות הישראלית שהוצעה להם ב-1982. הכפר מפורסם ב'גדר הצעקות', שם נהגו משפחות דרוזיות שהופרדו על ידי הגבול להתאסף ולצעוק חדשות זו לזו." , arabVillage: true },
  { name:"Mazkeret Batya",   lat:31.8422, lng:34.8560, region:"Center",    tier:3, desc:"Historic agricultural village founded in 1883, one of Israel's first Zionist settlements", nameHe:"מזכרת בתיה", descHe:"כפר חקלאי היסטורי שנוסד ב-1883, מהמושבות הציוניות הראשונות", fact:"Mazkeret Batya was founded in 1883 by Romanian Jewish immigrants and named after the mother of Baron Edmond de Rothschild — 'Batya' in her honor. It was one of the very first Zionist agricultural colonies and struggled for years with malaria, failed crops, and financial ruin before Rothschild's patronage saved it. The town preserves more of its original 19th-century Ottoman-era stone architecture than almost any other community in central Israel, with tree-lined streets and stone houses that look unchanged since the founders' time.", factHe:"מזכרת בתיה נוסדה ב-1883 על ידי עולים יהודים מרומניה ונקראה על שם אמו של הברון אדמונד דה רוטשילד. היא הייתה מהמושבות הציוניות הראשונות ונאבקה שנים בקדחת, ביבולים כושלים ובמשבר כלכלי לפני שחסדי רוטשילד הצילוה. העיירה שומרת על ארכיטקטורת אבן עות'מאנית יוצאת דופן מהמאה ה-19." },
  { name:"Migdal",           lat:32.8387, lng:35.4994, region:"North",     tier:3, desc:"Small village on the western shore of the Sea of Galilee", nameHe:"מגדל", descHe:"כפר קטן על החוף המערבי של הכנרת", fact:"Migdal is traditionally identified as Magdala, the hometown of Mary Magdalene — making it one of the most significant sites in Christian history. Archaeological excavations launched after a hotel construction project accidentally uncovered a 1st-century synagogue, one of the oldest ever found and one of the few that existed during Jesus's lifetime. The 'Magdala Stone' discovered there, carved with a menorah, is one of the most important Jewish archaeological finds of the modern era.", factHe:"מגדל מזוהה מסורתית עם מגדלא, עיר מולדתה של מרים המגדלית — אחד האתרים המשמעותיים ביותר בהיסטוריה הנוצרית. חפירות ארכאולוגיות שנחשפו בעקבות בנייה מקרית גילו בית כנסת מהמאה ה-1 — אחד העתיקים שנמצאו אי פעם. 'אבן מגדלא' עם מנורה חרוטה עליה נחשבת לאחד הממצאים היהודיים החשובים של העידן המודרני." },
  { name:"Modi'in Illit",    lat:31.9333, lng:35.0333, region:"West Bank",  tier:2, desc:"Large Haredi city in the West Bank, one of the fastest growing in Israel", nameHe:"מודיעין עילית", descHe:"עיר חרדית גדולה ביהודה ושומרון, מהצומחות ביותר בישראל", fact:"Modi'in Illit, also known as Kiryat Sefer, was established in 1994 and has grown explosively to over 80,000 residents — making it the second-largest Israeli settlement in the West Bank and one of the fastest-growing cities in the entire country. Almost entirely ultra-Orthodox, its population doubles roughly every decade due to extremely high birth rates. The city straddles the Green Line: part of it is inside Israel's pre-1967 borders and part is in the West Bank — a geographic quirk with significant political implications.", factHe:"מודיעין עילית, הידועה גם כקריית ספר, הוקמה ב-1994 וצמחה במהירות לכ-80,000 תושבים, מה שהופך אותה לאחת הערים הצומחות ביותר בישראל. כמעט כולה חרדית, אוכלוסייתה מכפילה את עצמה כל עשור בשל שיעורי ילודה גבוהים מאוד. העיר יושבת על הקו הירוק." },
  { name:"Oranit",           lat:32.0936, lng:35.0228, region:"West Bank",  tier:3, desc:"Small community settlement on the eastern edge of the Sharon, near the Green Line", nameHe:"אורנית", descHe:"יישוב קהילתי קטן על קצה השרון המזרחי, בסמוך לקו הירוק", fact:"Oranit is one of the smallest Israeli settlements in the West Bank but one of the most ideologically significant in the legal debate over the region: it was the first settlement to receive city status from the State of Israel while located beyond the Green Line. The community was established in 1985 and is largely secular, in contrast to many other West Bank settlements. It sits on a hilltop with panoramic views west to the Mediterranean and east to the Samarian hills.", factHe:"אורנית היא אחת ההתנחלויות הישראליות הקטנות ביותר ביהודה ושומרון, אך בעלת חשיבות משפטית — היא הייתה ההתנחלות הראשונה שקיבלה מעמד עירוני מהמדינה בעודה ממוקמת מעבר לקו הירוק. היישוב הוקם ב-1985 והוא חילוני ברובו." },
  { name:"Pardesiya",        lat:32.3070, lng:34.9098, region:"Center",    tier:3, desc:"Small moshav in the Sharon plain known for its citrus heritage", nameHe:"פרדסיה", descHe:"מושב קטן במישור השרון, ידוע במורשת ההדרים שלו", fact:"Pardesiya — the name means 'citrus grove town' in Hebrew — was founded in 1942 and built entirely around the orange and grapefruit industry that defined the Sharon plain for a century. At its peak it was surrounded by some of the most productive citrus orchards in the world, supplying the famous Jaffa orange brand to markets across Europe. Today most of the orchards are gone, replaced by industry and suburban housing, but the name remains a reminder of the landscape that once defined the entire region.", factHe:"פרדסיה — השם פירושו 'עיר הפרדסים' — נוסדה ב-1942 ונבנתה כולה סביב תעשיית ההדרים שהגדירה את מישור השרון במשך מאה שנה. בשיאה הוקפה בחלק מהפרדסים הפרודוקטיביים ביותר בעולם, שסיפקו לשווקים ברחבי אירופה את תפוז יפו המפורסם." },
  { name:"Rajar",            lat:33.1256, lng:35.6531, region:"North",     tier:3, desc:"Unique Alawite village split by the Israeli-Lebanese border", nameHe:"ראג'ר", descHe:"כפר עלווי ייחודי שמפוצל על ידי הגבול הישראלי-לבנוני", fact:"Rajar is the only permanently inhabited Israeli village that sits entirely on both sides of the Lebanese border — half the village is in Israel and half is in Lebanon, with the UN Blue Line running through it. Its residents are Alawite Muslims, affiliated with the same sect as Syria's Assad family. After Israel withdrew from Lebanon in 2000, the northern half was left in Lebanese territory, but Israel has maintained control of the entire village. Residents can freely cross the border within the village but cannot travel to the rest of Lebanon or Syria.", factHe:"ראג'ר הוא הכפר הישראלי היחיד שיושב כולו משני צידי הגבול הלבנוני — מחציתו בישראל ומחציתו בלבנון, כשקו האו\"ם עובר דרכו. תושביו הם מוסלמים עלווים. לאחר הנסיגה מלבנון ב-2000, נשאר החלק הצפוני בשטח לבנוני, אך ישראל שמרה על שליטה בכל הכפר." },
  { name:"Rehasim",          lat:32.7194, lng:35.0981, region:"North",     tier:3, desc:"Haredi community near Kiryat Ata on the Carmel ridge", nameHe:"רכסים", descHe:"קהילה חרדית ליד קריית אתא על רכס הכרמל", fact:"Rehasim was established in 1957 and gradually transformed from a mixed community into a predominantly Haredi town, a process that reshaped its character entirely over several decades. The community sits on the eastern slopes of the Carmel ridge, overlooking the Jezreel Valley below. Its name means 'ridges' in Hebrew — a reference to the rocky Carmel landscape. It is one of the smaller ultra-Orthodox communities in Israel and maintains a quieter, less politically charged character than larger Haredi centers like Bnei Brak or Beitar Illit.", factHe:"רכסים הוקמה ב-1957 והפכה בהדרגה מקהילה מעורבת לעיר חרדית בעיקרה. היישוב יושב על המדרונות המזרחיים של רכס הכרמל ומשקיף על עמק יזרעאל. שמו פירושו 'רכסים' בעברית — רמז לנוף הסלעי של הכרמל." },
  { name:"Savyon",           lat:32.0485, lng:34.8792, region:"Center",    tier:3, desc:"One of Israel's wealthiest garden suburbs, east of Tel Aviv", nameHe:"סביון", descHe:"אחד הפרוורים האמידים ביותר בישראל, ממזרח לתל אביב", fact:"Savyon is consistently ranked as one of Israel's wealthiest communities, with average real estate prices among the highest in the country. Founded in 1954 and named after the yellow wildflower (groundsel) that blooms across the area in spring, it was designed as a garden suburb with large plots, winding roads, and no commercial center — meant to feel entirely residential. The community famously resisted urbanization for decades: it has no traffic lights, no apartment buildings, and a strict committee that vets prospective residents.", factHe:"סביון מדורגת בעקביות כאחת הקהילות העשירות ביותר בישראל, עם מחירי נדל\"ן בין הגבוהים בארץ. נוסדה ב-1954 ונקראת על שם הסביון — פרח הבר הצהוב הפורח באביב. היא תוכננה כפרוור גינות ללא מרכז מסחרי, ועמדה בפני עיור: אין בה רמזורים, בניינים רב-קומתיים, או ועדת קבלה שתאשר כל דייר." },
  { name:"Shlomi",           lat:33.0761, lng:35.1486, region:"North",     tier:3, desc:"Development town in the western Galilee near the Lebanese border", nameHe:"שלומי", descHe:"עיירת פיתוח בגליל המערבי, בסמוך לגבול הלבנוני", fact:"Shlomi is Israel's northernmost coastal town, just kilometers from the Lebanese border, and has been repeatedly struck by Katyusha rockets during conflicts with Hezbollah. The town was established in 1950 for new immigrants and named after a biblical figure — 'Shlomi' means 'my peace' in Hebrew, an ironic name given its proximity to one of Israel's most volatile borders. Despite the security challenges, Shlomi has developed a reputation for its fish restaurants on the Achziv coast and as a gateway to Rosh HaNikra, the dramatic white chalk cliffs on the border.", factHe:"שלומי היא עיירת החוף הצפונית ביותר בישראל, כמה קילומטרים מהגבול הלבנוני, וספגה שוב ושוב פגיעות קטיושה בסכסוכים עם חיזבאללה. הוקמה ב-1950 לעולים חדשים ונקראה 'שלומי' — שם אירוני למדי נוכח קירבתה לגבול הסוער." },
  { name:"Tel Sheva",        lat:31.2531, lng:34.9989, region:"South",     tier:3, desc:"Bedouin city near Beer Sheva, one of the first Bedouin townships in the Negev", nameHe:"תל שבע", descHe:"עיר בדואית ליד באר שבע, מהיישובים הבדואיים הראשונים בנגב", fact:"Tel Sheva sits adjacent to Tell es-Seba, one of the most significant archaeological sites in Israel — an ancient Canaanite and Israelite city mentioned throughout the Bible as Beersheba, the southern boundary of the Israelite kingdom ('from Dan to Beersheba'). The modern Bedouin town was established in 1967 during a government effort to settle the Negev Bedouin, and residents were relocated from the surrounding desert into planned housing. The combination of biblical archaeology and living Bedouin culture makes Tel Sheva one of Israel's most layered communities.", factHe:"תל שבע יושבת ליד תל אל-סבע, אחד האתרים הארכאולוגיים החשובים ביותר בישראל — עיר כנענית וישראלית עתיקה המוזכרת לאורך כל התנ\"ך כבאר שבע, הגבול הדרומי של הממלכה הישראלית ('מדן ועד באר שבע'). העיר הבדואית המודרנית הוקמה ב-1967 כחלק ממאמץ ממשלתי להסדיר את הבדואים בנגב." , arabVillage: true },
  { name:"Tuba-Zangariyye",  lat:32.9386, lng:35.5803, region:"North",     tier:3, desc:"Arab village on the shore of the Sea of Galilee in the Jordan Valley", nameHe:"טובא-זנגריה", descHe:"כפר ערבי על גדות הכנרת בעמק הירדן", fact:"Tuba-Zangariyye is a local council formed by the merger of two Arab villages on the northeastern shore of the Sea of Galilee, where the Jordan River flows out. The area has been settled since ancient times — excavations nearby have uncovered sites from the Bronze Age and later periods. The combined community has developed a small tourism economy based on the Sea of Galilee shoreline and fishing, and has a reputation for producing some of the region's best freshwater fish.", factHe:"טובא-זנגריה היא מועצה מקומית שנוצרה ממיזוג שני כפרים ערביים על החוף הצפון-מזרחי של הכנרת, שם זורם נהר הירדן. האזור מיושב מאז העת העתיקה — חפירות ארכאולוגיות גילו אתרים מתקופת הברונזה. הקהילה המאוחדת פיתחה כלכלת תיירות קטנה המבוססת על חוף הכנרת ועל הדיג." , arabVillage: true },
  { name:"Turan",            lat:32.7773, lng:35.3725, region:"North",     tier:3, desc:"Arab town in the Lower Galilee in the Jezreel Valley foothills", nameHe:"טורען", descHe:"עיירה ערבית בגליל התחתון, בשולי עמק יזרעאל", fact:"Turan's name is believed to derive from the ancient Aramaic for 'rock' or 'cliff' — a reference to the basalt terrain on which the village is built. The community is mixed Muslim and Christian, a rarity in the Galilee, and has maintained relatively peaceful interfaith relations for generations. Turan's residents have high rates of higher education relative to comparable Arab communities, and the town has produced a notable number of doctors, engineers, and academics.", factHe:"שמה של טורען מאמינים שנגזר מהארמית ל'סלע' — רמז לקרקע הבזלתית שעליה בנוי הכפר. הקהילה מעורבת מוסלמים ונוצרים, דבר נדיר בגליל, ושמרה על יחסים בין-דתיים שלווים לאורך דורות. לתושבי טורען שיעורי השכלה גבוהים יחסית." , arabVillage: true },
  { name:"Yafi'a",           lat:32.6866, lng:35.2772, region:"North",     tier:3, desc:"Arab city south of Nazareth, one of the largest Arab municipalities in the north", nameHe:"יפיע", descHe:"עיר ערבית דרומית לנצרת, מהרשויות הערביות הגדולות בצפון", fact:"Yafi'a is one of the largest Arab municipalities in northern Israel, with a population of around 20,000. The city is almost entirely Muslim and has a strong tradition of commerce and construction. During the 1948 war, Yafi'a was captured by Israeli forces in May 1948 in what locals describe as a traumatic event — the population was expelled and the town resettled, though some families eventually returned. The city's mosque, built on the ruins of a Crusader-era church, is one of the oldest functioning mosques in the Galilee.", factHe:"יפיע היא אחת מהרשויות הערביות הגדולות בצפון ישראל, עם כ-20,000 תושבים. העיר מוסלמית כמעט לחלוטין ובעלת מסורת חזקה של מסחר ובינוי. במלחמת 1948 נכבשה על ידי כוחות ישראליים ואוכלוסייתה גורשה, אם כי חלק מהמשפחות חזרו בסופו של דבר." , arabVillage: true },
  { name:"Yanuh-Jat",        lat:32.9586, lng:35.1481, region:"North",     tier:3, desc:"Two merged Druze and Arab villages in the western Galilee", nameHe:"ינוח-ג'ת", descHe:"שני כפרים דרוזיים וערביים שאוחדו בגליל המערבי", fact:"Yanuh-Jat was formed by the administrative merger of two neighboring villages — Yanuh, predominantly Druze, and Jat, predominantly Christian Arab. The two communities have distinct religious identities and social norms yet share a single municipality, an unusual arrangement that requires constant negotiation and compromise. The joint local council has managed to fund shared infrastructure while respecting the communities' different traditions — a model of coexistence that Israeli officials sometimes cite as an example for mixed communities elsewhere.", factHe:"ינוח-ג'ת נוצרה ממיזוג מנהלי של שני כפרים שכנים — ינוח, דרוזי ברובו, וג'ת, נוצרי ברובו. שתי הקהילות בעלות זהויות דתיות שונות אך חולקות עירייה אחת — הסדר חריג הדורש משא ומתן ופשרה מתמידים." , arabVillage: true },
  { name:"Yesud HaMa'ala",   lat:33.0574, lng:35.6030, region:"North",     tier:3, desc:"One of Israel's oldest agricultural settlements, founded in 1883 in the Hula Valley", nameHe:"יסוד המעלה", descHe:"מהיישובים החקלאיים הוותיקים ביותר בישראל, שנוסד ב-1883 בעמק החולה", fact:"Yesud HaMa'ala, meaning 'Foundation of the Ascent' — a reference to the return of Jewish exiles to the Land of Israel — was founded in 1883 by Romanian Jewish immigrants, making it one of the very oldest Zionist settlements. The village sits in the Hula Valley, which was once one of the Middle East's largest freshwater wetlands. In the 1950s the swamp was controversially drained to create farmland — an act later recognized as an ecological disaster — and partially re-flooded in the 1990s, creating the Hula Nature Reserve that today hosts millions of migrating birds each autumn.", factHe:"יסוד המעלה, שמשמעותו 'יסוד העלייה' — רמז לשיבת גולים לארץ ישראל — נוסדה ב-1883 על ידי עולים יהודים רומנים, ומהיישובים הציוניים הוותיקים ביותר. הכפר יושב בעמק החולה, שהיה פעם מהאזורים הלחים הגדולים ביותר במזרח התיכון. בשנות ה-50 יובשה הביצה להרחבת שטחי חקלאות, מעשה שהוכר כאסון אקולוגי, ובשנות ה-90 הוצפה חלקית מחדש." },
  { name:"Yirka",            lat:32.9517, lng:35.1683, region:"North",     tier:3, desc:"Druze village in the western Galilee, known for high IDF service rates", nameHe:"ירכא", descHe:"כפר דרוזי בגליל המערבי, ידוע בשיעורי שירות גבוהים בצה\"ל", fact:"Yirka is one of the larger Druze villages in Israel, with a long tradition of military service in the IDF. The Druze community signed a 'covenant of blood' with the State of Israel in 1956, committing to compulsory military service — and Yirka has produced many officers, including generals. The village is known for its traditional Druze architecture, hospitality, and food, and sits on hills with sweeping views toward the Mediterranean coast. It has also produced prominent academics and public figures who have played important roles in Israeli society.", factHe:"ירכא היא אחד מהכפרים הדרוזיים הגדולים יותר בישראל, בעלת מסורת ארוכה של שירות צבאי בצה\"ל. הקהילה הדרוזית חתמה על 'ברית דמים' עם מדינת ישראל ב-1956, הכוללת שירות חובה. ירכא ייצרה קצינים רבים, ביניהם גנרלים, ומובילה בשיעורי שירות גבוהים." , arabVillage: true },
  { name:"Zarzir",           lat:32.7281, lng:35.3042, region:"North",     tier:3, desc:"Bedouin Arab village in the Jezreel Valley", nameHe:"זרזיר", descHe:"כפר ערבי בדואי בעמק יזרעאל", fact:"Zarzir is one of the few officially recognized Bedouin villages in northern Israel, distinguishing it from the many unrecognized Bedouin communities in the Negev. The village sits in the Jezreel Valley and its residents, unlike Negev Bedouin, have largely been settled farmers for generations. Zarzir has built a significant agricultural economy based on the fertile valley land and has invested heavily in education — it is home to one of the highest rates of university-educated residents among Bedouin communities in Israel.", factHe:"זרזיר הוא אחד מהכפרים הבדואיים המוכרים רשמית בצפון ישראל, המבדיל אותו מקהילות בדואיות רבות בנגב. הכפר יושב בעמק יזרעאל ותושביו, בניגוד לבדואי הנגב, חקלאים מיושבים במשך דורות. זרזיר בנה כלכלה חקלאית חזקה ויש בו שיעורים גבוהים של השכלה אקדמית." , arabVillage: true },
  { name:"Zemer",            lat:32.3908, lng:34.9828, region:"Center",    tier:3, desc:"Arab town in the Triangle, near Kfar Saba", nameHe:"זמר", descHe:"עיירה ערבית במשולש, בסמוך לכפר סבא", fact:"Zemer is one of the northernmost Arab towns in Israel's 'Triangle' — the cluster of Arab communities along the Green Line in central Israel. The town sits on a hillside with views toward the Sharon plain and the Mediterranean, and has expanded significantly since the 1990s. Like many Triangle communities, Zemer's residents have strong ties to Palestinian families across the nearby Green Line and the town is frequently discussed in peace negotiations as part of potential land swap arrangements.", factHe:"זמר הוא אחת הערים הערביות הצפוניות ביותר ב'משולש' — הצביר הערבי לאורך הקו הירוק במרכז ישראל. העיירה יושבת על מדרון גבעה עם נוף למישור השרון ולים התיכון. לתושביה קשרים משפחתיים חזקים עם קהילות פלסטיניות מעבר לקו הירוק." , arabVillage: true },
  { name:"Kfar Manda",       lat:32.8114, lng:35.2598, region:"North",     tier:3, desc:"Arab local council in the Lower Galilee south of Acre", nameHe:"כפר מנדא", descHe:"מועצה מקומית ערבית בגליל התחתון, דרומית לעכו", fact:"Kfar Manda's name is thought to derive from the ancient Aramaic for 'knowledge' or possibly from a personal name from the early Arab conquest of the region. The village has a mixed Muslim and Christian population that has coexisted for centuries. It is known for its olive oil production — the surrounding hills are covered in ancient olive groves, some trees hundreds of years old — and for its traditional embroidery, which women in the village have practiced for generations as both craft and economic activity.", factHe:"שמה של כפר מנדא מאמינים שנגזר מהארמית ל'ידע' או מדמות מהכיבוש הערבי הקדום. לכפר אוכלוסייה מעורבת של מוסלמים ונוצרים שדו-קיום ביניהם נמשך מאות שנים. הוא ידוע בייצור שמן זית — הגבעות מסביב מכוסות בפרדסי זית עתיקים — ובעבודות רקמה מסורתיות." , arabVillage: true },
  { name:"Kfar Tavor",       lat:32.6878, lng:35.4204, region:"North",     tier:3, desc:"Moshav at the foot of Mount Tabor in the Lower Galilee", nameHe:"כפר תבור", descHe:"מושב ברגלי הר התבור בגליל התחתון", fact:"Kfar Tavor was founded in 1901 by immigrants from Eastern Europe and named after Mount Tabor, which dominates the skyline just a few kilometers away. The mountain, one of the most distinctive in Israel, is traditionally identified as the site of the Transfiguration of Jesus in Christian tradition, and as the site of Deborah and Barak's victory over the Canaanite army in the Hebrew Bible. Kfar Tavor is one of the oldest continuous Jewish agricultural settlements in Israel and preserves architecture from the early Ottoman period.", factHe:"כפר תבור נוסדה ב-1901 על ידי עולים ממזרח אירופה ונקראת על שם הר התבור השולט באופק כמה קילומטרים ממנה. ההר מזוהה בנצרות עם ההשתנות של ישו, ובתנ\"ך עם נצחון דבורה וברק על הצבא הכנעני. כפר תבור היא מהמושבות היהודיות החקלאיות הוותיקות ביותר בישראל." },
  { name:"Kfar Vradim",      lat:33.0089, lng:35.1883, region:"North",     tier:3, desc:"Community settlement in the western Galilee known for rose cultivation", nameHe:"כפר ורדים", descHe:"יישוב קהילתי בגליל המערבי, ידוע בגידול ורדים", fact:"Kfar Vradim — 'Village of Roses' — was established in 1984 as a community settlement in the western Galilee and fulfilled its poetic name by becoming one of Israel's significant centers of flower growing, particularly roses. The community sits on a hilltop with panoramic views toward the Mediterranean coast and Lebanon. It has attracted many former urban residents seeking a high quality of life outside the Tel Aviv metropolitan area, and has developed a strong local arts and culture scene despite its small size of around 4,000 residents.", factHe:"כפר ורדים — 'כפר הוורדים' — הוקם ב-1984 כיישוב קהילתי בגליל המערבי והגשים את שמו השירי בהפכו לאחד ממרכזי גידול הפרחים בישראל, במיוחד ורדים. היישוב יושב על גבעה עם נוף פנורמי לכיוון החוף הים-תיכוני ולבנון." },
  { name:"Kfar Kama",        lat:32.7211, lng:35.4408, region:"North",     tier:3, desc:"Circassian village in Lower Galilee, one of only two Circassian communities in Israel", nameHe:"כפר כמא", descHe:"כפר צ'רקסי בגליל התחתון, אחד משניים בלבד בישראל", fact:"Kfar Kama is one of only two Circassian villages in Israel (the other is Rehaniya), home to descendants of Circassian Muslim refugees who fled Russian conquest of the Caucasus in the 1860s and were settled by the Ottoman Empire across the Levant. The Circassians are a distinct ethnic group with their own language, traditions, and identity — and unlike most Israeli Arabs, Circassian men serve voluntarily in the IDF. The village maintains a Circassian cultural center and museum preserving traditions that have all but disappeared from the Caucasus itself.", factHe:"כפר כמא הוא אחד משני כפרים צ'רקסים בלבד בישראל (השני הוא ריחניה), בית לצאצאי פליטים מוסלמים צ'רקסים שברחו מהכיבוש הרוסי של הקווקז בשנות ה-1860. הצ'רקסים הם קבוצה אתנית ייחודית עם שפה ומסורות משלהם — ובניגוד לרוב הערבים הישראלים, גברים צ'רקסים משרתים בצבא." , arabVillage: true },
  { name:"Kfar Shmaryahu",   lat:32.1854, lng:34.8198, region:"Center",    tier:3, desc:"Affluent garden suburb north of Tel Aviv, one of Israel's wealthiest communities", nameHe:"כפר שמריהו", descHe:"פרוור גינות אמיד צפונית לתל אביב, מהקהילות העשירות בישראל", fact:"Kfar Shmaryahu consistently ranks as one of the wealthiest communities in Israel by average income and real estate values, comparable to Savyon further south. Founded in 1937 and named after Shmarya Levin, a Zionist leader and orator, it was built as a garden village of low-density single-family homes surrounded by greenery. It has resisted all attempts at densification and retains its original character as a quiet enclave of large houses, manicured gardens, and winding tree-lined streets — a sharp contrast to the dense urban fabric of the Tel Aviv metropolitan area surrounding it.", factHe:"כפר שמריהו מדורג בעקביות כאחת הקהילות העשירות ביותר בישראל מבחינת הכנסה ממוצעת וערכי נדל\"ן. נוסד ב-1937 ונקרא על שם שמריה לוין, מנהיג ציוני ונואם. הוא נבנה כפרוור גינות עם בתים חד-משפחתיים בצפיפות נמוכה." },
  { name:"Abu Snan",         lat:32.9586, lng:35.1717, region:"North",     tier:3, desc:"Mixed village of Muslims, Christians, and Druze in the western Galilee", nameHe:"אבו סנאן", descHe:"כפר מעורב של מוסלמים, נוצרים ודרוזים בגליל המערבי", fact:"Abu Snan is one of Israel's most religiously diverse villages, with substantial Muslim, Christian, and Druze communities sharing a single municipality. This three-way religious coexistence is extremely rare and has made the village a subject of sociological study. Despite occasional internal tensions, the three communities have maintained shared civic institutions for generations. Abu Snan's market is known regionally for fresh produce and the village has developed a strong reputation for hospitality and local cuisine.", factHe:"אבו סנאן הוא אחד הכפרים המגוונים דתית ביותר בישראל, עם קהילות מוסלמיות, נוצריות ודרוזיות משמעותיות החולקות עירייה אחת. שלוש-הדתות הזו נדירות ביותר והפכו את הכפר לנושא מחקר סוציולוגי. השוק של אבו סנאן ידוע בתוצרת טרייה, והכפר בעל מוניטין חזק של הכנסת אורחים." , arabVillage: true },
  { name:"Hurfeish",         lat:33.0208, lng:35.2253, region:"North",     tier:3, desc:"Druze village in the western Galilee near the Lebanese border", nameHe:"חורפיש", descHe:"כפר דרוזי בגליל המערבי, בסמוך לגבול הלבנוני", fact:"Hurfeish is a Druze village in the western Galilee whose residents have served in the IDF for generations. Like other Druze communities, Hurfeish has an unusually high rate of military service, and the village has lost many sons in Israel's wars — plaques commemorating fallen soldiers are a prominent feature of the village center. Hurfeish is also known for its spring festival celebrating the harvest of wild za'atar (hyssop), a culinary and cultural tradition that has been practiced for centuries and draws visitors from across the Galilee.", factHe:"חורפיש הוא כפר דרוזי בגליל המערבי שתושביו משרתים בצה\"ל דורות על גבי דורות. כמו קהילות דרוזיות אחרות, לחורפיש שיעור שירות גבוה במיוחד, והכפר איבד בנים רבים במלחמות ישראל. חורפיש ידועה גם בחגיגת קציר הזעתר — מסורת קולינרית ותרבותית הנשמרת מאות שנים." , arabVillage: true },
  { name:"Julis",            lat:32.9278, lng:35.1706, region:"North",     tier:3, desc:"Druze village near Acre known for strong IDF service tradition", nameHe:"ג'וליס", descHe:"כפר דרוזי ליד עכו, ידוע במסורת שירות חזקה בצה\"ל", fact:"Julis is a Druze village near Acre whose name may derive from the Latin 'Julius,' a remnant of the Roman presence in the Galilee. The village has a strong military tradition — per capita, Julis has one of the highest rates of IDF service of any community in Israel, and its war memorial lists a disproportionately large number of fallen soldiers. The village is also known for its traditional Druze hospitality and cuisine, and for an annual event celebrating Druze heritage and culture.", factHe:"ג'וליס הוא כפר דרוזי ליד עכו ששמו עשוי להגיע מהלטינית 'יוליוס' — שריד הנוכחות הרומית בגליל. לכפר מסורת צבאית חזקה — לנפש, לג'וליס אחד משיעורי השירות הגבוהים ביותר בצה\"ל מכל קהילה בישראל. אנדרטת הנופלים שלו מונה מספר חיילים שנפלו שאינו פרופורציונלי." , arabVillage: true },
  { name:"Kabul",            lat:32.8381, lng:35.1483, region:"North",     tier:3, desc:"Arab village in the Lower Galilee between Haifa and Acre", nameHe:"כאבול", descHe:"כפר ערבי בגליל התחתון בין חיפה לעכו", fact:"Kabul has been continuously inhabited since at least the Byzantine period and possibly earlier — it appears in Jewish sources from the Talmudic era. The village's name may be related to the Aramaic word for 'thicket' or a personal name from antiquity. Kabul gained notoriety as the name given to the region around it in Josephus's writings about the Jewish-Roman War, and it sits near the remains of a Crusader fort. Today it is a quiet agricultural community known for its olive groves and sheep farming.", factHe:"כאבול מיושב ברצף לפחות מהתקופה הביזנטית, ואולי קודם לכן — הוא מוזכר במקורות יהודיים מתקופת התלמוד. שמו עשוי להיות קשור למילה הארמית ל'סבך' או לשם פרטי מהעת העתיקה. כאבול הוא קהילה חקלאית שקטה הידועה בפרדסי הזית ובגידול צאן." , arabVillage: true },
  { name:"Kisra-Sumei",      lat:32.9761, lng:35.2167, region:"North",     tier:3, desc:"Merged Druze and Arab village in the western Galilee", nameHe:"כסרא-סמיע", descHe:"כפר דרוזי וערבי ממוזג בגליל המערבי", fact:"Kisra-Sumei was formed by the administrative merger of two neighboring villages: Kisra, predominantly Druze, and Sumei, predominantly Christian Arab. The two communities have distinct identities but share roads, infrastructure, and a local council. Kisra is one of the Galilee's most scenic hilltop communities, with dramatic views toward the Mediterranean on clear days. The combined village is known for its goat cheese production and local dairy traditions that have been maintained for generations.", factHe:"כסרא-סמיע נוצרה ממיזוג מנהלי של שני כפרים שכנים: כסרא, דרוזי ברובו, וסמיע, נוצרי ברובו. שתי הקהילות בעלות זהויות שונות אך חולקות תשתיות ומועצה מקומית. כסרא היא מהקהילות הפסגתיות היפות ביותר בגליל, עם נוף פנורמי לים התיכון בימים בהירים." , arabVillage: true },
  { name:"Mi'ilya",          lat:33.0281, lng:35.2583, region:"North",     tier:3, desc:"Christian Arab village in the western Galilee with Crusader fortress ruins", nameHe:"מעיליא", descHe:"כפר ערבי נוצרי בגליל המערבי עם שרידי מצודה צלבנית", fact:"Mi'ilya is a Christian Arab village built on and around the ruins of a Crusader fortress — Castellum Regis, the 'King's Castle' — built in the 12th century by the Knights Templar. The Crusader walls and towers are still visible within the village and some have been incorporated into private homes and public buildings. The village is entirely Greek Catholic Christian and has maintained a strong educational tradition — Mi'ilya has produced a notably high number of academics, teachers, and doctors relative to its small population of around 3,000.", factHe:"מעיליא הוא כפר ערבי נוצרי הבנוי על שרידי מצודה צלבנית — קסטלום רגיס, 'מבצר המלך' — שנבנתה במאה ה-12 על ידי אביריים טמפלריים. חומות ומגדלים צלבניים עדיין גלויים בכפר וחלקם שולבו בבתים פרטיים ובמבני ציבור. הכפר כולו נוצרי קתולי יווני." , arabVillage: true },
  { name:"Sajur",            lat:32.9833, lng:35.2333, region:"North",     tier:3, desc:"Druze village in the western Galilee", nameHe:"סאג'ור", descHe:"כפר דרוזי בגליל המערבי", fact:"Sajur is a Druze village nestled in the hills of the western Galilee, surrounded by olive groves and pine forests. Like other Druze communities, Sajur has maintained strong ties to the Israeli state through military service, and the village has a proud military tradition. The surrounding landscape, typical of the western Galilee, is characterized by terraced hillsides carved over centuries by Druze and Arab farmers. Sajur is known for its traditional stone architecture and for preserving Druze religious and cultural practices.", factHe:"סאג'ור הוא כפר דרוזי בגבעות הגליל המערבי, מוקף בפרדסי זית ויערות אורן. כמו קהילות דרוזיות אחרות, לסאג'ור קשרים חזקים עם המדינה דרך השירות הצבאי. הנוף הסובב, האופייני לגליל המערבי, מאופיין בטרסות שנחרטו על ידי חקלאים דרוזים וערבים לאורך מאות שנים." , arabVillage: true },
  { name:"Sha'ab",           lat:32.8817, lng:35.1483, region:"North",     tier:3, desc:"Arab village in the lower Galilee near Acre", nameHe:"שעב", descHe:"כפר ערבי בגליל התחתון, בסמוך לעכו", fact:"Sha'ab is an Arab village near Acre with a mixed Muslim and Christian population. The village's name may relate to the Arabic word for 'difficult' or 'ravine,' reflecting the rugged terrain of the area. Sha'ab was a site of fighting during the 1948 war and changed hands several times before coming under Israeli control. The village has maintained a tradition of fruit growing, particularly figs and olives, and is known locally for its traditional sweets made from dried figs.", factHe:"שעב הוא כפר ערבי ליד עכו עם אוכלוסייה מוסלמית ונוצרית מעורבת. שמו עשוי להתייחס למילה הערבית ל'קשה' או 'גדר', המשקפת את הטופוגרפיה הסלעית של האזור. שעב היה זירת קרבות במלחמת 1948. הכפר שמר על מסורת של גידול פירות, בעיקר תאנים וזיתים." , arabVillage: true },
  { name:"Iksal",            lat:32.6816, lng:35.3240, region:"North",     tier:3, desc:"Arab village near Nazareth at the foot of Mount Tabor", nameHe:"אכסאל", descHe:"כפר ערבי ליד נצרת ברגלי הר התבור", fact:"Iksal is thought to be the site of the ancient biblical town of Chesulloth, mentioned in the Book of Joshua as a border town of the tribe of Issachar. The village sits at the foot of Mount Tabor and has been continuously inhabited since ancient times. Its residents are predominantly Muslim and have historically depended on agriculture in the fertile Jezreel Valley below. Iksal has grown significantly in recent decades and now has a local council, schools, and growing commerce.", factHe:"אכסאל מזוהה עם כסלות שבתנ\"ך, עיר גבול שבטי המוזכרת בספר יהושע. הכפר יושב ברגלי הר התבור ומיושב ברצף מהעת העתיקה. תושביו ברובם מוסלמים שנסמכו היסטורית על חקלאות בעמק יזרעאל הפורה." , arabVillage: true },
  { name:"Ilabun",           lat:32.8361, lng:35.3667, region:"North",     tier:3, desc:"Christian Arab village in the Lower Galilee", nameHe:"עילבון", descHe:"כפר ערבי נוצרי בגליל התחתון", fact:"Ilabun is a predominantly Christian Arab village in the Lower Galilee with deep historical roots. In October 1948, Ilabun was the site of a little-known but significant episode: after Israeli forces occupied the village, residents were expelled, but following an appeal to David Ben-Gurion himself — supported by a Christian Arab mayor and local clergy — the villagers were allowed to return, making it one of the only cases in 1948 where expelled residents were permitted to come back. The village has maintained a tradition of education and has produced many teachers, priests, and professionals.", factHe:"עילבון הוא כפר ערבי נוצרי בגליל התחתון עם שורשים היסטוריים עמוקים. באוקטובר 1948 גורשו תושביו לאחר כיבוש ישראלי, אך בעקבות ערעור לדוד בן-גוריון עצמו — בתמיכת ראש העיר הנוצרי והכמורה המקומית — הורשו התושבים לחזור. זהו אחד המקרים היחידים ב-1948 שבהם הורשו מגורשים לשוב." , arabVillage: true },
  { name:"Ilut",             lat:32.7611, lng:35.2592, region:"North",     tier:3, desc:"Arab village in the Lower Galilee in the Jezreel Valley foothills", nameHe:"עילוט", descHe:"כפר ערבי בגליל התחתון, בשולי עמק יזרעאל", fact:"Ilut is an Arab village in the Lower Galilee with an almost entirely Muslim population. It sits in the foothills between the Jezreel Valley and the Nazareth hills, in terrain that has been farmed continuously for thousands of years. The village has grown significantly in recent decades, driven by a high birth rate and migration from surrounding smaller communities. Ilut has invested in local education and has a good network of schools serving both the village and nearby areas.", factHe:"עילוט הוא כפר ערבי בגליל התחתון עם אוכלוסייה מוסלמית כמעט בלעדית. הוא יושב בגבעות שבין עמק יזרעאל לגבעות נצרת, בשטח שנחרש ברצף אלפי שנים. הכפר גדל משמעותית בעשורים האחרונים בשל שיעורי ילודה גבוהים." , arabVillage: true },
  { name:"I'billin",         lat:32.8209, lng:35.1913, region:"North",     tier:3, desc:"Large Arab town in the Lower Galilee known for education and civic activism", nameHe:"עיבלין", descHe:"עיירה ערבית גדולה בגליל התחתון, ידועה בחינוך ובפעילות אזרחית", fact:"I'billin is best known as the home of Father Elias Chacour, a Palestinian Christian priest who founded the Mar Elias Educational Institutions — a network of schools serving Arab, Jewish, and Druze students together, which grew from a small school to a fully accredited college. Father Chacour was nominated for the Nobel Peace Prize three times for his work building bridges between Jewish and Arab communities. His book 'Blood Brothers,' describing growing up in I'billin and the 1948 war, became an international bestseller.", factHe:"עיבלין ידועה בעיקר כביתו של האב אליאס שאקור, כומר נוצרי פלסטיני שייסד את מוסדות מר אליאס — רשת בתי ספר המשרתת תלמידים ערבים, יהודים ודרוזים יחד. האב שאקור עמד שלוש פעמים בפני פרס נובל לשלום בשל עבודתו לבניית גשרים בין קהילות." , arabVillage: true },
  { name:"Daburiyya",        lat:32.6928, lng:35.3716, region:"North",     tier:3, desc:"Arab village at the foot of Mount Tabor, one of the largest in the north", nameHe:"דבוריה", descHe:"כפר ערבי ברגלי הר התבור, מהגדולים בצפון", fact:"Daburiyya is traditionally identified with the biblical Daberath, a Levitical city at the foot of Mount Tabor mentioned in the Book of Joshua and in the writings of Josephus. The village is one of the oldest continuously inhabited settlements in Israel and has been Muslim since the early Arab conquest of the region in the 7th century. It sits at the base of Mount Tabor and overlooks the Jezreel Valley, and its economy has traditionally been based on farming the fertile valley floor.", factHe:"דבוריה מזוהה מסורתית עם דברת המקראית — עיר לויים ברגלי הר התבור המוזכרת בספר יהושע ובכתבי יוסיפוס. הכפר הוא מהיישובים הוותיקים ביותר בישראל, ומוסלמי מאז הכיבוש הערבי של האזור במאה ה-7. הוא יושב בבסיס הר התבור ומשקיף על עמק יזרעאל." , arabVillage: true },
  { name:"Deir Hanna",       lat:32.8625, lng:35.3667, region:"North",     tier:3, desc:"Arab town in the Lower Galilee known for traditional architecture", nameHe:"דיר חנא", descHe:"עיירה ערבית בגליל התחתון, ידועה בארכיטקטורה מסורתית", fact:"Deir Hanna is one of the larger Arab towns in the Lower Galilee, with a mixed Muslim and Christian population. The town preserves a remarkable collection of traditional stone houses from the Ottoman period, many still inhabited, giving it one of the most intact historic streetscapes of any Arab town in Israel. In 1956, Deir Hanna was the site of significant unrest when residents clashed with authorities over land confiscation policies — events that shaped Arab political consciousness in Israel in the early state period.", factHe:"דיר חנא היא מהעיירות הערביות הגדולות בגליל התחתון, עם אוכלוסייה מוסלמית ונוצרית מעורבת. העיירה שומרת אוסף יוצא דופן של בתי אבן מסורתיים מהתקופה העות'מאנית, רבים מהם עדיין מאוכלסים — ורחובות היסטוריים משומרים מהטובים ביותר בקרב ערים ערביות בישראל." , arabVillage: true },
  { name:"Masade",           lat:33.2417, lng:35.7681, region:"North",     tier:3, desc:"Druze village in the Golan Heights at the foot of Mount Hermon", nameHe:"מסעדה", descHe:"כפר דרוזי ברמת הגולן ברגלי חרמון", fact:"Masade is one of four Druze villages in the Golan Heights that Israel captured from Syria in 1967. Like Majdal Shams nearby, most residents identify as Syrian and refused Israeli citizenship when it was offered, holding permanent residency instead. The village sits at 1,100 meters elevation at the foot of Mount Hermon and experiences heavy snowfall in winter. It is a gateway to the Hermon ski resort, Israel's only ski mountain, and has developed some tourism infrastructure around winter sports visitors.", factHe:"מסעדה הוא אחד מארבעה כפרים דרוזיים ברמת הגולן שנכבשה מסוריה ב-1967. כמו שכנתה מג'דל שמס, רוב התושבים מזדהים כסורים וסירבו לאזרחות ישראלית. הכפר יושב בגובה 1,100 מטר ברגלי החרמון וחווה שלג כבד בחורף. הוא שער לאתר הסקי בחרמון, אתר הסקי היחיד בישראל." , arabVillage: true },
  { name:"Mazra'a",          lat:33.0686, lng:35.2494, region:"North",     tier:3, desc:"Arab village in the western Galilee near the Lebanese border", nameHe:"מזרעה", descHe:"כפר ערבי בגליל המערבי, בסמוך לגבול הלבנוני", fact:"Mazra'a is a small Arab village in the western Galilee, whose name in Arabic means 'farm' or 'cultivated land' — a direct reference to its agricultural character. The village is located just a few kilometers from the Lebanese border and has been affected by cross-border tensions and conflicts over the decades. Its residents are predominantly Muslim and have traditionally depended on olive growing and small-scale farming. The village is surrounded by some of the Galilee's most scenic hill country.", factHe:"מזרעה הוא כפר ערבי קטן בגליל המערבי; שמו בערבית פירושו 'חווה' — רמז ישיר לאופיו החקלאי. הכפר ממוקם כמה קילומטרים מהגבול הלבנוני והושפע מהתנגשויות חוצות-גבול לאורך השנים. תושביו ברובם מוסלמים שנסמכו על גידול זיתים וחקלאות קטנה." , arabVillage: true },
  { name:"Peki'in",          lat:32.9772, lng:35.3340, region:"North",     tier:3, desc:"Ancient village in the Galilee with one of the oldest continuous Jewish communities outside Jerusalem", nameHe:"פקיעין", descHe:"כפר עתיק בגליל עם אחת הקהילות היהודיות הרצופות הוותיקות ביותר מחוץ לירושלים", fact:"Peki'in is one of only two places in Israel (with a brief exception of Jerusalem) with a continuous Jewish community since ancient times — through the Roman, Byzantine, Arab, Crusader, Ottoman, and British periods. The Jewish family that never left, the Zinati family, maintained the community for centuries. According to the Talmud, Rabbi Shimon Bar Yochai hid from Roman authorities in a cave near Peki'in for 13 years — a cave now marked by a synagogue. The village also has Druze and Christian populations, making it one of Israel's most ethnically layered communities.", factHe:"פקיעין היא אחד משני המקומות בישראל עם קהילה יהודית רצופה מהעת העתיקה — דרך התקופות הרומית, הביזנטית, הערבית, הצלבנית, העות'מאנית והבריטית. משפחת זינאתי, שלא עזבה מעולם, שמרה על הקהילה מאות שנים. לפי התלמוד, רבי שמעון בר יוחאי התחבא במערה ליד פקיעין מפני הרומאים 13 שנה." },
  { name:"Reina",            lat:32.7236, lng:35.3125, region:"North",     tier:3, desc:"Arab town near Nazareth in the Lower Galilee", nameHe:"ריינה", descHe:"עיירה ערבית ליד נצרת בגליל התחתון", fact:"Reina is an Arab town just north of Nazareth with a large Muslim majority and a smaller Christian community. The town's name may derive from the Arabic 'Rihanna' or from an older Aramaic root. Reina has grown significantly in recent decades and is now effectively a suburb of greater Nazareth. It gained international attention in 2016 when a resident was identified as the perpetrator of a fatal Tel Aviv shooting, triggering a national debate about radicalization in Israeli-Arab communities — though the town's leadership strongly condemned the attack.", factHe:"ריינה היא עיירה ערבית צפונית לנצרת עם רוב מוסלמי גדול וקהילה נוצרית קטנה יותר. ריינה גדלה משמעותית בעשורים האחרונים והפכה למעשה לפרוור של נצרת הגדולה. ב-2016 זכתה לתשומת לב בינלאומית בעקבות פיגוע בתל אביב." , arabVillage: true },
  { name:"Rame",             lat:32.9380, lng:35.3676, region:"North",     tier:3, desc:"Arab village in the Galilee with both Christian and Muslim communities", nameHe:"ראמה", descHe:"כפר ערבי בגליל עם קהילות נוצריות ומוסלמיות", fact:"Rame is a mixed Christian and Muslim Arab village in the Upper Galilee, situated at an elevation of around 700 meters with commanding views of the surrounding hills. The village is known for its annual summer festival and its tradition of producing literary and cultural figures. Rame has a strong educational tradition — it is home to one of the Galilee's better-regarded high schools — and has maintained its population despite the general trend of rural Arab youth moving to larger cities. Several notable Israeli-Arab poets and writers have come from Rame.", factHe:"ראמה הוא כפר ערבי מעורב נוצרי-מוסלמי בגליל העליון, שוכן בגובה כ-700 מטר עם נוף עוצמתי לגבעות הסובבות. הכפר ידוע במסורת ספרותית ותרבותית ובאירוע קיץ שנתי. מספר משוררים וסופרים ישראלים-ערבים בולטים מוצאם מראמה." , arabVillage: true },
  { name:"Nahef",            lat:32.9346, lng:35.3176, region:"North",     tier:3, desc:"Arab village in the western Galilee between Acre and Karmiel", nameHe:"נחף", descHe:"כפר ערבי בגליל המערבי בין עכו לכרמיאל", fact:"Nahef is a Muslim Arab village in the western Galilee, situated between Acre and Karmiel on the hills above the Beit HaKerem Valley. The village has a mixed economy of agriculture, construction, and commerce, and has grown considerably in recent decades. Nahef is known for its olive oil production — much of the surrounding hillside is covered in ancient olive groves — and for a weekly market that draws buyers from across the western Galilee. The village has invested in modern education and health facilities in recent years.", factHe:"נחף הוא כפר ערבי מוסלמי בגליל המערבי, שוכן בין עכו לכרמיאל בגבעות מעל עמק בית הכרם. לכפר כלכלה מעורבת של חקלאות, בינוי ומסחר, וגדל משמעותית בשנים האחרונות. נחף ידוע בייצור שמן זית — חלק גדול מהמדרון הסובב מכוסה בפרדסי זית עתיקים." , arabVillage: true },

  { name:"Tzomet HaGader Interchange",  lat:33.1280, lng:35.7560, region:"North",   tier:4, desc:"Highway 91/98 junction near the Syrian border", nameHe:"מחלף תצומת הגדר", descHe:"מחלף כביש 91/98 בסמוך לגבול סוריה", fact:"'Tzomet HaGader' literally means 'Fence Junction' — it sits just kilometers from the Syrian border, where the Golan Heights ceasefire line with Syria has been one of Israel's quietest borders for 50 years. The junction is near the ancient city of Hippos (Sussita), a Greco-Roman city whose ruins perch dramatically on a basalt plateau overlooking the Sea of Galilee.", factHe:"'תצומת הגדר' יושב כמה קילומטרים מגבול סוריה — קו הפסקת-האש בגולן שנחשב לשקט בישראל מאז 1974. בסמוך שוכן היפוס (סוסיתא), עיר הלניסטית שחורבותיה ניצבות על רמה בזלתית מעל הכנרת." },
];

const DIFF = {
  // maxPts: base points for a perfect click; maxKm: distance beyond which you score 0; maxTier: highest town tier included
  easy:   { maxPts:100, maxKm:100, maxTier:1, color:"#1a7f37" },
  medium: { maxPts:100, maxKm:50,  maxTier:2, color:"#9a6700" },
  hard:   { maxPts:100, maxKm:20,  maxTier:4, color:"#cf2316" },
};

// Perfect radius by tier: bigger places are easier to hit for full points
const PERFECT_RADIUS_KM = { 1: 5, 2: 3, 3: 2, 4: 1 };

// Tier multiplier: smaller/harder towns award more points
const TIER_MULTIPLIER = { 1: 1.0, 2: 1.3, 3: 1.6, 4: 2.0 };

// Learning Mode constants
const LEARNING_MAX_ATTEMPTS = 3;
const LEARNING_SESSION_SIZE = 10;
const LEARNING_TIER_NAMES = {
  1: { en: 'Major Cities',         he: 'ערים גדולות'     },
  2: { en: 'Medium Cities',        he: 'ערים בינוניות'   },
  3: { en: 'Small Towns',          he: 'ישובים קטנים'    },
  4: { en: 'Villages & Junctions', he: 'כפרים וצמתים'    },
};

const PLAYER_LEVEL_NAMES = {
  1: { en: 'City Rat',       he: 'עכבר העיר'    },
  2: { en: 'Periphery Fox',  he: 'שועל פריפריה' },
  3: { en: 'Country Mouse',  he: 'עכבר הכפר'    },
  4: { en: 'Trail King',     he: 'מלך השבילים'  },
};

// Time bonus: up to +30 pts, decays to 0 over TIME_BONUS_SECS seconds
const TIME_BONUS_MAX  = 30;
const TIME_BONUS_SECS = 30;

let roundStartTime = 0; // set in loadTown

// ── POLYGON-BASED PERFECT SCORE ───────────────────────────────────────────────
// Maps quiz city names → folder slugs in idoivri/israel-municipalities-polygons
const CITY_POLYGON_SLUG = {
  "Afula": "afula", "Akko": "acre_ako",
  "Arad": "arad", "Arrabe": "arabe",
  "Ashdod": "ashdod", "Ashkelon": "ashkelon",
  "Baqa al-Gharbiyye": "baka_al_rarbiya", "Bat Yam": "bat_yam",
  "Beer Sheva": "beer_sheva",
  "Beit She'an": "bet_shean", "Beit Shemesh": "beit_shemesh",
  "Binyamina": "binyamina_givat_ada",
  "Bnei Brak": "bnei_brak",
  "Daliyat al-Karmel": "dalyat_al_carmel",
  "Dimona": "dimona", "Eilat": "eilat",
  "Even Yehuda": "even_yehuda",
  "Gan Yavne": "gan_yavne", "Ganei Tikva": "gane_tikva",
  "Gedera": "gedera", "Giv'at Shmuel": "givaat_shmuel",
  "Givatayim": "givatayim",
  "Hadera": "hadera", "Haifa": "haifa",
  "Herzliya": "hertseliya", "Hod HaSharon": "hod_hasharon",
  "Holon": "holon",
  "Isfiya": "ossfiya",
  "Jisr az-Zarqa": "jiser_a_zarka",
  "Kafr Qasim": "kafar_kasem", "Kafr Qara": "kafar_kara",
  "Kafr Yasif": "kfar_yasif", "Karmiel": "karmiel",
  "Katzrin": "katsrin", "Kfar Saba": "kfar_saba",
  "Kiryat Ata": "kiryat_ata", "Kiryat Bialik": "kiryat_biyalik",
  "Kiryat Motzkin": "kiryat_motskin", "Kiryat Ono": "kiryat_ono",
  "Kiryat Shmona": "kiryat_shmona", "Kiryat Yam": "kiryat_yam",
  "Lod": "lod", "Ma'ale Adumim": "maale_adomim",
  "Ma'alot-Tarshiha": "maalot_tarshiha",
  "Majd al-Krum": "majd_al_krum",
  "Mevaseret Zion": "mevaseret_tsiyon",
  "Metula": "metula",
  "Migdal HaEmek": "migdal_haemek", "Mitzpe Ramon": "mitspe_ramon",
  "Modi'in": "modiin_makabim_reut",
  "Nazareth": "nazareth_natsrat", "Nes Ziona": "nes_tsiyona",
  "Nesher": "nesher", "Netanya": "netanya", "Netivot": "netivot",
  "Nof HaGalil": "natsrat_ilit", "Nazareth Illit": "natsrat_ilit",
  "Ofakim": "ofakim", "Omer": "omer", "Or Akiva": "or_akiva",
  "Or Yehuda": "or_yehuda",
  "Pardes Hanna": "pardes_hana_karkur",
  "Petah Tikva": "petah_tikva",
  "Qalansawe": "kalanswa",
  "Qiryat Tiv'on": "kiryat_tivon",
  "Ra'anana": "raanana", "Rahat": "rahat", "Ramat Gan": "ramat_gan",
  "Ramat HaSharon": "ramat_hasharon", "Ramla": "ramla",
  "Rehovot": "rehovot", "Rishon LeZion": "rishon_letsiyon",
  "Rosh HaAyin": "rosh_haayin",
  "Safed": "tsfat", "Sakhnin": "sahnin", "Sderot": "sderot",
  "Shfar'am": "shfaram", "Shoham": "shoham", "Tamra": "tamra",
  "Tel Aviv": "tel_aviv_yafo", "Tel Mond": "tel_mond",
  "Tiberias": "tverya_tiberias", "Tira": "tira", "Tirat Carmel": "tirat_karmel",
  "Umm al-Fahm": "um_al_fahem",
  "Yavne": "yavne", "Yavne'el": "yavneel",
  "Yehud": "yehud_monoson",
  "Yeroham": "yeroham",
  "Yoqne'am Illit": "yokneam_ilit",
  "Zichron Ya'akov": "zihron_yaakov",
  // newly added cities
  "Daburiyya": "daburiya",
  "Elad": "elad",
  "Hazor HaGlilit": "hatsor_haglilit",
  "Kafr Kanna": "kfar_kana",
  "Kfar Kama": "kfar_kama",
  "Kfar Manda": "kfar_manda",
  "Kfar Shmaryahu": "kfar_shmaryahu",
  "Kfar Tavor": "kfar_tavor",
  "Kfar Yona": "kfar_yona",
  "Kiryat Ekron": "kiryat_ekron",
  "Majdal Shams": "majdel_shams",
  "Migdal": "migdal",
  "Peki'in": "pkiin_bukea",
  "Rame": "rame",
  "Reina": "reyne",
  "Savyon": "savyon",
  "Shlomi": "shlomi",
  "Yesud HaMa'ala": "yesud_hamaala",};

const POLY_BASE = "https://raw.githubusercontent.com/idoivri/israel-municipalities-polygons/master";
const polyCache = {}; // name → GeoJSON Feature | null (null = no polygon available)

async function fetchCityPolygon(name) {
  if (name in polyCache) return polyCache[name];
  const slug = CITY_POLYGON_SLUG[name];
  if (!slug) { polyCache[name] = null; return null; }
  try {
    const res = await fetch(`${POLY_BASE}/${slug}/${slug}.geojson`);
    if (!res.ok) { polyCache[name] = null; return null; }
    const geojson = await res.json();
    // Could be FeatureCollection or a single Feature
    const feature = geojson.type === 'FeatureCollection'
      ? geojson.features[0]
      : geojson;
    polyCache[name] = feature ?? null;
    return polyCache[name];
  } catch { polyCache[name] = null; return null; }
}

// Ray-casting point-in-polygon for GeoJSON (handles Polygon & MultiPolygon)
function pointInGeoJSONFeature(lat, lng, feature) {
  if (!feature?.geometry) return false;
  const { type, coordinates } = feature.geometry;
  const rings = type === 'Polygon' ? coordinates : coordinates.flat(1);
  for (const ring of rings) {
    if (pointInRing(lat, lng, ring)) return true;
  }
  return false;
}

function pointInRing(lat, lng, ring) {
  // GeoJSON coords are [lng, lat]
  let inside = false;
  for (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {
    const xi = ring[i][0], yi = ring[i][1];
    const xj = ring[j][0], yj = ring[j][1];
    const intersect = ((yi > lat) !== (yj > lat)) &&
      (lng < (xj - xi) * (lat - yi) / (yj - yi) + xi);
    if (intersect) inside = !inside;
  }
  return inside;
}

// Distance-based scoring with tier multiplier
function calcPts(distKm, diff, hintUsed, tier) {
  const perfectKm  = PERFECT_RADIUS_KM[tier] ?? 1;
  const multiplier = TIER_MULTIPLIER[tier]   ?? 1;
  const base = distKm <= perfectKm
    ? diff.maxPts
    : Math.max(0, Math.round(diff.maxPts * (1 - (distKm - perfectKm) / (diff.maxKm - perfectKm))));
  const scaled    = Math.round(base * multiplier);
  const afterHint = hintUsed ? Math.max(0, scaled - 10) : scaled;
  return streetUsedThisRound ? Math.min(20, afterHint) : afterHint;
}

function calcTimeBonus(elapsedMs) {
  const secs = elapsedMs / 1000;
  if (secs >= TIME_BONUS_SECS) return 0;
  return Math.round(TIME_BONUS_MAX * (1 - secs / TIME_BONUS_SECS));
}


const STRINGS = {
  en: {
    title:            "Gilly Israel Quiz",
    score:            "Score",
    round:            "Round",
    placeholder_desc: "Select a difficulty and start the game",
    hint_badge:       "📍 Area shown on map",
    hint_btn:         n => `💡 Hint (−10 pts) · ${n} left`,
    layer_street:     "🗺️ Street map",
    layer_satellite:  "🛰️ Satellite",
    fact_close:       "Close",
    menu_desc:        "Pin the location on the map.",
    diff_easy:        "Easy",
    diff_medium:      "Medium",
    diff_hard:        "Hard",
    region_all:       "All",
    region_north:     "🏔️ North",
    region_center:    "🏙️ Center",
    region_south:     "🏜️ South",
    lbl_region:       "Region",
    note_easy:        "Major cities only",
    note_medium:      "Cities & towns",
    note_hard:        "All settlements + road interchanges",
    game_mode:        "Game Mode",
    cities_towns:     "Cities & Towns",
    start_btn:        "Start Game →",
    learn_btn:        "🗺️ Learning Mode",
    region_all_short: "All",
    region_north_short: "North",
    region_center_short: "Center",
    region_south_short: "South",
    result_excellent: "Excellent!",
    result_good:      "Good Job!",
    result_practice:  "Keep Practicing!",
    play_again:       "▶ Play Again",
    menu_btn:         "Menu",
    back_btn:         "← Menu",
    region_names:     { North:"North", Center:"Center", Jerusalem:"Jerusalem", South:"South", "West Bank":"West Bank" },
  },
  he: {
    title:            "חידון ישראל של גילי",
    score:            "ניקוד",
    round:            "סיבוב",
    placeholder_desc: "בחר/י רמת קושי והתחל/י את המשחק",
    hint_badge:       "📍 האזור מסומן על המפה",
    hint_btn:         n => `💡 רמז (−10 נקודות) · ${n} נשארו`,
    layer_street:     "🗺️ מפת רחוב",
    layer_satellite:  "🛰️ לוויין",
    fact_close:       "סגור",
    menu_desc:        "מצא/י את המיקום על המפה",
    diff_easy:        "קל",
    diff_medium:      "בינוני",
    diff_hard:        "קשה",
    region_all:       "הכל",
    region_north:     "🏔️ צפון",
    region_center:    "🏙️ מרכז",
    region_south:     "🏜️ דרום",
    lbl_region:       "אזור",
    note_easy:        'ערים גדולות בלבד',
    note_medium:      'ערים ועיירות',
    note_hard:        'כל הישובים + מחלפים',
    game_mode:        "מצב משחק",
    cities_towns:     "ערים ועיירות",
    start_btn:        "← התחל משחק",
    learn_btn:        "🗺️ מצב למידה",
    region_all_short: "הכל",
    region_north_short: "צפון",
    region_center_short: "מרכז",
    region_south_short: "דרום",
    result_excellent: "מצוין!",
    result_good:      "כל הכבוד!",
    result_practice:  "כדאי להמשיך להתאמן!",
    play_again:       "▶ שחק שוב",
    menu_btn:         "תפריט",
    back_btn:         "← תפריט",
    region_names:     { North:"צפון", Center:"מרכז", Jerusalem:"ירושלים", South:"דרום", "West Bank":"יהודה ושומרון" },
  },
};

function t(key) { return STRINGS[lang][key]; }

function setLang(l) {
  lang = l;
  applyLang();
}
function toggleLang() {
  setLang(lang === 'he' ? 'en' : 'he');
}

function applyLang() {
  document.body.dir = 'ltr';
  document.getElementById('title-text').textContent = t('title');
  document.getElementById('overlay-title-text').textContent = t('title');
  document.getElementById('lbl-score').textContent = t('score');
  document.getElementById('lbl-round').textContent = t('round');
  document.getElementById('hint-badge').textContent = t('hint_badge');
  document.getElementById('fact-modal-close').textContent = t('fact_close');
  document.getElementById('menu-desc').innerHTML = t('menu_desc');
  document.getElementById('menu-mode-title').textContent = t('game_mode');
  document.getElementById('d-easy').textContent   = t('diff_easy');
  document.getElementById('d-medium').textContent = t('diff_medium');
  document.getElementById('d-hard').textContent   = t('diff_hard');
  document.getElementById('diff-note').textContent = t(`note_${difficulty}`);
  document.getElementById('lbl-region').textContent = t('lbl_region');
  document.getElementById('r-all-label').textContent    = t('region_all_short');
  document.getElementById('r-north-label').textContent  = t('region_north_short');
  document.getElementById('r-center-label').textContent = t('region_center_short');
  document.getElementById('r-south-label').textContent  = t('region_south_short');
  document.getElementById('start-btn').textContent    = t('start_btn');
  document.getElementById('learn-btn').textContent    = t('learn_btn');
  document.getElementById('btn-play-again').textContent = t('play_again');
  document.getElementById('btn-menu').textContent      = t('menu_btn');
  document.getElementById('btn-back').textContent      = t('back_btn');
  // Update mobile elements
  document.querySelector('#mobile-topbar-town .mob-find-label').textContent = lang === 'he' ? '📍 מצא' : '📍 Find';
  document.getElementById('mobile-tools-layer').innerHTML = currentLayer === 'satellite' ? t('layer_street') : t('layer_satellite');
  // Update single lang toggle button — shows the OTHER language to switch to
  document.getElementById('lang-toggle').textContent = lang === 'he' ? '🌐 English' : '🌐 עברית';
  // Set text direction for text-heavy elements only (not the card itself, to keep button order stable)
  document.getElementById('menu-desc').style.direction = lang === 'he' ? 'rtl' : 'ltr';
  document.getElementById('menu-mode-title').style.direction = lang === 'he' ? 'rtl' : 'ltr';
  document.getElementById('results-card').dir = lang === 'he' ? 'rtl' : 'ltr';
  updateHintBtn();
  // Update layer toggle button text based on current layer
  document.getElementById('btn-layer').innerHTML = currentLayer === 'satellite' ? t('layer_street') : t('layer_satellite');
  // Update auth label if not logged in, and dropdown labels
  if (!window._fbUser) {
    document.getElementById('auth-label').textContent = lang === 'he' ? 'התחברות' : 'Log in';
  }
  if (document.getElementById('auth-dd-switch')) {
    document.getElementById('auth-dd-switch').textContent   = lang === 'he' ? 'החלף חשבון'  : 'Switch account';
    document.getElementById('auth-dd-signout').textContent  = lang === 'he' ? 'התנתקות'     : 'Sign out';
    document.getElementById('auth-dd-settings').textContent = lang === 'he' ? 'הגדרות'      : 'Settings';
  }
  if (document.getElementById('settings-title')) {
    document.getElementById('settings-title').textContent        = lang === 'he' ? '⚙️ הגדרות'   : '⚙️ Settings';
    document.getElementById('settings-lbl-nickname').textContent = lang === 'he' ? 'כינוי'       : 'Nickname';
    document.getElementById('settings-lbl-gender').textContent   = lang === 'he' ? 'מין'         : 'Gender';
    document.getElementById('settings-lbl-language').textContent = lang === 'he' ? 'שפה'         : 'Language';
    document.getElementById('settings-nickname').placeholder     = lang === 'he' ? 'הכינוי שלך…' : 'Your nickname…';
    document.getElementById('gender-male').innerHTML   = lang === 'he' ? '👨 זכר'   : '👨 Male';
    document.getElementById('gender-female').innerHTML = lang === 'he' ? '👩 נקבה'  : '👩 Female';
    document.getElementById('gender-other').innerHTML  = lang === 'he' ? '🧑 אחר'   : '🧑 Other';
  }
  // Update live town name/desc if a game is in progress
  const overlayVisible = document.getElementById('overlay').style.display !== 'none';
  if (!overlayVisible && sequence.length > 0 && currentIdx < sequence.length) {
    document.getElementById('town-name').textContent = lang === 'he' ? sequence[currentIdx].nameHe : sequence[currentIdx].name;
    document.getElementById('town-desc').textContent = lang === 'he' ? sequence[currentIdx].descHe : sequence[currentIdx].desc;
  } else if (overlayVisible || sequence.length === 0) {
    document.getElementById('town-desc').textContent = t('placeholder_desc');
  }
  // Swap street tile layer to match the new language
  if (currentLayer === 'street') {
    map.removeLayer(streetLayer);
    map.removeLayer(streetLayerEn);
    activeStreetLayer().addTo(map);
  }
  updateArabVillageLabels();
}

let lang = "he";
let difficulty = "medium", region = "all", sequence = [], currentIdx = 0, score = 0, roundCount = 8;
let streak = 0, hintUsed = false, streetUsedThisRound = false, results = [], waiting = false;
let correctMarkers = [], clickMarker = null, circle = null, hintCircle = null;
let hintsLeft = 3, hintAnimFrame = null;

// ── Learning Mode State ───────────────────────────────────────────────────────
let isLearningMode = false;
let learningSequence = [], learningIdx = 0, learningAttempt = 0;
let knownLocations = [], learningSessionResults = [], learningPins = [];
let learningPreviewActive = false, learningPreviewTimer = null, learningPreviewInterval = null;

// ── MAP — ESRI World Physical: free, no API key, no city labels ──────────────
const ISRAEL_BOUNDS = L.latLngBounds(
  L.latLng(29.3, 33.8),   // SW — south of Eilat, west of Negev
  L.latLng(33.5, 36.0)    // NE — north of Metula, east of Golan
);

const map = L.map('map', {
  center: [31.5, 34.9],
  zoom: 7,
  minZoom: 7,
  maxZoom: 18,
  zoomControl: true,
  maxBounds: ISRAEL_BOUNDS,
  maxBoundsViscosity: 1.0,
});

// Create two tile layers - satellite and street map
const satelliteLayer = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution: 'Tiles &copy; Esri &mdash; Source: Esri, Maxar, Earthstar Geographics', maxZoom: 18 }
);

// Hebrew street map (OSM default — labels in Hebrew)
const streetLayer = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors', maxZoom: 18 }
);

// English street map (CartoDB Positron — labels in English)
const streetLayerEn = L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
  { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>', maxZoom: 19 }
);

// Returns whichever street tile layer matches the current UI language
function activeStreetLayer() {
  return lang === 'en' ? streetLayerEn : streetLayer;
}

// Start with satellite view
satelliteLayer.addTo(map);
let currentLayer = 'satellite';

// ── Arab village Hebrew labels (shown only in Hebrew street view when zoomed in) ──
const arabLabelGroup = L.layerGroup();
TOWNS.filter(t => t.arabVillage).forEach(t => {
  L.marker([t.lat, t.lng], {
    icon: L.divIcon({
      className: 'arab-label',
      html: t.nameHe,
      iconSize: [0, 0],
      iconAnchor: [0, 8],
    }),
    interactive: false,
  }).addTo(arabLabelGroup);
});

function updateArabVillageLabels() {
  if (lang === 'he' && currentLayer === 'street' && map.getZoom() >= 11) {
    if (!map.hasLayer(arabLabelGroup)) arabLabelGroup.addTo(map);
  } else {
    if (map.hasLayer(arabLabelGroup)) map.removeLayer(arabLabelGroup);
  }
}
map.on('zoomend', updateArabVillageLabels);

// ── Helper: draw a blue-and-white border (two stacked polylines) ──────────────
function addBorderLine(coords) {
  L.polyline(coords, {
    color: '#ffffff',
    weight: 5,
    opacity: 0.9,
    lineJoin: 'round',
    lineCap: 'round',
  }).addTo(map);
  L.polyline(coords, {
    color: '#0038b8',
    weight: 3,
    opacity: 1.0,
    dashArray: '10, 8',
    lineJoin: 'round',
    lineCap: 'round',
  }).addTo(map);
}

// ── Israel border (Egypt, Jordan, Golan, Lebanon) ─────────────────────────────
const israelBorderCoords = [
  [31.322994, 34.218807],
  [31.296595, 34.235458],
  [31.295861, 34.23975],
  [31.283245, 34.244213],
  [31.261898, 34.251852],
  [31.244948, 34.258204],
  [31.213389, 34.269104],
  [31.169335, 34.285583],
  [31.137016, 34.297256],
  [31.106449, 34.308243],
  [31.054699, 34.326096],
  [30.989088, 34.353905],
  [30.873351, 34.397507],
  [30.830319, 34.418793],
  [30.718227, 34.476471],
  [30.681621, 34.496384],
  [30.59773, 34.518356],
  [30.533285, 34.51767],
  [30.494835, 34.558182],
  [30.44453, 34.543076],
  [30.411374, 34.544449],
  [30.370506, 34.614487],
  [30.11187, 34.708557],
  [30.041161, 34.740829],
  [29.965643, 34.767609],
  [29.869824, 34.802628],
  [29.804305, 34.828033],
  [29.759609, 34.847946],
  [29.68686, 34.856873],
  [29.645095, 34.881592],
  [29.612267, 34.878159],
  [29.596148, 34.867172],
  [29.541204, 34.878845],
  [29.492206, 34.905624],
  [29.510732, 34.92485],
  [29.526865, 34.936523],
  [29.537619, 34.948883],
  [29.545983, 34.955063],
  [29.540606, 34.978409],
  [29.576443, 34.977722],
  [29.623609, 35.001068],
  [29.647482, 35.017548],
  [29.671349, 35.021667],
  [29.697597, 35.011711],
  [29.775106, 35.031796],
  [29.787621, 35.04467],
  [29.802816, 35.0457],
  [29.810561, 35.052223],
  [29.819349, 35.050163],
  [29.863423, 35.069904],
  [29.871908, 35.079174],
  [29.877565, 35.079002],
  [29.886197, 35.085869],
  [29.923399, 35.082436],
  [29.925482, 35.078316],
  [29.930391, 35.078831],
  [29.939317, 35.084839],
  [29.9472, 35.084152],
  [29.949878, 35.075741],
  [29.956868, 35.078831],
  [29.963709, 35.09016],
  [29.969955, 35.093765],
  [29.972186, 35.088615],
  [29.992259, 35.098915],
  [29.994638, 35.116425],
  [30.001625, 35.117283],
  [30.002814, 35.111275],
  [30.009652, 35.110073],
  [30.012328, 35.100288],
  [30.061666, 35.130501],
  [30.063597, 35.146294],
  [30.084394, 35.151958],
  [30.087068, 35.148182],
  [30.093158, 35.154018],
  [30.114097, 35.157795],
  [30.122115, 35.162773],
  [30.128648, 35.157795],
  [30.134735, 35.160885],
  [30.143346, 35.150928],
  [30.155369, 35.155048],
  [30.162494, 35.144062],
  [30.203746, 35.151443],
  [30.215317, 35.151443],
  [30.241421, 35.145264],
  [30.253729, 35.150585],
  [30.282343, 35.146465],
  [30.306948, 35.155048],
  [30.312876, 35.163975],
  [30.34651, 35.192127],
  [30.358212, 35.188179],
  [30.384278, 35.174618],
  [30.401899, 35.165348],
  [30.440682, 35.161915],
  [30.470721, 35.181656],
  [30.480929, 35.184875],
  [30.498532, 35.193114],
  [30.521678, 35.19423],
  [30.533359, 35.194788],
  [30.547996, 35.203757],
  [30.581918, 35.203886],
  [30.6046, 35.217962],
  [30.618635, 35.221567],
  [30.658883, 35.263453],
  [30.668407, 35.266285],
  [30.672541, 35.263453],
  [30.680145, 35.270748],
  [30.684795, 35.268259],
  [30.690183, 35.274353],
  [30.699556, 35.275984],
  [30.710331, 35.281992],
  [30.709224, 35.29109],
  [30.712987, 35.294008],
  [30.718005, 35.294266],
  [30.722949, 35.286283],
  [30.734311, 35.294609],
  [30.762194, 35.294867],
  [30.762858, 35.308342],
  [30.7692, 35.312719],
  [30.778124, 35.31435],
  [30.79029, 35.314951],
  [30.797147, 35.322418],
  [30.799285, 35.335894],
  [30.815725, 35.340528],
  [30.819852, 35.336323],
  [30.841963, 35.328941],
  [30.862595, 35.331001],
  [30.87394, 35.335636],
  [30.910178, 35.354691],
  [30.926378, 35.368767],
  [30.926672, 35.393486],
  [30.932562, 35.396233],
  [30.934329, 35.403099],
  [30.949347, 35.413742],
  [30.951923, 35.415459],
  [30.968189, 35.417562],
  [30.970471, 35.416703],
  [30.984747, 35.416875],
  [31.003288, 35.416832],
  [31.020502, 35.421638],
  [31.045948, 35.425329],
  [31.075873, 35.445499],
  [31.100864, 35.455456],
  [31.120999, 35.458374],
  [31.152589, 35.455627],
  [31.167866, 35.449104],
  [31.182847, 35.438461],
  [31.20781, 35.419922],
  [31.22983, 35.402756],
  [31.24304, 35.400009],
  [31.252726, 35.400352],
  [31.263292, 35.402412],
  [31.275617, 35.405502],
  [31.290874, 35.413399],
  [31.310528, 35.423698],
  [31.328713, 35.437088],
  [31.351291, 35.452538],
  [31.387641, 35.470047],
  [31.412256, 35.472107],
  [31.447117, 35.473824],
  [31.467618, 35.47554],
  [31.493969, 35.47554],
  [31.521483, 35.475883],
  [31.546357, 35.475883],
  [31.5604, 35.477943],
  [31.577073, 35.47863],
  [31.616551, 35.488586],
  [31.651043, 35.498886],
  [31.686692, 35.511246],
  [31.714149, 35.525665],
  [31.734007, 35.540771],
  [31.752693, 35.553818],
  [31.762035, 35.559998],
  [31.765355, 35.557895],
  [31.766158, 35.555706],
  [31.766413, 35.55429],
  [31.767252, 35.552959],
  [31.768091, 35.553174],
  [31.768602, 35.553689],
  [31.769113, 35.554633],
  [31.769879, 35.555663],
  [31.771193, 35.555706],
  [31.772907, 35.554934],
  [31.774038, 35.552402],
  [31.778416, 35.549634],
  [31.783305, 35.547702],
  [31.784563, 35.547938],
  [31.785731, 35.548861],
  [31.788284, 35.550063],
  [31.790819, 35.551372],
  [31.793045, 35.550363],
  [31.796309, 35.5515],
  [31.797139, 35.551693],
  [31.797786, 35.551608],
  [31.798443, 35.551586],
  [31.798698, 35.551393],
  [31.798808, 35.551007],
  [31.798826, 35.550449],
  [31.798899, 35.549569],
  [31.798935, 35.549011],
  [31.799063, 35.548582],
  [31.799282, 35.548089],
  [31.799555, 35.547659],
  [31.80023, 35.54693],
  [31.800905, 35.546544],
  [31.801744, 35.546329],
  [31.803075, 35.545449],
  [31.803987, 35.544462],
  [31.80468, 35.543432],
  [31.8053, 35.543003],
  [31.806795, 35.542874],
  [31.808144, 35.543346],
  [31.809093, 35.543561],
  [31.810041, 35.543518],
  [31.810697, 35.54296],
  [31.811317, 35.543261],
  [31.811646, 35.54369],
  [31.812302, 35.544291],
  [31.813177, 35.544419],
  [31.813834, 35.544376],
  [31.814308, 35.543947],
  [31.815165, 35.54414],
  [31.815894, 35.544441],
  [31.816569, 35.544269],
  [31.817298, 35.544033],
  [31.817881, 35.543411],
  [31.818064, 35.54311],
  [31.818465, 35.542059],
  [31.818793, 35.541737],
  [31.818593, 35.541286],
  [31.818501, 35.540707],
  [31.818884, 35.540385],
  [31.819395, 35.540707],
  [31.819595, 35.541587],
  [31.819759, 35.542102],
  [31.820142, 35.542531],
  [31.820835, 35.542703],
  [31.821656, 35.542874],
  [31.822294, 35.542874],
  [31.82275, 35.543261],
  [31.82275, 35.544033],
  [31.822731, 35.544698],
  [31.822677, 35.545471],
  [31.822677, 35.545986],
  [31.833524, 35.547981],
  [31.848399, 35.547981],
  [31.855981, 35.540085],
  [31.87231, 35.551071],
  [31.888344, 35.535278],
  [31.896506, 35.534935],
  [31.906416, 35.527725],
  [31.922153, 35.531158],
  [31.933808, 35.544891],
  [31.960901, 35.545921],
  [31.977502, 35.545235],
  [31.994683, 35.540428],
  [32.003709, 35.534763],
  [32.028744, 35.52515],
  [32.039367, 35.52206],
  [32.060464, 35.531845],
  [32.07472, 35.537682],
  [32.08432, 35.543861],
  [32.105843, 35.535278],
  [32.116893, 35.542145],
  [32.133176, 35.550385],
  [32.148292, 35.551758],
  [32.171544, 35.559998],
  [32.188398, 35.560684],
  [32.2006, 35.563431],
  [32.222096, 35.567551],
  [32.24649, 35.566177],
  [32.269136, 35.567551],
  [32.297581, 35.562057],
  [32.323695, 35.559998],
  [32.341101, 35.559311],
  [32.361983, 35.557938],
  [32.383731, 35.563087],
  [32.400545, 35.562744],
  [32.417066, 35.564117],
  [32.428658, 35.562401],
  [32.445464, 35.569954],
  [32.460674, 35.574589],
  [32.468495, 35.566349],
  [32.481529, 35.570297],
  [32.484859, 35.58403],
  [32.50484, 35.577164],
  [32.521921, 35.570641],
  [32.536973, 35.57682],
  [32.560993, 35.584717],
  [32.594263, 35.587463],
  [32.630123, 35.580597],
  [32.638797, 35.58403],
  [32.649782, 35.604973],
  [32.659321, 35.610466],
  [32.66568, 35.605659],
  [32.670882, 35.606689],
  [32.675217, 35.610466],
  [32.676662, 35.619049],
  [32.677529, 35.630722],
  [32.678396, 35.638275],
  [32.678107, 35.653381],
  [32.677818, 35.667801],
  [32.686487, 35.677757],
  [32.702378, 35.679817],
  [32.709311, 35.70282],
  [32.713644, 35.717926],
  [32.723176, 35.742645],
  [32.738772, 35.759125],
  [32.75783, 35.778351],
  [32.771687, 35.791397],
  [32.825365, 35.840149],
  [32.855364, 35.853882],
  [32.8842, 35.856628],
  [32.910721, 35.870361],
  [32.941844, 35.897827],
  [32.972956, 35.882721],
  [33.023633, 35.871735],
  [33.101896, 35.858002],
  [33.113399, 35.837402],
  [33.122601, 35.825043],
  [33.1456, 35.836029],
  [33.168594, 35.852509],
  [33.19388, 35.841522],
  [33.20652, 35.822296],
  [33.251896, 35.818863],
  [33.274861, 35.781784],
  [33.292656, 35.797577],
  [33.308151, 35.80925],
  [33.317332, 35.818176],
  [33.335118, 35.780411],
  [33.335405, 35.767193],
  [33.32809, 35.745478],
  [33.331245, 35.726337],
  [33.328951, 35.712948],
  [33.317332, 35.70797],
  [33.307147, 35.707283],
  [33.302986, 35.695267],
  [33.295382, 35.682735],
  [33.282898, 35.665913],
  [33.276871, 35.658703],
  [33.28218, 35.64188],
  [33.274144, 35.621281],
  [33.269982, 35.619049],
  [33.255341, 35.617676],
  [33.25046, 35.613556],
  [33.254767, 35.602226],
  [33.265963, 35.59021],
  [33.275435, 35.586777],
  [33.284046, 35.584373],
  [33.29323, 35.568581],
  [33.283185, 35.557251],
  [33.269408, 35.556221],
  [33.258786, 35.549698],
  [33.254767, 35.543861],
  [33.239836, 35.543518],
  [33.235529, 35.535622],
  [33.211978, 35.533562],
  [33.199913, 35.539742],
  [33.142438, 35.522919],
  [33.137264, 35.523262],
  [33.133239, 35.529442],
  [33.118863, 35.518456],
  [33.118575, 35.504379],
  [33.11685, 35.499916],
  [33.091829, 35.501633],
  [33.095856, 35.484123],
  [33.095281, 35.47039],
  [33.094993, 35.457687],
  [33.092404, 35.443611],
  [33.06824, 35.429878],
  [33.063349, 35.383873],
  [33.057306, 35.376663],
  [33.05932, 35.360184],
  [33.067665, 35.346451],
  [33.07946, 35.335464],
  [33.08809, 35.326881],
  [33.097869, 35.328941],
  [33.106785, 35.319672],
  [33.107072, 35.316238],
  [33.102471, 35.307312],
  [33.101896, 35.303192],
  [33.105635, 35.301304],
  [33.109517, 35.295124],
  [33.10204, 35.278816],
  [33.09902, 35.258904],
  [33.094993, 35.238647],
  [33.100458, 35.223885],
  [33.101896, 35.215302],
  [33.090679, 35.204315],
  [33.088953, 35.194359],
  [33.096144, 35.177879],
  [33.091829, 35.162086],
  [33.095856, 35.15625],
  [33.096144, 35.148525],
  [33.096, 35.142088],
  [33.096359, 35.13711],
  [33.096431, 35.130758],
  [33.096431, 35.122261],
  [33.096647, 35.114021],
  [33.096431, 35.104837]
];
addBorderLine(israelBorderCoords);

function toggleMapLayer(suppressBanner = false) {
  closeMobileTools();
  if (currentLayer === 'satellite') {
    map.removeLayer(satelliteLayer);
    activeStreetLayer().addTo(map);
    currentLayer = 'street';
    streetUsedThisRound = true;
    document.getElementById('btn-layer').innerHTML = t('layer_satellite');
    document.getElementById('mobile-tools-layer').innerHTML = t('layer_satellite');
    // Reset streak when switching to street view (labels make it too easy)
    streak = 0;
    // Show funny "easy mode" banner (unless suppressed for auto-switches)
    if (!suppressBanner) {
      showEasyModeBanner();
    }
  } else {
    map.removeLayer(activeStreetLayer());
    satelliteLayer.addTo(map);
    currentLayer = 'satellite';
    document.getElementById('btn-layer').innerHTML = t('layer_street');
    document.getElementById('mobile-tools-layer').innerHTML = t('layer_street');
  }
  updateArabVillageLabels();
}

function isGameInProgress() {
  const overlay = document.getElementById('overlay');
  const resultsPanel = document.getElementById('results-panel');
  const learningResults = document.getElementById('learning-results-panel');
  const menuVisible = overlay && overlay.style.display !== 'none';
  const resultsVisible = resultsPanel && resultsPanel.classList.contains('show');
  const learningResultsVisible = learningResults && learningResults.classList.contains('show');
  // In-progress = not on menu AND not on any results screen
  return !menuVisible && !resultsVisible && !learningResultsVisible;
}

function mobileGoHome() {
  closeMobileTools();
  if (isGameInProgress()) {
    // Show confirmation modal
    const modal = document.getElementById('mobile-confirm-modal');
    document.getElementById('mobile-confirm-title').textContent =
      lang === 'he' ? 'בטוח?' : 'Are you sure?';
    document.getElementById('mobile-confirm-sub').textContent =
      lang === 'he' ? 'ההתקדמות במשחק הנוכחי תאבד.' : 'Your current game progress will be lost.';
    document.getElementById('mobile-confirm-yes').textContent =
      lang === 'he' ? 'כן, חזרה הביתה' : 'Yes, go home';
    document.getElementById('mobile-confirm-no').textContent =
      lang === 'he' ? 'ביטול' : 'Cancel';
    modal.classList.add('open');
  } else {
    showMenu();
  }
}

function confirmGoHome() {
  document.getElementById('mobile-confirm-modal').classList.remove('open');
  showMenu();
}

function closeConfirmModal() {
  document.getElementById('mobile-confirm-modal').classList.remove('open');
}

function toggleMobileTools() {
  const dropdown = document.getElementById('mobile-tools-dropdown');
  if (dropdown) dropdown.classList.toggle('show');
}
function closeMobileTools() {
  const dropdown = document.getElementById('mobile-tools-dropdown');
  if (dropdown) dropdown.classList.remove('show');
}

// Close mobile tools dropdown when clicking outside
window.addEventListener('DOMContentLoaded', function() {
  document.addEventListener('click', function(e) {
    const toolsWrap = document.getElementById('mobile-tools-wrap');
    const toolsDD = document.getElementById('mobile-tools-dropdown');
    if (toolsDD && toolsDD.classList.contains('show') &&
        !toolsWrap.contains(e.target)) {
      toolsDD.classList.remove('show');
    }
  });
});

// ── COUNTRY BORDERS — fetched from Natural Earth via public CDN ──────────────
// Loads accurate world country polygons; filters to just the region around Israel.
// Zero labels — pure vector boundary lines only.
const NEIGHBOURS = new Set(['Israel','Lebanon','Syria','Jordan','Egypt','Saudi Arabia',
  'Iraq','Cyprus','Libya','Sudan','Turkey','Palestinian Territory']);

fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
  .then(r => r.json())
  .then(data => {
    const regional = {
      type: 'FeatureCollection',
      features: data.features.filter(f => NEIGHBOURS.has(f.properties.ADMIN))
    };
    L.geoJSON(regional, {
      style: {
        color: '#e2c97e',
        weight: 1.5,
        opacity: 0.8,
        fill: false,
      }
    }).addTo(map);
  })
  .catch(err => console.warn('Border fetch failed:', err));

map.on('click', onMapClick);

// ── FUN FACTS MODAL ──────────────────────────────────────────────────────────
let factModalOpen = false;

function openFactModal(townName) {
  const town = TOWNS.find(t => t.name === townName);
  const fact = lang === 'he'
    ? (town?.factHe || town?.fact || 'אין עובדה זמינה.')
    : (town?.fact  || 'No fact available.');
  document.getElementById('fact-modal-title').textContent = lang === 'he' ? (town?.nameHe || townName) : townName;
  document.getElementById('fact-modal-body').textContent = fact;
  document.getElementById('fact-modal-body').dir = lang === 'he' ? 'rtl' : 'ltr';
  document.getElementById('fact-modal-title').dir = lang === 'he' ? 'rtl' : 'ltr';
  document.getElementById('fact-modal').style.display = 'flex';
  factModalOpen = true;
}

function closeFactModal() {
  document.getElementById('fact-modal').style.display = 'none';
  factModalOpen = false;
}

// Close on backdrop click
document.getElementById('fact-modal').addEventListener('click', (e) => {
  if (e.target === document.getElementById('fact-modal')) closeFactModal();
});

// Use Leaflet's DOM event system to intercept clicks on .fact-btn BEFORE
// they reach the map — this prevents the ghost map-click.
document.getElementById('map').addEventListener('click', (e) => {
  const btn = e.target.closest('.fact-btn');
  if (!btn) return;
  // Stop both native bubbling and Leaflet's synthetic click pipeline
  e.stopPropagation();
  e.preventDefault();
  openFactModal(btn.dataset.town);
}, true); // capture phase — fires before Leaflet sees it

// Also guard onMapClick itself against firing while modal is open


// ── HELPERS ──────────────────────────────────────────────────────────────────
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function haversineKm(lat1, lng1, lat2, lng2) {
  const R = 6371, toR = Math.PI / 180;
  const dLat = (lat2 - lat1) * toR, dLng = (lng2 - lng1) * toR;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*toR)*Math.cos(lat2*toR)*Math.sin(dLng/2)**2;
  return R * 2 * Math.asin(Math.sqrt(a));
}

function clearMapFeedback() {
  if (hintAnimFrame) { clearInterval(hintAnimFrame); hintAnimFrame = null; }
  // Keep correctMarkers (city pins) on map — only clear hint/click/scoring layers
  [clickMarker, circle, hintCircle].forEach(l => l && map.removeLayer(l));
  clickMarker = circle = hintCircle = null;
  if (cityPolyLayer) { map.removeLayer(cityPolyLayer); cityPolyLayer = null; }
}

function clearAllMarkers() {
  if (hintAnimFrame) { clearInterval(hintAnimFrame); hintAnimFrame = null; }
  correctMarkers.forEach(l => l && map.removeLayer(l));
  correctMarkers = [];
  [clickMarker, circle, hintCircle].forEach(l => l && map.removeLayer(l));
  clickMarker = circle = hintCircle = null;
  if (cityPolyLayer) { map.removeLayer(cityPolyLayer); cityPolyLayer = null; }
}

function showPtsPopup(pts, pct, perfect, distKm, timeBonus = 0) {
  const el = document.getElementById('pts-popup');
  el.className = '';
  void el.offsetWidth;

  // pct is based on basePts (without time bonus) for color/label thresholds
  const basePts   = pts - timeBonus;
  const isClose   = basePts >= 85;
  const isGood    = basePts >= 110;

  const fontSize  = perfect ? '5.5rem' : isGood ? '4.2rem' : isClose ? '3.2rem' : '2.5rem';
  const labelSize = perfect ? '3.3rem' : isGood ? '2.5rem' : isClose ? '1.9rem' : '1.5rem';

  const color = perfect || isGood ? '#1a7f37'
              : isClose           ? '#2da44e'
              : pts > 0           ? '#cf2316'
              :                     '#cf2316';

  let label = '';
  if (pts === 0)    label = lang === 'he' ? 'פספוס!'       : 'Miss!';
  else if (perfect) label = lang === 'he' ? '🎯 מושלם!'    : '🎯 Perfect!';
  else if (isGood)  label = lang === 'he' ? 'קרוב מאוד!'   : 'Very close!';
  else if (isClose) label = lang === 'he' ? 'לא רע!'       : 'Not bad!';
  else              label = lang === 'he' ? 'רחוק מאוד...' : 'Very far...';

  const prefix = pts > 0 ? '+' : '';
  const timeLine = timeBonus > 0
    ? `<span class="pts-time-bonus" style="color:${color}">⚡ +${timeBonus} ${lang === 'he' ? 'מהיר' : 'speed'}</span>`
    : '';

  el.innerHTML = `
    <span class="pts-number" style="font-size:${fontSize};color:${color}">${prefix}${pts}</span>
    <span class="pts-label" dir="${lang === 'he' ? 'rtl' : 'ltr'}" style="color:${color};font-size:${labelSize}">${label}</span>
    ${timeLine}
  `;

  const cls = perfect ? 'show-perfect' : isClose ? 'show-good' : 'show-miss';
  el.classList.add(cls);
  el.addEventListener('animationend', () => { el.className = ''; }, { once: true });
}

function showLearningPopup(icon, label, color, animCls) {
  const el = document.getElementById('pts-popup');
  el.className = '';
  void el.offsetWidth;
  const iconSize  = animCls === 'show-perfect' ? '5.5rem' : '4rem';
  const labelSize = animCls === 'show-perfect' ? '3rem'   : '1.8rem';
  const dir = lang === 'he' ? 'rtl' : 'ltr';
  el.innerHTML = `
    <span class="pts-number" style="font-size:${iconSize};color:${color}">${icon}</span>
    <span class="pts-label" dir="${dir}" style="color:${color};font-size:${labelSize}">${label}</span>
  `;
  el.dir = dir;
  el.classList.add(animCls);
  el.addEventListener('animationend', () => { el.className = ''; el.dir = ''; }, { once: true });
}

let cityPolyLayer = null;

function showCityPolygon(feature, perfect) {
  // Remove any previous highlight
  if (cityPolyLayer) { map.removeLayer(cityPolyLayer); cityPolyLayer = null; }
  if (!feature?.geometry) return;

  const duration = perfect ? 2600 : 2200; // match popup animation ms

  // Two-layer effect: filled body + glowing thick stroke on top
  const fillColor   = perfect ? '#58a6ff' : '#6cb6ff';
  const strokeColor = perfect ? '#1f6feb' : '#388bfd';

  cityPolyLayer = L.geoJSON(feature, {
    style: {
      color:       strokeColor,
      weight:      perfect ? 3.5 : 2.5,
      opacity:     0.9,
      fillColor:   fillColor,
      fillOpacity: perfect ? 0.28 : 0.18,
      dashArray:   null,
      lineCap:     'round',
      lineJoin:    'round',
    },
    className: 'city-poly-highlight',
  }).addTo(map);

  // Animate fill opacity: pulse up then fade
  const el = cityPolyLayer.getLayers()[0]?._path;
  if (el) {
    // Initial fade-in
    el.style.transition = 'none';
    el.style.opacity = '0';
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        el.style.transition = `opacity 0.35s ease`;
        el.style.opacity = '1';

        // Pulse (for perfect only)
        if (perfect) {
          setTimeout(() => {
            el.style.transition = 'opacity 0.25s ease';
            el.style.opacity = '0.6';
            setTimeout(() => {
              el.style.transition = 'opacity 0.25s ease';
              el.style.opacity = '1';
            }, 250);
          }, 600);
        }

        // Fade out in sync with popup end
        setTimeout(() => {
          el.style.transition = `opacity 0.5s ease`;
          el.style.opacity = '0';
          setTimeout(() => {
            if (cityPolyLayer) { map.removeLayer(cityPolyLayer); cityPolyLayer = null; }
          }, 500);
        }, duration - 500);
      });
    });

    // Animate all paths if MultiPolygon (multiple SVG paths)
    cityPolyLayer.getLayers().slice(1).forEach(l => {
      const p = l._path;
      if (!p) return;
      p.style.transition = el.style.transition;
      p.style.opacity = el.style.opacity;
    });
  }
}

function showFeedback(msg, color) {
  const el = document.getElementById('feedback');
  el.textContent = msg;
  el.style.borderColor = color;
  el.style.color = color;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 3000);
}

function updateHUD() {
  const scoreEl = document.getElementById('score-val');
  const prevScore = parseInt(scoreEl.textContent) || 0;

  // Color: interpolate blue→teal→green based on score (0=blue, 600+=green)
  const maxScore = roundCount * (DIFF[difficulty].maxPts || 150);
  const pct = Math.min(score / maxScore, 1);
  // Blue #1a6fd4 → teal #0ea5a0 → green #1a7f37
  const r = Math.round(26  + (26  - 26)  * pct);   // stays ~26
  const g = Math.round(111 + (127 - 111) * pct);    // 111→127
  const b = Math.round(212 + (55  - 212) * pct);    // 212→55
  // More vivid: use HSL — hue 213 (blue) → 134 (green)
  const hue = Math.round(213 - (213 - 134) * pct);
  const sat = Math.round(75  + (52  - 75)  * pct);
  const lit = Math.round(47  + (33  - 47)  * pct);
  scoreEl.style.color = `hsl(${hue}, ${sat}%, ${lit}%)`;

  scoreEl.textContent = score;
  document.getElementById('round-val').textContent = `${currentIdx + 1}/${roundCount}`;

  // Animate bump — intensity scales with score progress
  if (score > prevScore) {
    // pct already computed above (0→1 as score fills max)
    const bumpScale = 1.18 + pct * 0.72;        // 1.18 at 0% → 1.90 at 100%
    const glowSize  = Math.round(6 + pct * 22);  // 6px → 28px
    scoreEl.style.setProperty('--bump-scale', bumpScale.toFixed(2));
    scoreEl.style.setProperty('--glow-size', glowSize + 'px');

    const cls = pct >= 0.7 ? 'score-bump-epic' : 'score-bump';
    scoreEl.classList.remove('score-bump', 'score-bump-epic');
    void scoreEl.offsetWidth;
    scoreEl.classList.add(cls);
    scoreEl.addEventListener('animationend', () => {
      scoreEl.classList.remove('score-bump', 'score-bump-epic');
    }, { once: true });
  }
}

const HEBREW_PHRASES = [
  'יפה הבלורית והתואר!',
  'דור הנפילים!',
  'בן טובים!',
  'מלח הארץ!',
  'שומר הגחלת!',
  'איש טוב באמצע הדרך!',
  'איש של ערכים!',
  'עמוד תווך!',
  'איש אדמה!',
  'מכיר כל אבן!',
  'איש ההר והעמק!',
  'איש של שבילים!',
  'איש קו ומרחב!',
  'איש הארץ והדרך!',
  'מחובר לאדמה!',
  'שומר השבילים!',
];

const HEBREW_PHRASES_FEMALE = [
  'דור הנפילות!',
  'בת טובים!',
  'מלח הארץ!',
  'שומרת הגחלת!',
  'אישה טובה באמצע הדרך!',
  'אישה של ערכים!',
  'עמוד תווך!',
  'אשת אדמה!',
  'מכירה כל אבן!',
  'אשת ההר והעמק!',
  'אשת שבילים!',
  'אשת קו ומרחב!',
  'אשת הארץ והדרך!',
  'מחוברת לאדמה!',
  'שומרת השבילים!',
];

const EASY_MODE_MESSAGES = {
  en: [
    "🎓 Professor Mode Activated",
    "📖 Reading the Map Like a Book",
    "🧭 GPS Powers: UNLOCKED",
    "👓 X-Ray Vision: ON",
    "🎮 Tutorial Mode",
    "🍼 Training Wheels Engaged",
    "🎯 Aimbot Enabled",
    "🔍 Detective Mode",
    "🧠 Big Brain Time",
    "📚 Open Book Exam",
    "🎓 Scholar's Privilege",
    "🗺️ Cheat Codes: Activated"
  ],
  he: [
    "📖 קוראים את המפה כמו ספר",
    "👓 ראיית רנטגן פעילה",
    "🍼 גלגלי עזר מחוברים",
    "📚 מבחן ספר פתוח"
  ]
};

// Haptic feedback (Android/supported browsers only; silently ignored elsewhere)
function haptic(pattern) {
  if (navigator.vibrate) navigator.vibrate(pattern);
}

let streakTimeout = null;

function showStreakBanner(n) {
  if (n < 3) return;
  haptic([80, 60, 80, 60, 120]); // celebratory triple pulse
  const phrases = _selectedGender === 'female' ? HEBREW_PHRASES_FEMALE : HEBREW_PHRASES;
  const phrase = phrases[Math.floor(Math.random() * phrases.length)];
  const banner = document.getElementById('streak-banner');

  // Reset any running animation
  banner.className = '';
  banner.innerHTML = lang === 'he' ? `
    <div class="streak-flames"><span>🔥</span><span>🔥</span><span>🔥</span></div>
    <div class="streak-main" dir="rtl">${phrase}</div>
    <div class="streak-hebrew" dir="rtl">${n} ברצף!</div>
  ` : `
    <div class="streak-flames"><span>🔥</span><span>🔥</span><span>🔥</span></div>
    <div class="streak-main">${n} in a row!</div>
    <div class="streak-hebrew">${phrase}</div>
  `;

  // Force reflow so animation restarts cleanly
  void banner.offsetWidth;
  banner.classList.add('show');

  if (streakTimeout) clearTimeout(streakTimeout);
  streakTimeout = setTimeout(() => {
    banner.classList.remove('show');
    banner.classList.add('hide');
    setTimeout(() => { banner.className = ''; }, 400);
  }, 3000);
}

function showEasyModeBanner() {
  const messages = EASY_MODE_MESSAGES[lang];
  const message = messages[Math.floor(Math.random() * messages.length)];
  const banner = document.getElementById('easy-mode-banner');
  
  // Reset any running animation
  banner.className = '';
  banner.textContent = message;
  banner.dir = lang === 'he' ? 'rtl' : 'ltr';
  
  // Force reflow so animation restarts cleanly
  void banner.offsetWidth;
  banner.classList.add('show');
  
  setTimeout(() => {
    banner.classList.remove('show');
    banner.classList.add('hide');
    setTimeout(() => { banner.className = ''; }, 400);
  }, 2500);
}

function loadTown() {
  const t = sequence[currentIdx];
  const townName = lang === 'he' ? t.nameHe : t.name;
  const townDesc = lang === 'he' ? t.descHe : t.desc;

  // Prefetch polygon for this town (and the next one) so it's ready by the time user clicks
  fetchCityPolygon(t.name);
  if (currentIdx + 1 < sequence.length) fetchCityPolygon(sequence[currentIdx + 1].name);
  
  document.getElementById('town-name').textContent = townName;
  document.getElementById('town-desc').textContent = townDesc;
  // Also update mobile versions
  document.querySelector('#mobile-topbar-town .mob-town-text').textContent = townName;
  document.getElementById('hint-badge').style.display = 'none';
  hintUsed = false;
  streetUsedThisRound = false;
  roundStartTime = Date.now();
  // Auto-switch back to satellite if player left street view on
  if (currentLayer === 'street') toggleMapLayer(true);
  updateHintBtn();
  updateHUD();
}

function updateHintBtn() {
  const btn = document.getElementById('btn-hint');
  const toolsBtn = document.getElementById('mobile-tools-hint');
  const disabled = hintsLeft <= 0 || hintUsed || waiting;
  btn.disabled = disabled;
  toolsBtn.disabled = disabled;
  const text = STRINGS[lang].hint_btn(hintsLeft);
  btn.textContent = text;
  toolsBtn.textContent = text;
}

function setDiff(d) {
  difficulty = d;
  ['easy','medium','hard'].forEach(k => {
    document.getElementById(`d-${k}`).className = `diff-btn${k === d ? ` active-${k}` : ''}`;
  });
  document.getElementById('diff-note').textContent = t(`note_${d}`);
}

// Region filter: 'all' | 'north' | 'center' | 'south'
// 'center' includes Jerusalem-region towns; 'south' includes West Bank entries near the south
const REGION_GROUPS = {
  all:    null,
  north:  ['North'],
  center: ['Center', 'Jerusalem'],
  south:  ['South', 'West Bank'],
};
const REGION_VIEWS = {
  all:    { center: [31.5,  34.9],  zoom: 7   },
  north:  { center: [32.85, 35.35], zoom: 8   },
  center: { center: [31.95, 34.95], zoom: 8.5 },
  south:  { center: [30.7,  34.85], zoom: 7.5 },
};

function setRegion(r) {
  region = r;
  ['all','north','center','south'].forEach(k => {
    document.getElementById(`r-${k}`).className = `region-card${k === r ? ' active' : ''}`;
  });
}

function useHint() {
  if (hintUsed || waiting || hintsLeft <= 0) return;
  closeMobileTools();
  hintUsed = true;
  hintsLeft--;
  document.getElementById('hint-badge').style.display = 'inline';
  updateHintBtn();

  const town = sequence[currentIdx];

  // Hint circle radius scales with difficulty
  const hintRadiusKm = DIFF[difficulty].maxKm * 0.55;
  const hintRadiusM  = hintRadiusKm * 1000;

  // Place town 45–80% from center so it's clearly off-center
  const offsetFraction = 0.45 + Math.random() * 0.35;
  const angle = Math.random() * 2 * Math.PI;
  const kmPerDegreeLat = 111;
  const kmPerDegreeLng = 111 * Math.cos(town.lat * Math.PI / 180);
  const offsetKm = hintRadiusKm * offsetFraction;
  const centerLat = town.lat - (Math.sin(angle) * offsetKm) / kmPerDegreeLat;
  const centerLng = town.lng - (Math.cos(angle) * offsetKm) / kmPerDegreeLng;

  // Color-cycling palette — gold/orange tones only
  const palette = [
    { stroke: '#f4a261', fill: '#f4a261' },
    { stroke: '#e9c46a', fill: '#e9c46a' },
    { stroke: '#d29922', fill: '#d29922' },
    { stroke: '#f48c06', fill: '#f48c06' },
    { stroke: '#ffb703', fill: '#ffb703' },
  ];
  let colorIdx = 0;

  hintCircle = L.circle([centerLat, centerLng], {
    radius: hintRadiusM,
    color: palette[0].stroke,
    weight: 3,
    dashArray: '10, 6',
    fillColor: palette[0].fill,
    fillOpacity: 0.25,
  }).addTo(map);

  // Animate color cycling every 600ms
  if (hintAnimFrame) clearInterval(hintAnimFrame);
  hintAnimFrame = setInterval(() => {
    if (!hintCircle) { clearInterval(hintAnimFrame); return; }
    colorIdx = (colorIdx + 1) % palette.length;
    hintCircle.setStyle({
      color: palette[colorIdx].stroke,
      fillColor: palette[colorIdx].fill,
    });
  }, 600);

  map.flyTo([centerLat, centerLng], Math.max(map.getZoom(), 8), { duration: 0.8 });
}

function showMenu() {
  isLearningMode = false;
  clearLearningPreview();
  document.getElementById('learning-hud').classList.remove('active');
  document.getElementById('hud').style.display = '';
  document.getElementById('learning-results-panel').className = '';
  clearLearningPins();
  document.getElementById('overlay').style.display = 'flex';
  document.getElementById('menu-card').style.display = 'flex';
  document.getElementById('results-panel').className = '';
  document.getElementById('scoreboard-panel').className = '';
  document.getElementById('btn-back').style.display = 'none';
  closeMobileTools();
  clearAllMarkers();
  ['btn-hint', 'btn-layer'].forEach(id => {
    document.getElementById(id).style.display = '';
  });
}

// ── Learning Mode ─────────────────────────────────────────────────────────────

function getLearningTier() {
  for (let tier = 1; tier <= 4; tier++) {
    const allInTier = TOWNS.filter(t => t.tier === tier);
    if (!allInTier.every(t => knownLocations.includes(t.name))) return tier;
  }
  return null; // all tiers complete
}

function showKnownPins() {
  clearLearningPins();
  const known = new Set(knownLocations);
  TOWNS.forEach(t => {
    if (!known.has(t.name)) return;
    const pin = L.circleMarker([t.lat, t.lng], {
      radius: 5, color: '#1a7f37', weight: 1.5,
      fillColor: '#1a7f37', fillOpacity: 0.7,
    }).addTo(map);
    learningPins.push(pin);
  });
}

function clearLearningPins() {
  learningPins.forEach(p => map.removeLayer(p));
  learningPins = [];
}

function updateLearningDots(used) {
  const dotsEl = document.getElementById('lr-att-dots');
  dotsEl.innerHTML = '';
  for (let i = 0; i < LEARNING_MAX_ATTEMPTS; i++) {
    const d = document.createElement('div');
    d.className = 'lr-dot' + (i < used ? ' used' : '');
    dotsEl.appendChild(d);
  }
}

function startLearningPreview(town) {
  learningPreviewActive = true;
  if (currentLayer !== 'street') toggleMapLayer(true);
  map.setView([town.lat, town.lng], 14, { animate: true });

  let secondsLeft = 15;
  const bar = document.getElementById('learning-preview-bar');
  const msgEl = document.getElementById('learning-preview-msg');
  const countEl = document.getElementById('learning-preview-count');
  msgEl.textContent = lang === 'he' ? '📍 זכרו את המיקום — הקישו להמשך' : '📍 Memorize the location — tap to continue';
  countEl.textContent = secondsLeft;
  bar.classList.add('active');

  const bigEl = document.getElementById('learning-big-countdown');
  learningPreviewInterval = setInterval(() => {
    secondsLeft--;
    countEl.textContent = secondsLeft;
    if (secondsLeft <= 5 && secondsLeft > 0) {
      bigEl.textContent = secondsLeft;
      bigEl.classList.add('active');
    } else {
      bigEl.classList.remove('active');
    }
    if (secondsLeft <= 0) endLearningPreview();
  }, 1000);
  learningPreviewTimer = setTimeout(endLearningPreview, 15000);
}

function endLearningPreview() {
  if (!learningPreviewActive) return;
  learningPreviewActive = false;
  clearTimeout(learningPreviewTimer);
  clearInterval(learningPreviewInterval);
  learningPreviewTimer = learningPreviewInterval = null;
  document.getElementById('learning-preview-bar').classList.remove('active');
  document.getElementById('learning-big-countdown').classList.remove('active');
  if (currentLayer === 'street') toggleMapLayer(true);
  const v = REGION_VIEWS['all'];
  map.setView(v.center, v.zoom);
}

function clearLearningPreview() {
  learningPreviewActive = false;
  clearTimeout(learningPreviewTimer);
  clearInterval(learningPreviewInterval);
  learningPreviewTimer = learningPreviewInterval = null;
  document.getElementById('learning-preview-bar').classList.remove('active');
  document.getElementById('learning-big-countdown').classList.remove('active');
}

function loadLearningTown() {
  const t = learningSequence[learningIdx];
  const townName = lang === 'he' ? t.nameHe : t.name;
  const townDesc = lang === 'he' ? t.descHe : t.desc;

  document.getElementById('town-name').textContent = townName;
  document.getElementById('town-desc').textContent = townDesc;
  document.querySelector('#mobile-topbar-town .mob-town-text').textContent = townName;

  // Update learning HUD
  document.getElementById('lr-prog-label').textContent = lang === 'he' ? 'מיקום' : 'Location';
  document.getElementById('lr-prog-val').textContent = (learningIdx + 1) + ' / ' + learningSequence.length;
  document.getElementById('lr-att-label').textContent = lang === 'he' ? 'נסיונות' : 'Tries';
  updateLearningDots(0);

  document.getElementById('hint-badge').style.display = 'none';
  hintUsed = false;
  streetUsedThisRound = false;
  learningAttempt = 0;
  waiting = false;

  fetchCityPolygon(t.name);
  if (learningIdx + 1 < learningSequence.length) fetchCityPolygon(learningSequence[learningIdx + 1].name);

  startLearningPreview(t);
}

function handleLearningClick(e) {
  haptic(30);
  const town = learningSequence[learningIdx];
  const distKm = haversineKm(e.latlng.lat, e.latlng.lng, town.lat, town.lng);
  const perfectKm = PERFECT_RADIUS_KM[town.tier] ?? 1;
  const polyFeature = polyCache[town.name] ?? null;
  const perfect = polyFeature
    ? pointInGeoJSONFeature(e.latlng.lat, e.latlng.lng, polyFeature)
    : distKm <= perfectKm;

  learningAttempt++;
  updateLearningDots(learningAttempt);

  if (perfect) {
    haptic([60, 40, 100]);
    learningSessionResults.push({ town, mastered: true });
    showLearningPopup('✅', lang === 'he' ? 'בול פגיעה!' : 'Mastered!', '#1a7f37', 'show-perfect');
    showCityPolygon(polyFeature, true);
    placeLearningCorrectMarker(town, '#1a7f37');
    waiting = true;
    setTimeout(() => { clearMapFeedback(); advanceLearning(); }, 2600);
  } else if (learningAttempt < LEARNING_MAX_ATTEMPTS) {
    const left = LEARNING_MAX_ATTEMPTS - learningAttempt;
    const retryMsg = lang === 'he'
      ? (left === 2 ? 'נסה שוב!<br>נותרו שני נסיונות' : 'נסה שוב!<br>נותר נסיון אחד')
      : `Try again!<br>${left} attempt${left === 1 ? '' : 's'} left`;
    showLearningPopup('❌', retryMsg, '#d29922', 'show-good');
    if (clickMarker) map.removeLayer(clickMarker);
    clickMarker = L.circleMarker([e.latlng.lat, e.latlng.lng], {
      radius: 7, color: '#fff', weight: 2, fillColor: '#d29922', fillOpacity: 0.8,
    }).addTo(map);
  } else {
    learningSessionResults.push({ town, mastered: false });
    showLearningPopup('📅', lang === 'he' ? 'בפעם הבאה!' : 'Next Time!', '#cf2316', 'show-miss');
    showCityPolygon(polyFeature, false);
    placeLearningCorrectMarker(town, '#cf2316');
    waiting = true;
    setTimeout(() => { clearMapFeedback(); advanceLearning(); }, 2500);
  }
}

function placeLearningCorrectMarker(town, color) {
  const displayName = lang === 'he' ? town.nameHe : town.name;
  const m = L.circleMarker([town.lat, town.lng], {
    radius: 9, color, weight: 2, fillColor: color, fillOpacity: 0.9,
  }).addTo(map);
  m.bindTooltip(
    `<div class="tooltip-inner"><span class="tooltip-name">${displayName}</span></div>`,
    { permanent: true, direction: 'top', offset: [0, -10], className: 'city-label' }
  ).openTooltip();
  correctMarkers.push(m);
}

function advanceLearning() {
  learningIdx++;
  if (learningIdx >= learningSequence.length) {
    showLearningResults();
  } else {
    waiting = false;
    loadLearningTown();
  }
}

async function showLearningResults() {
  const masteredNames = learningSessionResults.filter(r => r.mastered).map(r => r.town.name);
  const prevKnownSet = new Set(knownLocations);
  const newKnown = [...knownLocations, ...masteredNames.filter(n => !prevKnownSet.has(n))];
  const prevTier = getLearningTier();

  knownLocations = newKnown;
  if (window._fbUser && masteredNames.length > 0) {
    try {
      const { setDoc, doc } = window._fbFns;
      await setDoc(doc(window._fbDb, 'users', window._fbUser.uid), { knownLocations: newKnown }, { merge: true });
    } catch (e) { console.error('Failed to save known locations:', e); }
  }

  showKnownPins();
  const newTier = getLearningTier();
  const leveledUp = prevTier !== null && newTier !== prevTier;
  const mastered = learningSessionResults.filter(r => r.mastered).length;
  const total = learningSessionResults.length;

  document.getElementById('lr-emoji').textContent = mastered === total ? '🏆' : mastered > 0 ? '🌟' : '📚';
  document.getElementById('lr-title').textContent = lang === 'he'
    ? `${mastered} / ${total} מיקומים נלמדו`
    : `${mastered} / ${total} Mastered`;

  const tierForDisplay = prevTier ?? 4;
  const tierKnown = TOWNS.filter(t => t.tier === tierForDisplay && knownLocations.includes(t.name)).length;
  const tierTotal = TOWNS.filter(t => t.tier === tierForDisplay).length;
  document.getElementById('lr-subtitle').textContent = lang === 'he'
    ? `שלב ${tierForDisplay}: ${tierKnown} / ${tierTotal} ידועים`
    : `Level ${tierForDisplay}: ${tierKnown} / ${tierTotal} known`;

  const levelUpEl = document.getElementById('lr-level-up-banner');
  if (leveledUp && newTier !== null) {
    const n = LEARNING_TIER_NAMES[newTier];
    levelUpEl.style.display = 'block';
    levelUpEl.textContent = lang === 'he'
      ? `🎉 עלית שלב! שלב ${newTier}: ${n.he}`
      : `🎉 Level Up! Level ${newTier}: ${n.en}`;
  } else if (leveledUp && newTier === null) {
    levelUpEl.style.display = 'block';
    levelUpEl.textContent = lang === 'he' ? '🏆 שלטת בכל המיקומים!' : '🏆 All locations mastered!';
  } else {
    levelUpEl.style.display = 'none';
  }

  document.getElementById('lr-list').innerHTML = learningSessionResults.map(r => {
    const name = lang === 'he' ? r.town.nameHe : r.town.name;
    return `<div class="lr-row">
      <span>${r.mastered ? '✅' : '❌'} ${name}</span>
      <span class="${r.mastered ? 'lr-badge-mastered' : 'lr-badge-next'}">${r.mastered ? (lang === 'he' ? 'שולט!' : 'Mastered!') : (lang === 'he' ? 'בפעם הבאה' : 'Next Time')}</span>
    </div>`;
  }).join('');

  const continueBtn = document.getElementById('lr-continue-btn');
  const menuBtn = document.getElementById('lr-menu-btn');
  if (newTier === null) {
    continueBtn.style.display = 'none';
  } else {
    continueBtn.style.display = '';
    continueBtn.textContent = lang === 'he' ? '📚 המשך ללמוד' : '📚 Continue Learning';
  }
  menuBtn.textContent = lang === 'he' ? '← תפריט' : '← Menu';

  document.getElementById('learning-results-panel').classList.add('show');
  document.getElementById('learning-hud').classList.remove('active');
  document.getElementById('hud').style.display = '';
}

async function continueLearning() {
  document.getElementById('learning-results-panel').className = '';
  await startLearning();
}

async function startLearning() {
  if (!window._fbUser) {
    showFeedback(lang === 'he' ? '🔒 יש להתחבר כדי להשתמש במצב למידה' : '🔒 Sign in to use Learning Mode', '#cf2316');
    return;
  }

  try {
    const { getDoc, doc } = window._fbFns;
    const userSnap = await getDoc(doc(window._fbDb, 'users', window._fbUser.uid));
    knownLocations = userSnap.exists() ? (userSnap.data().knownLocations || []) : [];
  } catch (e) {
    knownLocations = [];
    console.error('Failed to load known locations:', e);
  }

  const tier = getLearningTier();
  if (tier === null) {
    showFeedback(lang === 'he' ? '🏆 שלטת בכל המיקומים!' : '🏆 All locations mastered!', '#1a7f37');
    return;
  }

  const allInTier = TOWNS.filter(t => t.tier === tier);
  learningSequence = allInTier.filter(t => !knownLocations.includes(t.name)).slice(0, LEARNING_SESSION_SIZE);
  if (learningSequence.length === 0) {
    showFeedback(lang === 'he' ? '🎉 כל המיקומים בשלב זה ידועים!' : '🎉 All locations in this level known!', '#1a7f37');
    return;
  }

  isLearningMode = true;
  learningIdx = 0;
  learningAttempt = 0;
  learningSessionResults = [];
  waiting = false;
  clearAllMarkers();
  if (currentLayer === 'street') toggleMapLayer(true);

  document.getElementById('overlay').style.display = 'none';
  document.getElementById('results-panel').className = '';
  document.getElementById('learning-results-panel').className = '';
  document.getElementById('scoreboard-panel').className = '';
  document.getElementById('btn-back').style.display = 'inline-block';

  const v = REGION_VIEWS['all'];
  map.setView(v.center, v.zoom);

  showKnownPins();
  document.getElementById('hud').style.display = 'none';
  document.getElementById('learning-hud').classList.add('active');
  ['btn-hint', 'btn-layer'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });

  loadLearningTown();
}

function startGame() {
  const tierFilter = TOWNS.filter(t => t.tier <= DIFF[difficulty].maxTier);
  const regionFilter = REGION_GROUPS[region];
  const pool = regionFilter
    ? tierFilter.filter(t => regionFilter.includes(t.region))
    : tierFilter;
  // If somehow fewer than 8 towns in pool, take all of them
  sequence = shuffle(pool).slice(0, Math.min(8, pool.length));
  roundCount = sequence.length;
  currentIdx = score = streak = 0;
  results = [];
  waiting = false;
  hintsLeft = 3;
  clearAllMarkers();
  // Switch back to satellite view if on street view
  if (currentLayer === 'street') {
    toggleMapLayer(true); // suppress banner - auto-switching for new game
  }
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('results-panel').className = '';
  document.getElementById('scoreboard-panel').className = '';
  document.getElementById('btn-back').style.display = 'inline-block';
  const v = REGION_VIEWS[region];
  map.setView(v.center, v.zoom);
  loadTown();
}

function onMapClick(e) {
  if (factModalOpen || document.getElementById('overlay').style.display !== 'none') return;
  if (isLearningMode && learningPreviewActive) { endLearningPreview(); return; }
  if (waiting) return;
  if (isLearningMode) { handleLearningClick(e); return; }

  haptic(30); // subtle tap on pin placement

  const town = sequence[currentIdx];
  const d = DIFF[difficulty];
  const distKm = haversineKm(e.latlng.lat, e.latlng.lng, town.lat, town.lng);
  const perfectKm = PERFECT_RADIUS_KM[town.tier] ?? 1;
  const polyFeature = polyCache[town.name] ?? null;
  const perfect = polyFeature
    ? pointInGeoJSONFeature(e.latlng.lat, e.latlng.lng, polyFeature)
    : distKm <= perfectKm;
  // When a polygon is available, award full points for any click inside it
  const basePts = (polyFeature && perfect) ? Math.round(DIFF[difficulty].maxPts * (TIER_MULTIPLIER[town.tier] ?? 1)) : calcPts(distKm, d, hintUsed, town.tier);
  // Time bonus: only awarded when you score any points (no reward for a fast miss)
  const timeBonus = basePts > 0 && !streetUsedThisRound ? calcTimeBonus(Date.now() - roundStartTime) : 0;
  const pts = basePts + timeBonus;
  const closeEnough = distKm < 10;
  const newStreak = perfect ? streak + 1 : 0;

  if (perfect) haptic([60, 40, 100]); // short satisfying pulse for correct answer

  // Color: green for close, yellow for ok, red for far
  const pct = pts / d.maxPts;
  const color = pct >= 0.7 ? '#1a7f37' : pct >= 0.3 ? '#d29922' : '#cf2316';

  showPtsPopup(pts, pct, perfect, distKm, timeBonus);
  showCityPolygon(polyFeature, perfect);

  waiting = true;
  streak = newStreak;
  score += pts + (newStreak >= 3 && perfect ? 10 : 0);
  results.push({ town, hit: perfect, distKm: distKm.toFixed(1), pts });
  if (newStreak >= 3 && perfect) {
    showStreakBanner(newStreak);
  } else if (!perfect) {
    // Hide banner with fade-out animation on a non-close guess
    const b = document.getElementById('streak-banner');
    if (b.classList.contains('show')) {
      b.classList.remove('show');
      b.classList.add('hide');
      setTimeout(() => { b.className = ''; }, 400);
    }
    if (streakTimeout) { clearTimeout(streakTimeout); streakTimeout = null; }
  }

  // Show target circle sized to maxKm for reference
  circle = L.circle([town.lat, town.lng], {
    radius: d.maxKm * 1000, color: '#888', weight: 1,
    fillColor: '#888', fillOpacity: 0.05, dashArray: '6,4',
  }).addTo(map);

  // Permanent pin — stays on map for the rest of the game
  const newMarker = L.circleMarker([town.lat, town.lng], {
    radius: 9, color, weight: 2, fillColor: color, fillOpacity: 0.9,
  }).addTo(map);
  correctMarkers.push(newMarker);

  // Label tooltip that stays visible permanently
  const displayName = lang === 'he' ? town.nameHe : town.name;
  const displayDesc = lang === 'he' ? town.descHe : town.desc;
  newMarker.bindTooltip(
    `<div class="tooltip-inner">` +
    `<span class="tooltip-name">${displayName}</span>` +
    `<span class="fact-btn" data-town="${town.name}"><span class="spark">✨</span></span>` +
    `</div>`,
    {
      permanent: true,
      direction: 'top',
      offset: [0, -10],
      className: 'city-label',
      interactive: true,
    }
  ).openTooltip();

  // Always show where the player clicked
  clickMarker = L.circleMarker([e.latlng.lat, e.latlng.lng], {
    radius: 7, color: '#fff', weight: 2, fillColor: '#666', fillOpacity: 0.8,
  }).addTo(map);

  updateHUD();

  setTimeout(() => {
    clearMapFeedback();
    currentIdx++;
    waiting = false;
    if (currentIdx >= roundCount) showResults();
    else loadTown();
  }, 3500);
}

function showResults() {
  const pct = (score / (roundCount * DIFF[difficulty].maxPts)) * 100;
  const hits = results.filter(r => r.pts >= 90).length;
  document.getElementById('result-emoji').textContent = pct >= 80 ? '🏆' : pct >= 50 ? '🌟' : '📚';
  document.getElementById('result-title').textContent =
    pct >= 80 ? t('result_excellent') : pct >= 50 ? t('result_good') : t('result_practice');
  document.getElementById('score-display').textContent =
    `${score} ${lang === 'he' ? 'נקודות' : 'pts'}`;
  document.getElementById('score-display').style.color = DIFF[difficulty].color;
  document.getElementById('result-sub').textContent = lang === 'he'
    ? `${hits} / ${roundCount} ערים נמצאו נכון`
    : `${hits} / ${roundCount} towns found correctly`;
  const rNames = t('region_names');
  document.getElementById('results-list').innerHTML = results.map(r => {
    const rName = lang === 'he' ? (r.town.nameHe || r.town.name) : r.town.name;
    const rRegion = rNames[r.town.region] || r.town.region;
    const rDist = lang === 'he' ? `${r.distKm} ק\"מ` : `${r.distKm} km off`;
    const rMiss = lang === 'he' ? 'פספוס' : 'miss';
    return `
    <div class="result-row ${r.hit ? 'hit' : 'miss'}">
      <div>
        <div class="result-town">${r.hit ? '✅' : '❌'} ${rName}</div>
        <div class="result-region">${rRegion} · ${rDist}</div>
      </div>
      <div class="result-pts ${r.hit ? 'hit' : 'miss'}">${r.hit ? '+' + r.pts : rMiss}</div>
    </div>`;
  }).join('');
  document.getElementById('menu-card').style.display = 'none';
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('results-card').dir = lang === 'he' ? 'rtl' : 'ltr';
  document.getElementById('results-panel').className = 'show';
  // Switch to street view so player can review mistakes with labels
  if (currentLayer === 'satellite') {
    toggleMapLayer(true); // suppress banner - this is for review, not cheating
  }

}

setDiff('medium');
setRegion('all');
applyLang();

// ── RANDOM DEFAULT NICKNAME ────────────────────────────────────────────────
function generateRandomNickname() {
  const prefixes = ['Bamba','Bisli','Krembo','Klik','Shoko','Pesek','Mekupelet','Taami'];
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
  let suffix = '';
  for (let i = 0; i < 4; i++) suffix += chars[Math.floor(Math.random() * chars.length)];
  return prefix + '_' + suffix;
}

// ── FIREBASE AUTH & SCORING ────────────────────────────────────────────────

let _authMode = 'signin'; // 'signin' | 'signup'

// Called by the Firebase module once auth state changes
window._onAuthChange = function(user) {
  const avatar = document.getElementById('auth-avatar');
  const label  = document.getElementById('auth-label');
  if (user) {
    label.textContent = user.displayName ? user.displayName.split(' ')[0] : 'Account';
    if (user.photoURL) {
      avatar.innerHTML = `<img src="${user.photoURL}" alt="avatar"/>`;
    } else {
      avatar.innerHTML = '';
      avatar.textContent = (user.displayName || user.email || '?').charAt(0).toUpperCase();
    }
    document.getElementById('auth-dropdown-name').textContent  = user.displayName || '—';
    document.getElementById('auth-dropdown-email').textContent = user.email || '';

    // Load ALL settings from Firestore and apply immediately
    Promise.resolve(window._fbFns).then(({ getDoc, setDoc, doc }) => {
      getDoc(doc(window._fbDb, 'users', user.uid)).then(async snap => {
        if (snap.exists()) {
          const data = snap.data();
          if (data.language) setLang(data.language);
          if (data.gender) {
            // Update in-memory state and gender button UI without triggering a save.
            // saveSettings() must not run here: the settings modal is closed and the
            // nickname input is empty, so calling it would wipe the saved nickname.
            _selectedGender = data.gender;
            ['male','female','other'].forEach(opt => {
              const el = document.getElementById(`gender-${opt}`);
              if (el) el.classList.toggle('selected', opt === data.gender);
            });
          }
          // Assign a default nickname if the user doesn't have one
          if (!data.nickname) {
            const defaultNick = generateRandomNickname();
            await setDoc(doc(window._fbDb, 'users', user.uid), { nickname: defaultNick }, { merge: true });
          }
        } else {
          // New user with no doc yet — create one with a default nickname
          const defaultNick = generateRandomNickname();
          await setDoc(doc(window._fbDb, 'users', user.uid), { nickname: defaultNick }, { merge: true });
        }
      });
    });
  } else {
    avatar.innerHTML = ''; avatar.textContent = '👤';
    label.textContent = lang === 'he' ? 'התחברות' : 'Log in';
    closeAuthDropdown();
  }
};

function handleAuthBtnClick() {
  if (window._fbUser) { toggleAuthDropdown(); } else { openLoginModal(); }
}
function toggleAuthDropdown() {
  document.getElementById('auth-dropdown').classList.toggle('open');
}
function closeAuthDropdown() {
  document.getElementById('auth-dropdown').classList.remove('open');
}
document.addEventListener('click', e => {
  const wrap = document.getElementById('auth-wrap');
  if (wrap && !wrap.contains(e.target)) closeAuthDropdown();
});
function switchAccount() {
  closeAuthDropdown();
  const { signOut } = window._fbFns;
  signOut(window._fbAuth).then(() => openLoginModal());
}

function openLoginModal() {
  document.getElementById('login-modal').classList.add('open');
  document.getElementById('login-error').textContent = '';
}
function closeLoginModal() {
  document.getElementById('login-modal').classList.remove('open');
}
// Close on backdrop click
document.getElementById('login-modal').addEventListener('click', e => {
  if (e.target === document.getElementById('login-modal')) closeLoginModal();
});

function toggleAuthMode() {
  _authMode = _authMode === 'signin' ? 'signup' : 'signin';
  const isSignup = _authMode === 'signup';
  document.getElementById('login-name').style.display     = isSignup ? 'block' : 'none';
  document.getElementById('login-submit-btn').textContent = isSignup ? 'Create account' : 'Sign in';
  document.getElementById('login-toggle').innerHTML = isSignup
    ? `Already have an account? <a onclick="toggleAuthMode()">Sign in</a>`
    : `Don't have an account? <a onclick="toggleAuthMode()">Sign up</a>`;
  document.getElementById('login-error').textContent = '';
}

async function signInGoogle() {
  const { GoogleAuthProvider, signInWithPopup } = window._fbFns;
  try {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(window._fbAuth, provider);
    closeLoginModal();
  } catch (e) {
    document.getElementById('login-error').textContent = e.message;
  }
}

async function submitEmailAuth() {
  const { createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } = window._fbFns;
  const email    = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  const name     = document.getElementById('login-name').value.trim();
  const errEl    = document.getElementById('login-error');
  errEl.textContent = '';
  if (!email || !password) { errEl.textContent = 'Please fill in all fields.'; return; }
  try {
    if (_authMode === 'signup') {
      if (!name) { errEl.textContent = 'Please enter a display name.'; return; }
      const cred = await createUserWithEmailAndPassword(window._fbAuth, email, password);
      await updateProfile(cred.user, { displayName: name });
      window._onAuthChange(cred.user);
    } else {
      await signInWithEmailAndPassword(window._fbAuth, email, password);
    }
    closeLoginModal();
  } catch (e) {
    const msgs = {
      'auth/email-already-in-use': 'Email already in use.',
      'auth/invalid-email':        'Invalid email address.',
      'auth/weak-password':        'Password must be at least 6 characters.',
      'auth/invalid-credential':   'Incorrect email or password.',
    };
    errEl.textContent = msgs[e.code] || e.message;
  }
}

async function signOutUser() {
  const { signOut } = window._fbFns;
  await signOut(window._fbAuth);
}

// ── SAVE SCORE TO FIRESTORE ───────────────────────────────────────────────
async function saveScore(scoreData) {
  if (!window._fbUser) return;
  const { collection, addDoc, serverTimestamp } = window._fbFns;
  try {
    // Save the game record
    await addDoc(collection(window._fbDb, 'scores'), {
      uid:         window._fbUser.uid,
      displayName: window._fbUser.displayName || '',
      score:       scoreData.score,
      difficulty:  scoreData.difficulty,
      region:      scoreData.region,
      rounds:      scoreData.rounds,
      hits:        scoreData.hits,
      timestamp:   serverTimestamp(),
    });

    // Update highest_score in users doc if this score beats it
    const { getDoc, setDoc, doc } = window._fbFns;
    const userRef  = doc(window._fbDb, 'users', window._fbUser.uid);
    const userSnap = await getDoc(userRef);
    const current  = userSnap.exists() ? (userSnap.data().highest_score || 0) : 0;
    const isNewRecord = scoreData.score > current;
    const tier = getLearningTier() || 4;
    if (isNewRecord) {
      await setDoc(userRef, { highest_score: scoreData.score, level: tier }, { merge: true });
    } else {
      await setDoc(userRef, { level: tier }, { merge: true });
    }

    return { ok: true, isNewRecord };
  } catch (e) { console.error('Save score failed:', e); return { ok: false, isNewRecord: false }; }
}

// ── LOAD PERSONAL HISTORY ─────────────────────────────────────────────────
async function loadHistory() {
  const section = document.getElementById('history-section');
  const list    = document.getElementById('history-list');
  if (!window._fbUser) { section.classList.remove('show'); return; }

  const { collection, query, where, orderBy, limit, getDocs } = window._fbFns;
  try {
    const q = query(
      collection(window._fbDb, 'scores'),
      where('uid', '==', window._fbUser.uid),
      orderBy('timestamp', 'desc'),
      limit(5)
    );
    const snap = await getDocs(q);
    if (snap.empty) { section.classList.remove('show'); return; }

    const diffLabel = { easy: '🟢 Easy', medium: '🟡 Medium', hard: '🔴 Hard' };
    const regionLabel = { all: '🇮🇱 All', north: '🏔️ North', center: '🏙️ Center', south: '🏜️ South' };

    list.innerHTML = snap.docs.map(doc => {
      const d = doc.data();
      const date = d.timestamp?.toDate
        ? d.timestamp.toDate().toLocaleDateString('en-GB', { day:'numeric', month:'short' })
        : '—';
      return `<div class="history-row">
        <div>
          <div style="font-weight:600">${d.hits}/${d.rounds} correct</div>
          <div class="h-meta">${diffLabel[d.difficulty] || d.difficulty} · ${regionLabel[d.region] || d.region} · ${date}</div>
        </div>
        <div class="h-score">${d.score} pts</div>
      </div>`;
    }).join('');
    section.classList.add('show');
  } catch (e) { console.error('Load history failed:', e); }
}

// ── CONFETTI ──────────────────────────────────────────────────────────────
function launchConfetti() {
  const canvas = document.createElement('canvas');
  canvas.style.cssText = 'position:fixed;inset:0;width:100%;height:100%;pointer-events:none;z-index:9999;';
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;

  const colors = ['#1a6fd4','#7c3aed','#f0883e','#1a7f37','#cf2316','#f4c430','#58a6ff'];
  const pieces = Array.from({ length: 120 }, () => ({
    x:     Math.random() * canvas.width,
    y:     -10 - Math.random() * 200,
    r:     4 + Math.random() * 5,
    color: colors[Math.floor(Math.random() * colors.length)],
    vx:    (Math.random() - 0.5) * 3,
    vy:    2 + Math.random() * 4,
    angle: Math.random() * Math.PI * 2,
    spin:  (Math.random() - 0.5) * 0.2,
    shape: Math.random() > 0.5 ? 'rect' : 'circle',
  }));

  let frame;
  const start = Date.now();
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const elapsed = Date.now() - start;
    pieces.forEach(p => {
      p.x += p.vx; p.y += p.vy; p.angle += p.spin;
      p.vy += 0.05; // gravity
      const alpha = Math.max(0, 1 - elapsed / 3000);
      ctx.globalAlpha = alpha;
      ctx.fillStyle = p.color;
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.angle);
      if (p.shape === 'rect') {
        ctx.fillRect(-p.r, -p.r / 2, p.r * 2, p.r);
      } else {
        ctx.beginPath();
        ctx.arc(0, 0, p.r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.restore();
    });
    ctx.globalAlpha = 1;
    if (elapsed < 3500) {
      frame = requestAnimationFrame(draw);
    } else {
      canvas.remove();
    }
  }
  frame = requestAnimationFrame(draw);
}

// ── SCOREBOARD ────────────────────────────────────────────────────────────
async function loadScoreboard(myScore) {
  const section = document.getElementById('scoreboard-panel');
  const list    = document.getElementById('scoreboard-list');
  const guest   = document.getElementById('scoreboard-guest');
  section.classList.add('show');
  list.innerHTML = '';

  // Update lang labels
  document.getElementById('scoreboard-title').textContent    = lang === 'he' ? '🏆 לוח תוצאות' : '🏆 Leaderboard';
  document.getElementById('sb-signin-link').textContent      = lang === 'he' ? 'התחברות' : 'Sign in';
  document.getElementById('sb-signin-text').textContent      = lang === 'he' ? ' כדי לראות את לוח התוצאות' : ' to see the leaderboard';

  if (!window._fbUser) {
    list.style.display  = 'none';
    guest.style.display = 'block';
    return;
  }
  guest.style.display = 'none';
  list.style.display  = 'block';
  list.innerHTML = `<div style="color:var(--muted);font-size:0.82rem;text-align:center;padding:8px 0">${lang === 'he' ? 'טוען…' : 'Loading…'}</div>`;

  try {
    const { collection, getDocs, query, orderBy, limit } = window._fbFns;
    // Fetch top scores from users collection (those with a highest_score)
    const snap = await getDocs(query(
      collection(window._fbDb, 'users'),
      orderBy('highest_score', 'desc'),
      limit(200)
    ));

    const players = [];
    snap.forEach(doc => {
      const d = doc.data();
      if (d.highest_score > 0) {
        players.push({
          uid:      doc.id,
          name:     d.nickname || d.displayName || (lang === 'he' ? 'שחקן אנונימי' : 'Anonymous'),
          score:    d.highest_score,
          level:    d.level || 1,
          isMe:     doc.id === window._fbUser.uid,
        });
      }
    });

    if (players.length === 0) {
      list.innerHTML = `<div style="color:var(--muted);font-size:0.82rem;text-align:center;padding:8px 0">${lang === 'he' ? 'אין נתונים עדיין' : 'No scores yet'}</div>`;
      return;
    }

    // Sort descending and find my position
    players.sort((a, b) => b.score - a.score);
    const myIdx = players.findIndex(p => p.isMe);

    // Pick 5 neighbours: 2 above, me, 2 below (clamped to array bounds)
    let start = Math.max(0, myIdx - 2);
    let end   = Math.min(players.length - 1, start + 4);
    start     = Math.max(0, end - 4);
    const visible = players.slice(start, end + 1);

    // Current-game summary banner
    const currentScoreRank = players.filter(p => p.score > myScore).length + 1;
    const totalForRank     = myIdx === -1 ? players.length + 1 : players.length;
    const showTopPct       = totalForRank >= 10;
    const topPct           = showTopPct ? Math.max(1, Math.ceil((currentScoreRank / totalForRank) * 100)) : null;
    const rankLabel        = lang === 'he'
      ? `<span dir="rtl">מקום ${currentScoreRank} מתוך ${totalForRank}</span>`
      : `#${currentScoreRank} of ${totalForRank}`;
    let html = `
      <div class="sb-summary">
        <div class="sb-summary-left">
          <div class="sb-summary-label">${lang === 'he' ? 'המשחק הנוכחי' : 'This game'}</div>
          <div class="sb-summary-pts">${myScore} <span class="sb-summary-pts-unit">pts</span></div>
        </div>
        <div class="sb-summary-right">
          ${showTopPct ? `<div class="sb-top-pct">Top ${topPct}%</div>` : ''}
          <div class="sb-summary-label">${rankLabel}</div>
        </div>
      </div>`;

    // Show "..." if not starting from rank 1
    if (start > 0) html += `<div class="sb-divider">· · ·</div>`;

    visible.forEach((p, i) => {
      const globalRank = start + i + 1;
      let rankHtml;
      if      (globalRank === 1) rankHtml = `<span class="sb-rank gold">🥇</span>`;
      else if (globalRank === 2) rankHtml = `<span class="sb-rank silver">🥈</span>`;
      else if (globalRank === 3) rankHtml = `<span class="sb-rank bronze">🥉</span>`;
      else                       rankHtml = `<span class="sb-rank">#${globalRank}</span>`;

      const lvl = PLAYER_LEVEL_NAMES[p.level] || PLAYER_LEVEL_NAMES[1];
      const lvlText = lang === 'he' ? lvl.he : lvl.en;
      html += `
        <div class="sb-row ${p.isMe ? 'sb-me' : ''}">
          ${rankHtml}
          <span class="sb-name">
            <span class="sb-name-text">${p.isMe ? `<strong>${p.name}</strong>` : p.name}</span>
            <span class="sb-level-badge" dir="${lang === 'he' ? 'rtl' : 'ltr'}">${lvlText}</span>
          </span>
          <span class="sb-score">${p.score}</span>
        </div>`;
    });

    if (end < players.length - 1) html += `<div class="sb-divider">· · ·</div>`;

    // If user isn't in the list yet (no previous score), append them at the bottom
    if (myIdx === -1) {
      const myTier = getLearningTier() || 4;
      const myLvl = PLAYER_LEVEL_NAMES[myTier] || PLAYER_LEVEL_NAMES[1];
      const myLvlText = lang === 'he' ? myLvl.he : myLvl.en;
      html += `<div class="sb-divider">· · ·</div>`;
      html += `<div class="sb-row sb-me">
        <span class="sb-rank">#${players.length + 1}</span>
        <span class="sb-name">
          <span class="sb-name-text"><strong>${lang === 'he' ? 'את/ה' : 'You'}</strong></span>
          <span class="sb-level-badge" dir="${lang === 'he' ? 'rtl' : 'ltr'}">${myLvlText}</span>
        </span>
        <span class="sb-score">${myScore}</span>
      </div>`;
    }

    list.innerHTML = html;
  } catch(e) {
    console.error('Scoreboard failed:', e);
    list.innerHTML = `<div style="color:var(--muted);font-size:0.82rem;text-align:center;padding:8px 0">${lang === 'he' ? 'שגיאה בטעינה' : 'Could not load'}</div>`;
  }
}
const _origShowResults = showResults;
showResults = async function() {
  _origShowResults();
  // Reset scoreboard
  document.getElementById('scoreboard-panel').classList.remove('show');
  document.getElementById('scoreboard-list').innerHTML = '';

  const hits = results.filter(r => r.pts >= 90).length;
  const recBanner = document.getElementById('new-record-banner');
  const recSub    = document.getElementById('new-record-sub');
  recBanner.classList.remove('show');

  if (window._fbUser) {
    const result = await saveScore({ score, difficulty, region, rounds: roundCount, hits });
    if (result?.ok) {
      if (result.isNewRecord) {
        recSub.textContent = lang === 'he'
          ? `השגת שיא חדש עם ${score} נקודות!`
          : `You beat your best with ${score} pts!`;
        recBanner.classList.add('show');
        launchConfetti();
      }
    }
    loadHistory();
  } else {
    document.getElementById('history-section').classList.remove('show');
  }

  // Always show scoreboard (sign-in prompt for guests)
  loadScoreboard(score);
};

// ── SETTINGS ──────────────────────────────────────────────────────────────

let _selectedGender = 'male';
let _settingsLoading = false;

function selectGender(g) {
  _selectedGender = g;
  ['male','female','other'].forEach(opt => {
    const el = document.getElementById(`gender-${opt}`);
    if (el) el.classList.toggle('selected', opt === g);
  });
  if (!_settingsLoading) saveSettings();
}

function selectSettingsLang(l) {
  ['he','en'].forEach(opt => {
    const el = document.getElementById(`settings-lang-${opt}`);
    if (el) el.classList.toggle('selected', opt === l);
  });
  if (!_settingsLoading) saveSettings();
}

async function openSettingsModal() {
  closeAuthDropdown();
  document.getElementById('settings-save-msg').textContent = '';
  document.getElementById('settings-modal').classList.add('open');
  _settingsLoading = true;

  try {
    if (window._fbUser) {
      try {
        const { getDoc, setDoc, doc } = window._fbFns;
        const snap = await getDoc(doc(window._fbDb, 'users', window._fbUser.uid));
        if (snap.exists()) {
          const data = snap.data();
          let nick = data.nickname || '';
          if (!nick) {
            nick = generateRandomNickname();
            setDoc(doc(window._fbDb, 'users', window._fbUser.uid), { nickname: nick }, { merge: true });
          }
          document.getElementById('settings-nickname').value = nick;
          selectGender(data.gender || 'male');
          selectSettingsLang(data.language || lang);
        } else {
          const nick = generateRandomNickname();
          document.getElementById('settings-nickname').value = nick;
          setDoc(doc(window._fbDb, 'users', window._fbUser.uid), { nickname: nick }, { merge: true });
          selectGender('male');
          selectSettingsLang(lang);
        }
      } catch(e) {
        // Fall back to current in-memory values
        selectGender(_selectedGender || 'male');
        selectSettingsLang(lang);
        console.error('Load settings failed:', e);
      }
    } else {
      selectGender(_selectedGender || 'male');
      selectSettingsLang(lang);
    }
  } finally {
    _settingsLoading = false;
  }
}

function closeSettingsModal() {
  document.getElementById('settings-modal').classList.remove('open');
}
document.getElementById('settings-modal').addEventListener('click', e => {
  if (e.target === document.getElementById('settings-modal')) closeSettingsModal();
});

// ── NICKNAME VALIDATION ──────────────────────────────────────────────────
const _nicknameRegex = /^[A-Za-z0-9_]{1,15}$/;
let _nickErrTimer = null;

function isValidNickname(nick) {
  return _nicknameRegex.test(nick);
}

function showNicknameError() {
  const popup = document.getElementById('nickname-error-popup');
  popup.textContent = lang === 'he'
    ? 'הכינוי חייב להכיל עד 15 תווים: אותיות (a-z), ספרות (0-9) וקו תחתון (_) בלבד.'
    : 'Nickname must be up to 15 characters: letters (a-z), digits (0-9), and underscore (_) only.';
  popup.classList.add('show');
  clearTimeout(_nickErrTimer);
  _nickErrTimer = setTimeout(() => { popup.classList.remove('show'); }, 4000);
}

// Auto-save nickname: debounce while typing, save immediately on blur
let _nicknameSaveTimer = null;
document.getElementById('settings-nickname').addEventListener('input', () => {
  clearTimeout(_nicknameSaveTimer);
  _nicknameSaveTimer = setTimeout(saveSettings, 800);
});
document.getElementById('settings-nickname').addEventListener('blur', () => {
  clearTimeout(_nicknameSaveTimer);
  saveSettings();
});

async function saveSettings() {
  if (!window._fbUser) return;
  let nickname = document.getElementById('settings-nickname').value.trim();
  if (!nickname) {
    nickname = generateRandomNickname();
    document.getElementById('settings-nickname').value = nickname;
  }
  if (!isValidNickname(nickname)) {
    showNicknameError();
    return;
  }
  const selectedLang = document.getElementById('settings-lang-he').classList.contains('selected') ? 'he' : 'en';
  const msgEl = document.getElementById('settings-save-msg');
  msgEl.style.color = 'var(--muted)';
  msgEl.textContent = lang === 'he' ? 'שומר…' : 'Saving…';

  try {
    const { setDoc, doc } = window._fbFns;
    await setDoc(doc(window._fbDb, 'users', window._fbUser.uid), {
      nickname:    nickname,
      gender:      _selectedGender || null,
      language:    selectedLang,
      updatedAt:   new Date(),
    }, { merge: true });

    // Apply language change immediately
    if (selectedLang !== lang) setLang(selectedLang);

    msgEl.style.color = 'var(--green)';
    msgEl.textContent = selectedLang === 'he' ? '✅ נשמר!' : '✅ Saved!';
    setTimeout(() => { msgEl.textContent = ''; }, 2500);
  } catch(e) {
    msgEl.style.color = 'var(--red)';
    msgEl.textContent = e.code || e.message || 'Unknown error';
    console.error('Save settings failed:', e);
  }
}
</script>

</body>
</html>
